<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlashChat Pro - –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: 'Inter', sans-serif; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        html { 
            height: 100%;
            height: -webkit-fill-available;
        }
        body { 
            margin: 0;
            padding: 0;
            height: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .chat-scroll::-webkit-scrollbar { width: 6px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .message-in { border-radius: 18px 18px 18px 4px; }
        .message-out { border-radius: 18px 18px 4px 18px; }
        .typing-dot { animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up { animation: slideUp 0.3s ease; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .gradient-orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .unread-badge { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .reaction-btn { transition: all 0.2s; }
        .reaction-btn:hover { transform: scale(1.3); }
        .modal-overlay { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .image-preview { 
            max-width: 280px; 
            max-height: 280px; 
            width: 100%;
            height: auto;
            object-fit: contain; 
            border-radius: 12px;
            display: block;
        }
        .message-image {
            max-width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }
        .file-upload-progress { transition: width 0.3s; }
        
        /* Developer Badge */
        .dev-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: devBadgeGlow 2s ease-in-out infinite;
            vertical-align: middle;
        }
        .dev-badge svg {
            width: 10px;
            height: 10px;
        }
        @keyframes devBadgeGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(240, 147, 251, 0.5); }
            50% { box-shadow: 0 0 15px rgba(240, 147, 251, 0.8), 0 0 25px rgba(245, 87, 108, 0.5); }
        }
        
        @supports (padding-top: env(safe-area-inset-top)) {
            .safe-top { padding-top: env(safe-area-inset-top); }
            .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        }
        
        /* ===== –û–°–ù–û–í–ù–´–ï –ö–û–ù–¢–ï–ô–ù–ï–†–´ ===== */
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ */
        #chatScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
        
        #chatScreen.active {
            display: flex;
            flex-direction: row;
        }
        
        /* –°–∞–π–¥–±–∞—Ä */
        #sidebar {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            width: 100%;
            background: rgba(31, 41, 55, 0.5);
        }
        
        #chatList {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        #chatArea {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: #111827;
        }
        
        #chatArea.active {
            display: flex;
            flex-direction: column;
        }
        
        /* –ü—É—Å—Ç–æ–π —á–∞—Ç */
        #emptyChat {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –ê–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç */
        #activeChat {
            /* –í–∞–∂–Ω–æ: –Ω–∏–∫–∞–∫–∏—Ö absolute ‚Äî –∏–Ω–∞—á–µ –ª–æ–º–∞–µ—Ç—Å—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö */
            position: relative;
            display: none;
            flex: 1 1 auto;
            min-height: 0;
            flex-direction: column;
            overflow: hidden;
        }
        
        #activeChat.active {
            display: flex;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π */
        #activeChat > .chat-header {
            flex-shrink: 0;
        }
        
        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ */
        .chat-header {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-bottom: 1px solid rgba(75, 85, 99, 0.5);
            z-index: 20;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π */
        #messagesContainer {
            flex: 1 1 auto;
            min-height: 0; /* –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è flex –≤ Safari/Chrome */
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
            padding-bottom: 24px;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏ */
        #typingIndicator {
            flex: 0 0 auto;
        }
        
        /* –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∑–∫–∏ */
        #uploadPreview {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        /* –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤—Å–µ–≥–¥–∞ —Å–Ω–∏–∑—É –≤–Ω—É—Ç—Ä–∏ #activeChat) */
        #messageInputArea {
            flex: 0 0 auto;
            background: #1f2937;
            border-top: 1px solid #374151;
            padding: 10px;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
            z-index: 30;
        }
        
        /* –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ */
        #messageInputArea form {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #messageInputArea input[type="text"] {
            flex: 1;
            min-width: 0;
            height: 44px;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid #4b5563;
            border-radius: 12px;
            padding: 0 16px;
            color: white;
            font-size: 14px;
        }
        
        #messageInputArea input[type="text"]:focus {
            outline: none;
            border-color: #8b5cf6;
        }
        
        #messageInputArea button {
            flex-shrink: 0;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        #messageInputArea button:hover {
            opacity: 0.8;
        }
        
        #messageInputArea button[type="submit"] {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        #messageInputArea button[type="button"] {
            background: transparent;
            color: #9ca3af;
        }
        
        #messageInputArea button[type="button"]:hover {
            background: rgba(55, 65, 81, 0.5);
            color: white;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ */
        #channelNotice {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        /* ===== –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø (–°–¢–ê–ë–ò–õ–¨–ù–ê–Ø –î–õ–Ø –í–°–ï–• –ë–†–ê–£–ó–ï–†–û–í) ===== */
        @media (max-width: 768px) {
            /*
              –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø–∞–Ω–µ–ª—å (sidebar –ò–õ–ò chatArea).
              –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –≤—ã—Å–æ—Ç—ã, —á—Ç–æ–±—ã input –Ω–µ —É–µ–∑–∂–∞–ª –∑–∞ —ç–∫—Ä–∞–Ω
              –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏/–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
            */
            #chatScreen {
                position: absolute;
                inset: 0;
                height: 100vh;
                height: 100svh;
                height: 100dvh;
            }

            #sidebar,
            #chatArea {
                position: absolute;
                inset: 0;
                width: 100%;
                height: 100vh;
                height: 100svh;
                height: 100dvh;
            }

            /* –ö–æ–≥–¥–∞ —á–∞—Ç –æ—Ç–∫—Ä—ã—Ç ‚Äî sidebar –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–ª–∞—Å—Å–æ–º/inline —Å—Ç–∏–ª–µ–º) */
            #sidebar {
                z-index: 10;
            }

            #chatArea {
                z-index: 20;
            }

            /* –í–Ω—É—Ç—Ä–∏ chatArea –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç ‚Äî flex –∫–æ–ª–æ–Ω–∫–∞ –Ω–∞ –≤—Å—é –≤—ã—Å–æ—Ç—É */
            #chatArea.active {
                display: flex;
                flex-direction: column;
            }

            #activeChat.active {
                display: flex;
                flex: 1 1 auto;
                min-height: 0;
            }

            /* –°–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–∂–∏–º–∞—Ç—å—Å—è –∏ —Å–∫—Ä–æ–ª–ª–∏—Ç—å—Å—è –º–µ–∂–¥—É header –∏ input */
            #messagesContainer {
                flex: 1 1 auto;
                min-height: 0;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 24px;
            }

            /* –ò–Ω–ø—É—Ç –≤—Å–µ–≥–¥–∞ —Å–Ω–∏–∑—É –∏ –Ω–µ –≤—ã—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è */
            #messageInputArea {
                flex: 0 0 auto;
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
        }
        
        /* ===== –î–ï–°–ö–¢–û–ü ===== */
        @media (min-width: 769px) {
            #chatScreen.active {
                flex-direction: row;
            }
            
            #sidebar {
                position: relative;
                width: 100%;
                max-width: 100%;
                transition: all 0.3s ease;
            }
            
            #sidebar.chat-open {
                width: 384px;
                min-width: 384px;
                max-width: 384px;
                flex: 0 0 384px;
            }
            
            #chatArea {
                position: relative;
                flex: 1 1 auto;
            }
            
            #chatArea.active {
                display: flex;
            }
        }
        
        /* –§–∏–∫—Å –¥–ª—è iOS Safari */
        @supports (-webkit-touch-callout: none) {
            html, body {
                height: -webkit-fill-available;
            }
            #chatScreen, #chatArea, #sidebar, #activeChat {
                height: -webkit-fill-available;
            }
        }

        /* –î–æ–ø. —Ñ–∏–∫—Å –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–±–∏–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤: 100dvh/100svh */
        @supports (height: 100dvh) {
            html, body {
                height: 100dvh;
            }
            #chatScreen {
                height: 100dvh;
            }
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–∫—Å—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
        @media screen and (max-height: 500px) {
            #messageInputArea {
                padding: 8px;
            }
            #emojiPicker {
                max-height: 120px;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden">
    <!-- Auth Screen -->
    <div id="authScreen" class="h-full flex items-center justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <div class="w-20 h-20 gradient-bg rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg shadow-purple-500/30">
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white">FlashChat Pro</h1>
                <p class="text-gray-400 mt-2">–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</p>
            </div>
            
            <div id="savedAccounts" class="hidden mb-4">
                <p class="text-sm text-gray-400 mb-2">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã:</p>
                <div id="accountsList" class="space-y-2 max-h-32 overflow-y-auto"></div>
            </div>
            
            <div class="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-gray-700/50">
                <div class="flex mb-6 bg-gray-700/50 rounded-xl p-1">
                    <button onclick="showTab('login')" id="loginTab" class="flex-1 py-2 px-4 rounded-lg font-medium transition-all bg-purple-600 text-white">–í—Ö–æ–¥</button>
                    <button onclick="showTab('register')" id="registerTab" class="flex-1 py-2 px-4 rounded-lg font-medium transition-all text-gray-400">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
                
                <form id="loginForm" onsubmit="login(event)" class="space-y-4">
                    <input type="email" id="loginEmail" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="Email">
                    <input type="password" id="loginPassword" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="–ü–∞—Ä–æ–ª—å">
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="saveAccount" checked class="rounded">
                        <span>–ó–∞–ø–æ–º–Ω–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
                    </label>
                    <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-lg shadow-purple-500/30">–í–æ–π—Ç–∏</button>
                </form>
                
                <form id="registerForm" onsubmit="register(event)" class="space-y-4 hidden">
                    <input type="text" id="registerName" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                    <input type="email" id="registerEmail" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="Email">
                    <input type="password" id="registerPassword" required minlength="6" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)">
                    <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-lg shadow-purple-500/30">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                </form>
                
                <div id="authError" class="mt-4 text-red-400 text-sm text-center hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main Chat Screen -->
    <div id="chatScreen" class="h-full">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-gray-800/50 backdrop-blur-xl border-r border-gray-700/50 safe-top">
            <div class="p-3 border-b border-gray-700/50 flex-shrink-0">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-xl font-bold text-white">FlashChat</h2>
                    <div class="flex gap-1">
                        <button onclick="showCreateMenu()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="–°–æ–∑–¥–∞—Ç—å">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                        </button>
                        <button onclick="showAccountSwitcher()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="–ê–∫–∫–∞—É–Ω—Ç—ã">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                        <button onclick="showProfile()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="–ü—Ä–æ—Ñ–∏–ª—å">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex gap-1 mb-3 bg-gray-700/30 rounded-xl p-1">
                    <button onclick="showChatTab('all')" id="tabAll" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium bg-purple-600">–í—Å–µ</button>
                    <button onclick="showChatTab('private')" id="tabPrivate" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">–õ–∏—á–Ω—ã–µ</button>
                    <button onclick="showChatTab('groups')" id="tabGroups" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">–ì—Ä—É–ø–ø—ã</button>
                    <button onclick="showChatTab('channels')" id="tabChannels" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">–ö–∞–Ω–∞–ª—ã</button>
                </div>
                
                <div class="relative">
                    <input type="text" id="searchInput" oninput="searchAll()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 pl-10 focus:outline-none focus:border-purple-500 transition-colors text-sm" placeholder="–ü–æ–∏—Å–∫...">
                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
            </div>
            
            <div id="searchResults" class="hidden border-b border-gray-700/50 max-h-64 overflow-y-auto flex-shrink-0"></div>
            <div id="chatList" class="overflow-y-auto chat-scroll"></div>
        </div>
        
        <!-- Chat Area -->
        <div id="chatArea" class="bg-gray-900">
            <div id="emptyChat">
                <div class="text-center p-4">
                    <div class="w-24 h-24 bg-gray-800 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-12 h-12 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-400">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                    <p class="text-gray-500 mt-2">–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π</p>
                </div>
            </div>
            
            <div id="activeChat">
                <!-- Chat Header -->
                <div class="chat-header p-3 flex items-center gap-3 safe-top">
                    <button onclick="closeChat()" class="md:hidden p-2 hover:bg-gray-700/50 rounded-xl">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div id="chatAvatar" class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold flex-shrink-0"></div>
                    <div class="flex-1 min-w-0">
                        <h3 id="chatName" class="font-semibold truncate"></h3>
                        <p id="chatStatus" class="text-xs text-gray-400 truncate"></p>
                    </div>
                    <div id="chatHeaderActions" class="flex gap-1 flex-shrink-0"></div>
                </div>
                
                <!-- Messages Container -->
                <div id="messagesContainer" class="p-4 space-y-3 chat-scroll"></div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-4 py-2">
                    <div class="flex items-center gap-2 text-gray-400 text-sm">
                        <div class="flex gap-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        </div>
                        <span id="typingText">–ø–µ—á–∞—Ç–∞–µ—Ç...</span>
                    </div>
                </div>
                
                <!-- Upload Preview -->
                <div id="uploadPreview" class="hidden p-3 border-t border-gray-700/50 bg-gray-800/50">
                    <div class="flex flex-col gap-2">
                        <div class="flex items-start gap-3">
                            <img id="uploadPreviewImage" src="" class="w-20 h-20 object-cover rounded-xl hidden">
                            <div id="uploadPreviewFile" class="hidden flex items-center gap-2 p-2 bg-gray-700/50 rounded-xl">
                                <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span id="uploadFileName" class="text-sm truncate max-w-[150px]"></span>
                            </div>
                            <div class="flex-1 flex flex-col gap-2">
                                <input type="text" id="imageCaption" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-purple-500" placeholder="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å...">
                                <div id="uploadProgress" class="h-2 bg-gray-700 rounded-full overflow-hidden hidden">
                                    <div id="uploadProgressBar" class="h-full gradient-bg file-upload-progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <button onclick="cancelUpload()" class="p-2 hover:bg-gray-700/50 rounded-xl text-gray-400 shrink-0">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        <button onclick="sendFileWithCaption()" class="w-full gradient-bg py-2 rounded-xl font-medium text-sm hover:opacity-90 transition-opacity">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                    </div>
                </div>
                
                <!-- Message Input -->
                <div id="messageInputArea">
                    <form onsubmit="sendMessage(event)">
                        <input type="file" id="fileInput" class="hidden" accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.zip,.rar" onchange="handleFileSelect(event)">
                        
                        <button type="button" onclick="openFilePicker()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                            </svg>
                        </button>
                        
                        <button type="button" onclick="toggleEmoji()" title="–≠–º–æ–¥–∑–∏">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </button>
                        
                        <input type="text" id="messageInput" oninput="handleTyping()" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                        
                        <button type="submit" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </form>
                    
                    <div id="emojiPicker" class="hidden mt-2 bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                        <div class="flex border-b border-gray-700 bg-gray-800/50">
                            <button type="button" onclick="showEmojiCategory('smileys')" id="emojiCatSmileys" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-purple-500">üòÄ</button>
                            <button type="button" onclick="showEmojiCategory('gestures')" id="emojiCatGestures" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">üëã</button>
                            <button type="button" onclick="showEmojiCategory('animals')" id="emojiCatAnimals" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">üê±</button>
                            <button type="button" onclick="showEmojiCategory('food')" id="emojiCatFood" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">üçï</button>
                            <button type="button" onclick="showEmojiCategory('activities')" id="emojiCatActivities" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">‚öΩ</button>
                            <button type="button" onclick="showEmojiCategory('travel')" id="emojiCatTravel" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">üöó</button>
                            <button type="button" onclick="showEmojiCategory('objects')" id="emojiCatObjects" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">üí°</button>
                            <button type="button" onclick="showEmojiCategory('symbols')" id="emojiCatSymbols" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">‚ù§Ô∏è</button>
                        </div>
                        <!-- –≠–º–æ–¥–∑–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                        <div id="emojiContainer" class="p-2 max-h-48 overflow-y-auto chat-scroll">
                            <div id="emojiSmileys" class="grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('üòÄ')" class="hover:bg-gray-600 rounded p-1">üòÄ</button>
                                <button type="button" onclick="addEmoji('üòÉ')" class="hover:bg-gray-600 rounded p-1">üòÉ</button>
                                <button type="button" onclick="addEmoji('üòÑ')" class="hover:bg-gray-600 rounded p-1">üòÑ</button>
                                <button type="button" onclick="addEmoji('üòÅ')" class="hover:bg-gray-600 rounded p-1">üòÅ</button>
                                <button type="button" onclick="addEmoji('üòÖ')" class="hover:bg-gray-600 rounded p-1">üòÖ</button>
                                <button type="button" onclick="addEmoji('üòÇ')" class="hover:bg-gray-600 rounded p-1">üòÇ</button>
                                <button type="button" onclick="addEmoji('ü§£')" class="hover:bg-gray-600 rounded p-1">ü§£</button>
                                <button type="button" onclick="addEmoji('üòä')" class="hover:bg-gray-600 rounded p-1">üòä</button>
                                <button type="button" onclick="addEmoji('üòá')" class="hover:bg-gray-600 rounded p-1">üòá</button>
                                <button type="button" onclick="addEmoji('üôÇ')" class="hover:bg-gray-600 rounded p-1">üôÇ</button>
                                <button type="button" onclick="addEmoji('üòâ')" class="hover:bg-gray-600 rounded p-1">üòâ</button>
                                <button type="button" onclick="addEmoji('üòå')" class="hover:bg-gray-600 rounded p-1">üòå</button>
                                <button type="button" onclick="addEmoji('üòç')" class="hover:bg-gray-600 rounded p-1">üòç</button>
                                <button type="button" onclick="addEmoji('ü•∞')" class="hover:bg-gray-600 rounded p-1">ü•∞</button>
                                <button type="button" onclick="addEmoji('üòò')" class="hover:bg-gray-600 rounded p-1">üòò</button>
                                <button type="button" onclick="addEmoji('üòó')" class="hover:bg-gray-600 rounded p-1">üòó</button>
                                <button type="button" onclick="addEmoji('üòã')" class="hover:bg-gray-600 rounded p-1">üòã</button>
                                <button type="button" onclick="addEmoji('üòõ')" class="hover:bg-gray-600 rounded p-1">üòõ</button>
                                <button type="button" onclick="addEmoji('üòú')" class="hover:bg-gray-600 rounded p-1">üòú</button>
                                <button type="button" onclick="addEmoji('ü§™')" class="hover:bg-gray-600 rounded p-1">ü§™</button>
                                <button type="button" onclick="addEmoji('üòù')" class="hover:bg-gray-600 rounded p-1">üòù</button>
                                <button type="button" onclick="addEmoji('ü§ë')" class="hover:bg-gray-600 rounded p-1">ü§ë</button>
                                <button type="button" onclick="addEmoji('ü§ó')" class="hover:bg-gray-600 rounded p-1">ü§ó</button>
                                <button type="button" onclick="addEmoji('ü§≠')" class="hover:bg-gray-600 rounded p-1">ü§≠</button>
                                <button type="button" onclick="addEmoji('ü§´')" class="hover:bg-gray-600 rounded p-1">ü§´</button>
                                <button type="button" onclick="addEmoji('ü§î')" class="hover:bg-gray-600 rounded p-1">ü§î</button>
                                <button type="button" onclick="addEmoji('ü§ê')" class="hover:bg-gray-600 rounded p-1">ü§ê</button>
                                <button type="button" onclick="addEmoji('ü§®')" class="hover:bg-gray-600 rounded p-1">ü§®</button>
                                <button type="button" onclick="addEmoji('üòê')" class="hover:bg-gray-600 rounded p-1">üòê</button>
                                <button type="button" onclick="addEmoji('üòë')" class="hover:bg-gray-600 rounded p-1">üòë</button>
                                <button type="button" onclick="addEmoji('üò∂')" class="hover:bg-gray-600 rounded p-1">üò∂</button>
                                <button type="button" onclick="addEmoji('üòè')" class="hover:bg-gray-600 rounded p-1">üòè</button>
                                <button type="button" onclick="addEmoji('üòí')" class="hover:bg-gray-600 rounded p-1">üòí</button>
                                <button type="button" onclick="addEmoji('üôÑ')" class="hover:bg-gray-600 rounded p-1">üôÑ</button>
                                <button type="button" onclick="addEmoji('üò¨')" class="hover:bg-gray-600 rounded p-1">üò¨</button>
                                <button type="button" onclick="addEmoji('ü§•')" class="hover:bg-gray-600 rounded p-1">ü§•</button>
                                <button type="button" onclick="addEmoji('üòå')" class="hover:bg-gray-600 rounded p-1">üòå</button>
                                <button type="button" onclick="addEmoji('üòî')" class="hover:bg-gray-600 rounded p-1">üòî</button>
                                <button type="button" onclick="addEmoji('üò™')" class="hover:bg-gray-600 rounded p-1">üò™</button>
                                <button type="button" onclick="addEmoji('ü§§')" class="hover:bg-gray-600 rounded p-1">ü§§</button>
                                <button type="button" onclick="addEmoji('üò¥')" class="hover:bg-gray-600 rounded p-1">üò¥</button>
                                <button type="button" onclick="addEmoji('üò∑')" class="hover:bg-gray-600 rounded p-1">üò∑</button>
                                <button type="button" onclick="addEmoji('ü§í')" class="hover:bg-gray-600 rounded p-1">ü§í</button>
                                <button type="button" onclick="addEmoji('ü§ï')" class="hover:bg-gray-600 rounded p-1">ü§ï</button>
                                <button type="button" onclick="addEmoji('ü§¢')" class="hover:bg-gray-600 rounded p-1">ü§¢</button>
                                <button type="button" onclick="addEmoji('ü§Æ')" class="hover:bg-gray-600 rounded p-1">ü§Æ</button>
                                <button type="button" onclick="addEmoji('ü•µ')" class="hover:bg-gray-600 rounded p-1">ü•µ</button>
                                <button type="button" onclick="addEmoji('ü•∂')" class="hover:bg-gray-600 rounded p-1">ü•∂</button>
                                <button type="button" onclick="addEmoji('ü•¥')" class="hover:bg-gray-600 rounded p-1">ü•¥</button>
                                <button type="button" onclick="addEmoji('üòµ')" class="hover:bg-gray-600 rounded p-1">üòµ</button>
                                <button type="button" onclick="addEmoji('ü§Ø')" class="hover:bg-gray-600 rounded p-1">ü§Ø</button>
                                <button type="button" onclick="addEmoji('ü§†')" class="hover:bg-gray-600 rounded p-1">ü§†</button>
                                <button type="button" onclick="addEmoji('ü•≥')" class="hover:bg-gray-600 rounded p-1">ü•≥</button>
                                <button type="button" onclick="addEmoji('üòé')" class="hover:bg-gray-600 rounded p-1">üòé</button>
                                <button type="button" onclick="addEmoji('ü§ì')" class="hover:bg-gray-600 rounded p-1">ü§ì</button>
                                <button type="button" onclick="addEmoji('üßê')" class="hover:bg-gray-600 rounded p-1">üßê</button>
                                <button type="button" onclick="addEmoji('üòï')" class="hover:bg-gray-600 rounded p-1">üòï</button>
                                <button type="button" onclick="addEmoji('üòü')" class="hover:bg-gray-600 rounded p-1">üòü</button>
                                <button type="button" onclick="addEmoji('üôÅ')" class="hover:bg-gray-600 rounded p-1">üôÅ</button>
                                <button type="button" onclick="addEmoji('üòÆ')" class="hover:bg-gray-600 rounded p-1">üòÆ</button>
                                <button type="button" onclick="addEmoji('üòØ')" class="hover:bg-gray-600 rounded p-1">üòØ</button>
                                <button type="button" onclick="addEmoji('üò≤')" class="hover:bg-gray-600 rounded p-1">üò≤</button>
                                <button type="button" onclick="addEmoji('üò≥')" class="hover:bg-gray-600 rounded p-1">üò≥</button>
                                <button type="button" onclick="addEmoji('ü•∫')" class="hover:bg-gray-600 rounded p-1">ü•∫</button>
                                <button type="button" onclick="addEmoji('üò¶')" class="hover:bg-gray-600 rounded p-1">üò¶</button>
                                <button type="button" onclick="addEmoji('üòß')" class="hover:bg-gray-600 rounded p-1">üòß</button>
                                <button type="button" onclick="addEmoji('üò®')" class="hover:bg-gray-600 rounded p-1">üò®</button>
                                <button type="button" onclick="addEmoji('üò∞')" class="hover:bg-gray-600 rounded p-1">üò∞</button>
                                <button type="button" onclick="addEmoji('üò•')" class="hover:bg-gray-600 rounded p-1">üò•</button>
                                <button type="button" onclick="addEmoji('üò¢')" class="hover:bg-gray-600 rounded p-1">üò¢</button>
                                <button type="button" onclick="addEmoji('üò≠')" class="hover:bg-gray-600 rounded p-1">üò≠</button>
                                <button type="button" onclick="addEmoji('üò±')" class="hover:bg-gray-600 rounded p-1">üò±</button>
                                <button type="button" onclick="addEmoji('üòñ')" class="hover:bg-gray-600 rounded p-1">üòñ</button>
                                <button type="button" onclick="addEmoji('üò£')" class="hover:bg-gray-600 rounded p-1">üò£</button>
                                <button type="button" onclick="addEmoji('üòû')" class="hover:bg-gray-600 rounded p-1">üòû</button>
                                <button type="button" onclick="addEmoji('üòì')" class="hover:bg-gray-600 rounded p-1">üòì</button>
                                <button type="button" onclick="addEmoji('üò©')" class="hover:bg-gray-600 rounded p-1">üò©</button>
                                <button type="button" onclick="addEmoji('üò´')" class="hover:bg-gray-600 rounded p-1">üò´</button>
                                <button type="button" onclick="addEmoji('ü•±')" class="hover:bg-gray-600 rounded p-1">ü•±</button>
                                <button type="button" onclick="addEmoji('üò§')" class="hover:bg-gray-600 rounded p-1">üò§</button>
                                <button type="button" onclick="addEmoji('üò°')" class="hover:bg-gray-600 rounded p-1">üò°</button>
                                <button type="button" onclick="addEmoji('üò†')" class="hover:bg-gray-600 rounded p-1">üò†</button>
                                <button type="button" onclick="addEmoji('ü§¨')" class="hover:bg-gray-600 rounded p-1">ü§¨</button>
                                <button type="button" onclick="addEmoji('üòà')" class="hover:bg-gray-600 rounded p-1">üòà</button>
                                <button type="button" onclick="addEmoji('üëø')" class="hover:bg-gray-600 rounded p-1">üëø</button>
                                <button type="button" onclick="addEmoji('üíÄ')" class="hover:bg-gray-600 rounded p-1">üíÄ</button>
                                <button type="button" onclick="addEmoji('‚ò†Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ò†Ô∏è</button>
                                <button type="button" onclick="addEmoji('üí©')" class="hover:bg-gray-600 rounded p-1">üí©</button>
                                <button type="button" onclick="addEmoji('ü§°')" class="hover:bg-gray-600 rounded p-1">ü§°</button>
                                <button type="button" onclick="addEmoji('üëπ')" class="hover:bg-gray-600 rounded p-1">üëπ</button>
                                <button type="button" onclick="addEmoji('üë∫')" class="hover:bg-gray-600 rounded p-1">üë∫</button>
                                <button type="button" onclick="addEmoji('üëª')" class="hover:bg-gray-600 rounded p-1">üëª</button>
                                <button type="button" onclick="addEmoji('üëΩ')" class="hover:bg-gray-600 rounded p-1">üëΩ</button>
                                <button type="button" onclick="addEmoji('üëæ')" class="hover:bg-gray-600 rounded p-1">üëæ</button>
                                <button type="button" onclick="addEmoji('ü§ñ')" class="hover:bg-gray-600 rounded p-1">ü§ñ</button>
                            </div>
                            <div id="emojiGestures" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('üëã')" class="hover:bg-gray-600 rounded p-1">üëã</button>
                                <button type="button" onclick="addEmoji('ü§ö')" class="hover:bg-gray-600 rounded p-1">ü§ö</button>
                                <button type="button" onclick="addEmoji('üñêÔ∏è')" class="hover:bg-gray-600 rounded p-1">üñêÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚úã')" class="hover:bg-gray-600 rounded p-1">‚úã</button>
                                <button type="button" onclick="addEmoji('üññ')" class="hover:bg-gray-600 rounded p-1">üññ</button>
                                <button type="button" onclick="addEmoji('üëå')" class="hover:bg-gray-600 rounded p-1">üëå</button>
                                <button type="button" onclick="addEmoji('ü§å')" class="hover:bg-gray-600 rounded p-1">ü§å</button>
                                <button type="button" onclick="addEmoji('ü§è')" class="hover:bg-gray-600 rounded p-1">ü§è</button>
                                <button type="button" onclick="addEmoji('‚úåÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úåÔ∏è</button>
                                <button type="button" onclick="addEmoji('ü§û')" class="hover:bg-gray-600 rounded p-1">ü§û</button>
                                <button type="button" onclick="addEmoji('ü§ü')" class="hover:bg-gray-600 rounded p-1">ü§ü</button>
                                <button type="button" onclick="addEmoji('ü§ò')" class="hover:bg-gray-600 rounded p-1">ü§ò</button>
                                <button type="button" onclick="addEmoji('ü§ô')" class="hover:bg-gray-600 rounded p-1">ü§ô</button>
                                <button type="button" onclick="addEmoji('üëà')" class="hover:bg-gray-600 rounded p-1">üëà</button>
                                <button type="button" onclick="addEmoji('üëâ')" class="hover:bg-gray-600 rounded p-1">üëâ</button>
                                <button type="button" onclick="addEmoji('üëÜ')" class="hover:bg-gray-600 rounded p-1">üëÜ</button>
                                <button type="button" onclick="addEmoji('üñï')" class="hover:bg-gray-600 rounded p-1">üñï</button>
                                <button type="button" onclick="addEmoji('üëá')" class="hover:bg-gray-600 rounded p-1">üëá</button>
                                <button type="button" onclick="addEmoji('‚òùÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚òùÔ∏è</button>
                                <button type="button" onclick="addEmoji('üëç')" class="hover:bg-gray-600 rounded p-1">üëç</button>
                                <button type="button" onclick="addEmoji('üëé')" class="hover:bg-gray-600 rounded p-1">üëé</button>
                                <button type="button" onclick="addEmoji('‚úä')" class="hover:bg-gray-600 rounded p-1">‚úä</button>
                                <button type="button" onclick="addEmoji('üëä')" class="hover:bg-gray-600 rounded p-1">üëä</button>
                                <button type="button" onclick="addEmoji('ü§õ')" class="hover:bg-gray-600 rounded p-1">ü§õ</button>
                                <button type="button" onclick="addEmoji('ü§ú')" class="hover:bg-gray-600 rounded p-1">ü§ú</button>
                                <button type="button" onclick="addEmoji('üëè')" class="hover:bg-gray-600 rounded p-1">üëè</button>
                                <button type="button" onclick="addEmoji('üôå')" class="hover:bg-gray-600 rounded p-1">üôå</button>
                                <button type="button" onclick="addEmoji('üëê')" class="hover:bg-gray-600 rounded p-1">üëê</button>
                                <button type="button" onclick="addEmoji('ü§≤')" class="hover:bg-gray-600 rounded p-1">ü§≤</button>
                                <button type="button" onclick="addEmoji('ü§ù')" class="hover:bg-gray-600 rounded p-1">ü§ù</button>
                                <button type="button" onclick="addEmoji('üôè')" class="hover:bg-gray-600 rounded p-1">üôè</button>
                                <button type="button" onclick="addEmoji('‚úçÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úçÔ∏è</button>
                                <button type="button" onclick="addEmoji('üíÖ')" class="hover:bg-gray-600 rounded p-1">üíÖ</button>
                                <button type="button" onclick="addEmoji('ü§≥')" class="hover:bg-gray-600 rounded p-1">ü§≥</button>
                                <button type="button" onclick="addEmoji('üí™')" class="hover:bg-gray-600 rounded p-1">üí™</button>
                                <button type="button" onclick="addEmoji('ü¶æ')" class="hover:bg-gray-600 rounded p-1">ü¶æ</button>
                                <button type="button" onclick="addEmoji('ü¶ø')" class="hover:bg-gray-600 rounded p-1">ü¶ø</button>
                                <button type="button" onclick="addEmoji('ü¶µ')" class="hover:bg-gray-600 rounded p-1">ü¶µ</button>
                                <button type="button" onclick="addEmoji('ü¶∂')" class="hover:bg-gray-600 rounded p-1">ü¶∂</button>
                                <button type="button" onclick="addEmoji('üëÇ')" class="hover:bg-gray-600 rounded p-1">üëÇ</button>
                                <button type="button" onclick="addEmoji('üëÉ')" class="hover:bg-gray-600 rounded p-1">üëÉ</button>
                                <button type="button" onclick="addEmoji('üëÄ')" class="hover:bg-gray-600 rounded p-1">üëÄ</button>
                                <button type="button" onclick="addEmoji('üëÅÔ∏è')" class="hover:bg-gray-600 rounded p-1">üëÅÔ∏è</button>
                                <button type="button" onclick="addEmoji('üëÖ')" class="hover:bg-gray-600 rounded p-1">üëÖ</button>
                                <button type="button" onclick="addEmoji('üëÑ')" class="hover:bg-gray-600 rounded p-1">üëÑ</button>
                                <button type="button" onclick="addEmoji('üíã')" class="hover:bg-gray-600 rounded p-1">üíã</button>
                                <button type="button" onclick="addEmoji('üß†')" class="hover:bg-gray-600 rounded p-1">üß†</button>
                                <button type="button" onclick="addEmoji('ü´Ä')" class="hover:bg-gray-600 rounded p-1">ü´Ä</button>
                            </div>
                            <div id="emojiAnimals" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('üê∂')" class="hover:bg-gray-600 rounded p-1">üê∂</button>
                                <button type="button" onclick="addEmoji('üê±')" class="hover:bg-gray-600 rounded p-1">üê±</button>
                                <button type="button" onclick="addEmoji('üê≠')" class="hover:bg-gray-600 rounded p-1">üê≠</button>
                                <button type="button" onclick="addEmoji('üêπ')" class="hover:bg-gray-600 rounded p-1">üêπ</button>
                                <button type="button" onclick="addEmoji('üê∞')" class="hover:bg-gray-600 rounded p-1">üê∞</button>
                                <button type="button" onclick="addEmoji('ü¶ä')" class="hover:bg-gray-600 rounded p-1">ü¶ä</button>
                                <button type="button" onclick="addEmoji('üêª')" class="hover:bg-gray-600 rounded p-1">üêª</button>
                                <button type="button" onclick="addEmoji('üêº')" class="hover:bg-gray-600 rounded p-1">üêº</button>
                                <button type="button" onclick="addEmoji('üê®')" class="hover:bg-gray-600 rounded p-1">üê®</button>
                                <button type="button" onclick="addEmoji('üêØ')" class="hover:bg-gray-600 rounded p-1">üêØ</button>
                                <button type="button" onclick="addEmoji('ü¶Å')" class="hover:bg-gray-600 rounded p-1">ü¶Å</button>
                                <button type="button" onclick="addEmoji('üêÆ')" class="hover:bg-gray-600 rounded p-1">üêÆ</button>
                                <button type="button" onclick="addEmoji('üê∑')" class="hover:bg-gray-600 rounded p-1">üê∑</button>
                                <button type="button" onclick="addEmoji('üê∏')" class="hover:bg-gray-600 rounded p-1">üê∏</button>
                                <button type="button" onclick="addEmoji('üêµ')" class="hover:bg-gray-600 rounded p-1">üêµ</button>
                                <button type="button" onclick="addEmoji('üôà')" class="hover:bg-gray-600 rounded p-1">üôà</button>
                                <button type="button" onclick="addEmoji('üôâ')" class="hover:bg-gray-600 rounded p-1">üôâ</button>
                                <button type="button" onclick="addEmoji('üôä')" class="hover:bg-gray-600 rounded p-1">üôä</button>
                                <button type="button" onclick="addEmoji('üêí')" class="hover:bg-gray-600 rounded p-1">üêí</button>
                                <button type="button" onclick="addEmoji('üêî')" class="hover:bg-gray-600 rounded p-1">üêî</button>
                                <button type="button" onclick="addEmoji('üêß')" class="hover:bg-gray-600 rounded p-1">üêß</button>
                                <button type="button" onclick="addEmoji('üê¶')" class="hover:bg-gray-600 rounded p-1">üê¶</button>
                                <button type="button" onclick="addEmoji('üê§')" class="hover:bg-gray-600 rounded p-1">üê§</button>
                                <button type="button" onclick="addEmoji('ü¶Ü')" class="hover:bg-gray-600 rounded p-1">ü¶Ü</button>
                                <button type="button" onclick="addEmoji('ü¶Ö')" class="hover:bg-gray-600 rounded p-1">ü¶Ö</button>
                                <button type="button" onclick="addEmoji('ü¶â')" class="hover:bg-gray-600 rounded p-1">ü¶â</button>
                                <button type="button" onclick="addEmoji('ü¶á')" class="hover:bg-gray-600 rounded p-1">ü¶á</button>
                                <button type="button" onclick="addEmoji('üê∫')" class="hover:bg-gray-600 rounded p-1">üê∫</button>
                                <button type="button" onclick="addEmoji('üêó')" class="hover:bg-gray-600 rounded p-1">üêó</button>
                                <button type="button" onclick="addEmoji('üê¥')" class="hover:bg-gray-600 rounded p-1">üê¥</button>
                                <button type="button" onclick="addEmoji('ü¶Ñ')" class="hover:bg-gray-600 rounded p-1">ü¶Ñ</button>
                                <button type="button" onclick="addEmoji('üêù')" class="hover:bg-gray-600 rounded p-1">üêù</button>
                                <button type="button" onclick="addEmoji('üêõ')" class="hover:bg-gray-600 rounded p-1">üêõ</button>
                                <button type="button" onclick="addEmoji('ü¶ã')" class="hover:bg-gray-600 rounded p-1">ü¶ã</button>
                                <button type="button" onclick="addEmoji('üêå')" class="hover:bg-gray-600 rounded p-1">üêå</button>
                                <button type="button" onclick="addEmoji('üêû')" class="hover:bg-gray-600 rounded p-1">üêû</button>
                                <button type="button" onclick="addEmoji('üêú')" class="hover:bg-gray-600 rounded p-1">üêú</button>
                                <button type="button" onclick="addEmoji('ü¶ü')" class="hover:bg-gray-600 rounded p-1">ü¶ü</button>
                                <button type="button" onclick="addEmoji('üê¢')" class="hover:bg-gray-600 rounded p-1">üê¢</button>
                                <button type="button" onclick="addEmoji('üêç')" class="hover:bg-gray-600 rounded p-1">üêç</button>
                                <button type="button" onclick="addEmoji('ü¶é')" class="hover:bg-gray-600 rounded p-1">ü¶é</button>
                                <button type="button" onclick="addEmoji('ü¶ñ')" class="hover:bg-gray-600 rounded p-1">ü¶ñ</button>
                                <button type="button" onclick="addEmoji('ü¶ï')" class="hover:bg-gray-600 rounded p-1">ü¶ï</button>
                                <button type="button" onclick="addEmoji('üêô')" class="hover:bg-gray-600 rounded p-1">üêô</button>
                                <button type="button" onclick="addEmoji('ü¶ë')" class="hover:bg-gray-600 rounded p-1">ü¶ë</button>
                                <button type="button" onclick="addEmoji('ü¶ê')" class="hover:bg-gray-600 rounded p-1">ü¶ê</button>
                                <button type="button" onclick="addEmoji('ü¶û')" class="hover:bg-gray-600 rounded p-1">ü¶û</button>
                                <button type="button" onclick="addEmoji('ü¶Ä')" class="hover:bg-gray-600 rounded p-1">ü¶Ä</button>
                                <button type="button" onclick="addEmoji('üê°')" class="hover:bg-gray-600 rounded p-1">üê°</button>
                                <button type="button" onclick="addEmoji('üê†')" class="hover:bg-gray-600 rounded p-1">üê†</button>
                                <button type="button" onclick="addEmoji('üêü')" class="hover:bg-gray-600 rounded p-1">üêü</button>
                                <button type="button" onclick="addEmoji('üê¨')" class="hover:bg-gray-600 rounded p-1">üê¨</button>
                                <button type="button" onclick="addEmoji('üê≥')" class="hover:bg-gray-600 rounded p-1">üê≥</button>
                                <button type="button" onclick="addEmoji('ü¶à')" class="hover:bg-gray-600 rounded p-1">ü¶à</button>
                                <button type="button" onclick="addEmoji('üêä')" class="hover:bg-gray-600 rounded p-1">üêä</button>
                                <button type="button" onclick="addEmoji('üêÖ')" class="hover:bg-gray-600 rounded p-1">üêÖ</button>
                            </div>
                            <div id="emojiFood" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('üçè')" class="hover:bg-gray-600 rounded p-1">üçè</button>
                                <button type="button" onclick="addEmoji('üçé')" class="hover:bg-gray-600 rounded p-1">üçé</button>
                                <button type="button" onclick="addEmoji('üçê')" class="hover:bg-gray-600 rounded p-1">üçê</button>
                                <button type="button" onclick="addEmoji('üçä')" class="hover:bg-gray-600 rounded p-1">üçä</button>
                                <button type="button" onclick="addEmoji('üçã')" class="hover:bg-gray-600 rounded p-1">üçã</button>
                                <button type="button" onclick="addEmoji('üçå')" class="hover:bg-gray-600 rounded p-1">üçå</button>
                                <button type="button" onclick="addEmoji('üçâ')" class="hover:bg-gray-600 rounded p-1">üçâ</button>
                                <button type="button" onclick="addEmoji('üçá')" class="hover:bg-gray-600 rounded p-1">üçá</button>
                                <button type="button" onclick="addEmoji('üçì')" class="hover:bg-gray-600 rounded p-1">üçì</button>
                                <button type="button" onclick="addEmoji('ü´ê')" class="hover:bg-gray-600 rounded p-1">ü´ê</button>
                                <button type="button" onclick="addEmoji('üçà')" class="hover:bg-gray-600 rounded p-1">üçà</button>
                                <button type="button" onclick="addEmoji('üçí')" class="hover:bg-gray-600 rounded p-1">üçí</button>
                                <button type="button" onclick="addEmoji('üçë')" class="hover:bg-gray-600 rounded p-1">üçë</button>
                                <button type="button" onclick="addEmoji('ü•≠')" class="hover:bg-gray-600 rounded p-1">ü•≠</button>
                                <button type="button" onclick="addEmoji('üçç')" class="hover:bg-gray-600 rounded p-1">üçç</button>
                                <button type="button" onclick="addEmoji('ü••')" class="hover:bg-gray-600 rounded p-1">ü••</button>
                                <button type="button" onclick="addEmoji('ü•ù')" class="hover:bg-gray-600 rounded p-1">ü•ù</button>
                                <button type="button" onclick="addEmoji('üçÖ')" class="hover:bg-gray-600 rounded p-1">üçÖ</button>
                                <button type="button" onclick="addEmoji('ü•ë')" class="hover:bg-gray-600 rounded p-1">ü•ë</button>
                                <button type="button" onclick="addEmoji('üçÜ')" class="hover:bg-gray-600 rounded p-1">üçÜ</button>
                                <button type="button" onclick="addEmoji('ü•î')" class="hover:bg-gray-600 rounded p-1">ü•î</button>
                                <button type="button" onclick="addEmoji('ü•ï')" class="hover:bg-gray-600 rounded p-1">ü•ï</button>
                                <button type="button" onclick="addEmoji('üåΩ')" class="hover:bg-gray-600 rounded p-1">üåΩ</button>
                                <button type="button" onclick="addEmoji('üå∂Ô∏è')" class="hover:bg-gray-600 rounded p-1">üå∂Ô∏è</button>
                                <button type="button" onclick="addEmoji('ü•í')" class="hover:bg-gray-600 rounded p-1">ü•í</button>
                                <button type="button" onclick="addEmoji('ü•¨')" class="hover:bg-gray-600 rounded p-1">ü•¨</button>
                                <button type="button" onclick="addEmoji('üßÑ')" class="hover:bg-gray-600 rounded p-1">üßÑ</button>
                                <button type="button" onclick="addEmoji('üßÖ')" class="hover:bg-gray-600 rounded p-1">üßÖ</button>
                                <button type="button" onclick="addEmoji('üçÑ')" class="hover:bg-gray-600 rounded p-1">üçÑ</button>
                                <button type="button" onclick="addEmoji('ü•ú')" class="hover:bg-gray-600 rounded p-1">ü•ú</button>
                                <button type="button" onclick="addEmoji('üçû')" class="hover:bg-gray-600 rounded p-1">üçû</button>
                                <button type="button" onclick="addEmoji('ü•ê')" class="hover:bg-gray-600 rounded p-1">ü•ê</button>
                                <button type="button" onclick="addEmoji('ü•ñ')" class="hover:bg-gray-600 rounded p-1">ü•ñ</button>
                                <button type="button" onclick="addEmoji('ü•®')" class="hover:bg-gray-600 rounded p-1">ü•®</button>
                                <button type="button" onclick="addEmoji('üßÄ')" class="hover:bg-gray-600 rounded p-1">üßÄ</button>
                                <button type="button" onclick="addEmoji('ü•ö')" class="hover:bg-gray-600 rounded p-1">ü•ö</button>
                                <button type="button" onclick="addEmoji('üç≥')" class="hover:bg-gray-600 rounded p-1">üç≥</button>
                                <button type="button" onclick="addEmoji('ü•ì')" class="hover:bg-gray-600 rounded p-1">ü•ì</button>
                                <button type="button" onclick="addEmoji('ü•©')" class="hover:bg-gray-600 rounded p-1">ü•©</button>
                                <button type="button" onclick="addEmoji('üçó')" class="hover:bg-gray-600 rounded p-1">üçó</button>
                                <button type="button" onclick="addEmoji('üçñ')" class="hover:bg-gray-600 rounded p-1">üçñ</button>
                                <button type="button" onclick="addEmoji('üå≠')" class="hover:bg-gray-600 rounded p-1">üå≠</button>
                                <button type="button" onclick="addEmoji('üçî')" class="hover:bg-gray-600 rounded p-1">üçî</button>
                                <button type="button" onclick="addEmoji('üçü')" class="hover:bg-gray-600 rounded p-1">üçü</button>
                                <button type="button" onclick="addEmoji('üçï')" class="hover:bg-gray-600 rounded p-1">üçï</button>
                                <button type="button" onclick="addEmoji('ü•™')" class="hover:bg-gray-600 rounded p-1">ü•™</button>
                                <button type="button" onclick="addEmoji('üåÆ')" class="hover:bg-gray-600 rounded p-1">üåÆ</button>
                                <button type="button" onclick="addEmoji('üåØ')" class="hover:bg-gray-600 rounded p-1">üåØ</button>
                                <button type="button" onclick="addEmoji('ü•ô')" class="hover:bg-gray-600 rounded p-1">ü•ô</button>
                                <button type="button" onclick="addEmoji('üßÜ')" class="hover:bg-gray-600 rounded p-1">üßÜ</button>
                                <button type="button" onclick="addEmoji('ü•ó')" class="hover:bg-gray-600 rounded p-1">ü•ó</button>
                                <button type="button" onclick="addEmoji('üçù')" class="hover:bg-gray-600 rounded p-1">üçù</button>
                                <button type="button" onclick="addEmoji('üçú')" class="hover:bg-gray-600 rounded p-1">üçú</button>
                                <button type="button" onclick="addEmoji('üç≤')" class="hover:bg-gray-600 rounded p-1">üç≤</button>
                                <button type="button" onclick="addEmoji('üçõ')" class="hover:bg-gray-600 rounded p-1">üçõ</button>
                                <button type="button" onclick="addEmoji('üç£')" class="hover:bg-gray-600 rounded p-1">üç£</button>
                                <button type="button" onclick="addEmoji('üç±')" class="hover:bg-gray-600 rounded p-1">üç±</button>
                                <button type="button" onclick="addEmoji('üçô')" class="hover:bg-gray-600 rounded p-1">üçô</button>
                                <button type="button" onclick="addEmoji('üçö')" class="hover:bg-gray-600 rounded p-1">üçö</button>
                                <button type="button" onclick="addEmoji('üçò')" class="hover:bg-gray-600 rounded p-1">üçò</button>
                                <button type="button" onclick="addEmoji('üç•')" class="hover:bg-gray-600 rounded p-1">üç•</button>
                                <button type="button" onclick="addEmoji('ü•Æ')" class="hover:bg-gray-600 rounded p-1">ü•Æ</button>
                                <button type="button" onclick="addEmoji('üç¢')" class="hover:bg-gray-600 rounded p-1">üç¢</button>
                                <button type="button" onclick="addEmoji('üçß')" class="hover:bg-gray-600 rounded p-1">üçß</button>
                                <button type="button" onclick="addEmoji('üç®')" class="hover:bg-gray-600 rounded p-1">üç®</button>
                                <button type="button" onclick="addEmoji('üç¶')" class="hover:bg-gray-600 rounded p-1">üç¶</button>
                                <button type="button" onclick="addEmoji('ü•ß')" class="hover:bg-gray-600 rounded p-1">ü•ß</button>
                                <button type="button" onclick="addEmoji('üßÅ')" class="hover:bg-gray-600 rounded p-1">üßÅ</button>
                                <button type="button" onclick="addEmoji('üç∞')" class="hover:bg-gray-600 rounded p-1">üç∞</button>
                                <button type="button" onclick="addEmoji('üéÇ')" class="hover:bg-gray-600 rounded p-1">üéÇ</button>
                                <button type="button" onclick="addEmoji('üçÆ')" class="hover:bg-gray-600 rounded p-1">üçÆ</button>
                                <button type="button" onclick="addEmoji('üç≠')" class="hover:bg-gray-600 rounded p-1">üç≠</button>
                                <button type="button" onclick="addEmoji('üç¨')" class="hover:bg-gray-600 rounded p-1">üç¨</button>
                                <button type="button" onclick="addEmoji('üç´')" class="hover:bg-gray-600 rounded p-1">üç´</button>
                                <button type="button" onclick="addEmoji('üçø')" class="hover:bg-gray-600 rounded p-1">üçø</button>
                                <button type="button" onclick="addEmoji('üç©')" class="hover:bg-gray-600 rounded p-1">üç©</button>
                                <button type="button" onclick="addEmoji('üç™')" class="hover:bg-gray-600 rounded p-1">üç™</button>
                                <button type="button" onclick="addEmoji('‚òï')" class="hover:bg-gray-600 rounded p-1">‚òï</button>
                                <button type="button" onclick="addEmoji('üçµ')" class="hover:bg-gray-600 rounded p-1">üçµ</button>
                                <button type="button" onclick="addEmoji('üßÉ')" class="hover:bg-gray-600 rounded p-1">üßÉ</button>
                                <button type="button" onclick="addEmoji('ü•§')" class="hover:bg-gray-600 rounded p-1">ü•§</button>
                                <button type="button" onclick="addEmoji('üßã')" class="hover:bg-gray-600 rounded p-1">üßã</button>
                                <button type="button" onclick="addEmoji('üç∫')" class="hover:bg-gray-600 rounded p-1">üç∫</button>
                                <button type="button" onclick="addEmoji('üçª')" class="hover:bg-gray-600 rounded p-1">üçª</button>
                                <button type="button" onclick="addEmoji('ü•Ç')" class="hover:bg-gray-600 rounded p-1">ü•Ç</button>
                                <button type="button" onclick="addEmoji('üç∑')" class="hover:bg-gray-600 rounded p-1">üç∑</button>
                                <button type="button" onclick="addEmoji('üç∏')" class="hover:bg-gray-600 rounded p-1">üç∏</button>
                                <button type="button" onclick="addEmoji('üçπ')" class="hover:bg-gray-600 rounded p-1">üçπ</button>
                            </div>
                            <div id="emojiActivities" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('‚öΩ')" class="hover:bg-gray-600 rounded p-1">‚öΩ</button>
                                <button type="button" onclick="addEmoji('üèÄ')" class="hover:bg-gray-600 rounded p-1">üèÄ</button>
                                <button type="button" onclick="addEmoji('üèà')" class="hover:bg-gray-600 rounded p-1">üèà</button>
                                <button type="button" onclick="addEmoji('‚öæ')" class="hover:bg-gray-600 rounded p-1">‚öæ</button>
                                <button type="button" onclick="addEmoji('ü•é')" class="hover:bg-gray-600 rounded p-1">ü•é</button>
                                <button type="button" onclick="addEmoji('üéæ')" class="hover:bg-gray-600 rounded p-1">üéæ</button>
                                <button type="button" onclick="addEmoji('üèê')" class="hover:bg-gray-600 rounded p-1">üèê</button>
                                <button type="button" onclick="addEmoji('üèâ')" class="hover:bg-gray-600 rounded p-1">üèâ</button>
                                <button type="button" onclick="addEmoji('ü•è')" class="hover:bg-gray-600 rounded p-1">ü•è</button>
                                <button type="button" onclick="addEmoji('üé±')" class="hover:bg-gray-600 rounded p-1">üé±</button>
                                <button type="button" onclick="addEmoji('ü™Ä')" class="hover:bg-gray-600 rounded p-1">ü™Ä</button>
                                <button type="button" onclick="addEmoji('üèì')" class="hover:bg-gray-600 rounded p-1">üèì</button>
                                <button type="button" onclick="addEmoji('üè∏')" class="hover:bg-gray-600 rounded p-1">üè∏</button>
                                <button type="button" onclick="addEmoji('üèí')" class="hover:bg-gray-600 rounded p-1">üèí</button>
                                <button type="button" onclick="addEmoji('üèë')" class="hover:bg-gray-600 rounded p-1">üèë</button>
                                <button type="button" onclick="addEmoji('ü•ç')" class="hover:bg-gray-600 rounded p-1">ü•ç</button>
                                <button type="button" onclick="addEmoji('üèè')" class="hover:bg-gray-600 rounded p-1">üèè</button>
                                <button type="button" onclick="addEmoji('‚õ≥')" class="hover:bg-gray-600 rounded p-1">‚õ≥</button>
                                <button type="button" onclick="addEmoji('ü™Å')" class="hover:bg-gray-600 rounded p-1">ü™Å</button>
                                <button type="button" onclick="addEmoji('üèπ')" class="hover:bg-gray-600 rounded p-1">üèπ</button>
                                <button type="button" onclick="addEmoji('üé£')" class="hover:bg-gray-600 rounded p-1">üé£</button>
                                <button type="button" onclick="addEmoji('ü§ø')" class="hover:bg-gray-600 rounded p-1">ü§ø</button>
                                <button type="button" onclick="addEmoji('ü•ä')" class="hover:bg-gray-600 rounded p-1">ü•ä</button>
                                <button type="button" onclick="addEmoji('ü•ã')" class="hover:bg-gray-600 rounded p-1">ü•ã</button>
                                <button type="button" onclick="addEmoji('üéΩ')" class="hover:bg-gray-600 rounded p-1">üéΩ</button>
                                <button type="button" onclick="addEmoji('üõπ')" class="hover:bg-gray-600 rounded p-1">üõπ</button>
                                <button type="button" onclick="addEmoji('üõ∑')" class="hover:bg-gray-600 rounded p-1">üõ∑</button>
                                <button type="button" onclick="addEmoji('‚õ∏Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚õ∏Ô∏è</button>
                                <button type="button" onclick="addEmoji('ü•å')" class="hover:bg-gray-600 rounded p-1">ü•å</button>
                                <button type="button" onclick="addEmoji('üéø')" class="hover:bg-gray-600 rounded p-1">üéø</button>
                                <button type="button" onclick="addEmoji('‚õ∑Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚õ∑Ô∏è</button>
                                <button type="button" onclick="addEmoji('üèÇ')" class="hover:bg-gray-600 rounded p-1">üèÇ</button>
                                <button type="button" onclick="addEmoji('üèãÔ∏è')" class="hover:bg-gray-600 rounded p-1">üèãÔ∏è</button>
                                <button type="button" onclick="addEmoji('ü§º')" class="hover:bg-gray-600 rounded p-1">ü§º</button>
                                <button type="button" onclick="addEmoji('ü§∏')" class="hover:bg-gray-600 rounded p-1">ü§∏</button>
                                <button type="button" onclick="addEmoji('‚õπÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚õπÔ∏è</button>
                                <button type="button" onclick="addEmoji('ü§∫')" class="hover:bg-gray-600 rounded p-1">ü§∫</button>
                                <button type="button" onclick="addEmoji('üèá')" class="hover:bg-gray-600 rounded p-1">üèá</button>
                                <button type="button" onclick="addEmoji('üßò')" class="hover:bg-gray-600 rounded p-1">üßò</button>
                                <button type="button" onclick="addEmoji('üèÑ')" class="hover:bg-gray-600 rounded p-1">üèÑ</button>
                                <button type="button" onclick="addEmoji('üèä')" class="hover:bg-gray-600 rounded p-1">üèä</button>
                                <button type="button" onclick="addEmoji('üö¥')" class="hover:bg-gray-600 rounded p-1">üö¥</button>
                                <button type="button" onclick="addEmoji('üöµ')" class="hover:bg-gray-600 rounded p-1">üöµ</button>
                                <button type="button" onclick="addEmoji('üé™')" class="hover:bg-gray-600 rounded p-1">üé™</button>
                                <button type="button" onclick="addEmoji('üé≠')" class="hover:bg-gray-600 rounded p-1">üé≠</button>
                                <button type="button" onclick="addEmoji('üé®')" class="hover:bg-gray-600 rounded p-1">üé®</button>
                                <button type="button" onclick="addEmoji('üé¨')" class="hover:bg-gray-600 rounded p-1">üé¨</button>
                                <button type="button" onclick="addEmoji('üé§')" class="hover:bg-gray-600 rounded p-1">üé§</button>
                                <button type="button" onclick="addEmoji('üéß')" class="hover:bg-gray-600 rounded p-1">üéß</button>
                                <button type="button" onclick="addEmoji('üéº')" class="hover:bg-gray-600 rounded p-1">üéº</button>
                                <button type="button" onclick="addEmoji('üéπ')" class="hover:bg-gray-600 rounded p-1">üéπ</button>
                                <button type="button" onclick="addEmoji('ü•Å')" class="hover:bg-gray-600 rounded p-1">ü•Å</button>
                                <button type="button" onclick="addEmoji('üé∑')" class="hover:bg-gray-600 rounded p-1">üé∑</button>
                                <button type="button" onclick="addEmoji('üé∫')" class="hover:bg-gray-600 rounded p-1">üé∫</button>
                                <button type="button" onclick="addEmoji('üé∏')" class="hover:bg-gray-600 rounded p-1">üé∏</button>
                                <button type="button" onclick="addEmoji('üéª')" class="hover:bg-gray-600 rounded p-1">üéª</button>
                                <button type="button" onclick="addEmoji('üé≤')" class="hover:bg-gray-600 rounded p-1">üé≤</button>
                                <button type="button" onclick="addEmoji('‚ôüÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚ôüÔ∏è</button>
                                <button type="button" onclick="addEmoji('üéØ')" class="hover:bg-gray-600 rounded p-1">üéØ</button>
                                <button type="button" onclick="addEmoji('üé≥')" class="hover:bg-gray-600 rounded p-1">üé≥</button>
                                <button type="button" onclick="addEmoji('üéÆ')" class="hover:bg-gray-600 rounded p-1">üéÆ</button>
                                <button type="button" onclick="addEmoji('üïπÔ∏è')" class="hover:bg-gray-600 rounded p-1">üïπÔ∏è</button>
                                <button type="button" onclick="addEmoji('üé∞')" class="hover:bg-gray-600 rounded p-1">üé∞</button>
                                <button type="button" onclick="addEmoji('üß©')" class="hover:bg-gray-600 rounded p-1">üß©</button>
                            </div>
                            <div id="emojiTravel" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('üöó')" class="hover:bg-gray-600 rounded p-1">üöó</button>
                                <button type="button" onclick="addEmoji('üöï')" class="hover:bg-gray-600 rounded p-1">üöï</button>
                                <button type="button" onclick="addEmoji('üöô')" class="hover:bg-gray-600 rounded p-1">üöô</button>
                                <button type="button" onclick="addEmoji('üöå')" class="hover:bg-gray-600 rounded p-1">üöå</button>
                                <button type="button" onclick="addEmoji('üöé')" class="hover:bg-gray-600 rounded p-1">üöé</button>
                                <button type="button" onclick="addEmoji('üèéÔ∏è')" class="hover:bg-gray-600 rounded p-1">üèéÔ∏è</button>
                                <button type="button" onclick="addEmoji('üöì')" class="hover:bg-gray-600 rounded p-1">üöì</button>
                                <button type="button" onclick="addEmoji('üöë')" class="hover:bg-gray-600 rounded p-1">üöë</button>
                                <button type="button" onclick="addEmoji('üöí')" class="hover:bg-gray-600 rounded p-1">üöí</button>
                                <button type="button" onclick="addEmoji('üöê')" class="hover:bg-gray-600 rounded p-1">üöê</button>
                                <button type="button" onclick="addEmoji('üõª')" class="hover:bg-gray-600 rounded p-1">üõª</button>
                                <button type="button" onclick="addEmoji('üöö')" class="hover:bg-gray-600 rounded p-1">üöö</button>
                                <button type="button" onclick="addEmoji('üöõ')" class="hover:bg-gray-600 rounded p-1">üöõ</button>
                                <button type="button" onclick="addEmoji('üöú')" class="hover:bg-gray-600 rounded p-1">üöú</button>
                                <button type="button" onclick="addEmoji('üèçÔ∏è')" class="hover:bg-gray-600 rounded p-1">üèçÔ∏è</button>
                                <button type="button" onclick="addEmoji('üõµ')" class="hover:bg-gray-600 rounded p-1">üõµ</button>
                                <button type="button" onclick="addEmoji('üö≤')" class="hover:bg-gray-600 rounded p-1">üö≤</button>
                                <button type="button" onclick="addEmoji('üõ¥')" class="hover:bg-gray-600 rounded p-1">üõ¥</button>
                                <button type="button" onclick="addEmoji('üöÅ')" class="hover:bg-gray-600 rounded p-1">üöÅ</button>
                                <button type="button" onclick="addEmoji('‚úàÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úàÔ∏è</button>
                                <button type="button" onclick="addEmoji('üõ©Ô∏è')" class="hover:bg-gray-600 rounded p-1">üõ©Ô∏è</button>
                                <button type="button" onclick="addEmoji('üöÄ')" class="hover:bg-gray-600 rounded p-1">üöÄ</button>
                                <button type="button" onclick="addEmoji('üõ∏')" class="hover:bg-gray-600 rounded p-1">üõ∏</button>
                                <button type="button" onclick="addEmoji('üö¢')" class="hover:bg-gray-600 rounded p-1">üö¢</button>
                                <button type="button" onclick="addEmoji('‚õµ')" class="hover:bg-gray-600 rounded p-1">‚õµ</button>
                                <button type="button" onclick="addEmoji('üö§')" class="hover:bg-gray-600 rounded p-1">üö§</button>
                                <button type="button" onclick="addEmoji('üõ•Ô∏è')" class="hover:bg-gray-600 rounded p-1">üõ•Ô∏è</button>
                                <button type="button" onclick="addEmoji('üöÇ')" class="hover:bg-gray-600 rounded p-1">üöÇ</button>
                                <button type="button" onclick="addEmoji('üöÉ')" class="hover:bg-gray-600 rounded p-1">üöÉ</button>
                                <button type="button" onclick="addEmoji('üöÑ')" class="hover:bg-gray-600 rounded p-1">üöÑ</button>
                                <button type="button" onclick="addEmoji('üöÖ')" class="hover:bg-gray-600 rounded p-1">üöÖ</button>
                                <button type="button" onclick="addEmoji('üöÜ')" class="hover:bg-gray-600 rounded p-1">üöÜ</button>
                                <button type="button" onclick="addEmoji('üöá')" class="hover:bg-gray-600 rounded p-1">üöá</button>
                                <button type="button" onclick="addEmoji('üöà')" class="hover:bg-gray-600 rounded p-1">üöà</button>
                                <button type="button" onclick="addEmoji('üöâ')" class="hover:bg-gray-600 rounded p-1">üöâ</button>
                                <button type="button" onclick="addEmoji('üè†')" class="hover:bg-gray-600 rounded p-1">üè†</button>
                                <button type="button" onclick="addEmoji('üè°')" class="hover:bg-gray-600 rounded p-1">üè°</button>
                                <button type="button" onclick="addEmoji('üè¢')" class="hover:bg-gray-600 rounded p-1">üè¢</button>
                                <button type="button" onclick="addEmoji('üè£')" class="hover:bg-gray-600 rounded p-1">üè£</button>
                                <button type="button" onclick="addEmoji('üè•')" class="hover:bg-gray-600 rounded p-1">üè•</button>
                                <button type="button" onclick="addEmoji('üè¶')" class="hover:bg-gray-600 rounded p-1">üè¶</button>
                                <button type="button" onclick="addEmoji('üè®')" class="hover:bg-gray-600 rounded p-1">üè®</button>
                                <button type="button" onclick="addEmoji('üè©')" class="hover:bg-gray-600 rounded p-1">üè©</button>
                                <button type="button" onclick="addEmoji('üè™')" class="hover:bg-gray-600 rounded p-1">üè™</button>
                                <button type="button" onclick="addEmoji('üè´')" class="hover:bg-gray-600 rounded p-1">üè´</button>
                                <button type="button" onclick="addEmoji('üè¨')" class="hover:bg-gray-600 rounded p-1">üè¨</button>
                                <button type="button" onclick="addEmoji('üè≠')" class="hover:bg-gray-600 rounded p-1">üè≠</button>
                                <button type="button" onclick="addEmoji('üèØ')" class="hover:bg-gray-600 rounded p-1">üèØ</button>
                                <button type="button" onclick="addEmoji('üè∞')" class="hover:bg-gray-600 rounded p-1">üè∞</button>
                                <button type="button" onclick="addEmoji('üíí')" class="hover:bg-gray-600 rounded p-1">üíí</button>
                                <button type="button" onclick="addEmoji('üóº')" class="hover:bg-gray-600 rounded p-1">üóº</button>
                                <button type="button" onclick="addEmoji('üóΩ')" class="hover:bg-gray-600 rounded p-1">üóΩ</button>
                                <button type="button" onclick="addEmoji('‚õ™')" class="hover:bg-gray-600 rounded p-1">‚õ™</button>
                                <button type="button" onclick="addEmoji('üïå')" class="hover:bg-gray-600 rounded p-1">üïå</button>
                                <button type="button" onclick="addEmoji('üõï')" class="hover:bg-gray-600 rounded p-1">üõï</button>
                                <button type="button" onclick="addEmoji('‚õ©Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚õ©Ô∏è</button>
                                <button type="button" onclick="addEmoji('üåç')" class="hover:bg-gray-600 rounded p-1">üåç</button>
                                <button type="button" onclick="addEmoji('üåé')" class="hover:bg-gray-600 rounded p-1">üåé</button>
                                <button type="button" onclick="addEmoji('üåè')" class="hover:bg-gray-600 rounded p-1">üåè</button>
                                <button type="button" onclick="addEmoji('üåê')" class="hover:bg-gray-600 rounded p-1">üåê</button>
                                <button type="button" onclick="addEmoji('üó∫Ô∏è')" class="hover:bg-gray-600 rounded p-1">üó∫Ô∏è</button>
                                <button type="button" onclick="addEmoji('üß≠')" class="hover:bg-gray-600 rounded p-1">üß≠</button>
                                <button type="button" onclick="addEmoji('üèîÔ∏è')" class="hover:bg-gray-600 rounded p-1">üèîÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚õ∞Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚õ∞Ô∏è</button>
                            </div>
                            <div id="emojiObjects" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('‚åö')" class="hover:bg-gray-600 rounded p-1">‚åö</button>
                                <button type="button" onclick="addEmoji('üì±')" class="hover:bg-gray-600 rounded p-1">üì±</button>
                                <button type="button" onclick="addEmoji('üíª')" class="hover:bg-gray-600 rounded p-1">üíª</button>
                                <button type="button" onclick="addEmoji('‚å®Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚å®Ô∏è</button>
                                <button type="button" onclick="addEmoji('üñ•Ô∏è')" class="hover:bg-gray-600 rounded p-1">üñ•Ô∏è</button>
                                <button type="button" onclick="addEmoji('üñ®Ô∏è')" class="hover:bg-gray-600 rounded p-1">üñ®Ô∏è</button>
                                <button type="button" onclick="addEmoji('üñ±Ô∏è')" class="hover:bg-gray-600 rounded p-1">üñ±Ô∏è</button>
                                <button type="button" onclick="addEmoji('üíΩ')" class="hover:bg-gray-600 rounded p-1">üíΩ</button>
                                <button type="button" onclick="addEmoji('üíæ')" class="hover:bg-gray-600 rounded p-1">üíæ</button>
                                <button type="button" onclick="addEmoji('üíø')" class="hover:bg-gray-600 rounded p-1">üíø</button>
                                <button type="button" onclick="addEmoji('üìÄ')" class="hover:bg-gray-600 rounded p-1">üìÄ</button>
                                <button type="button" onclick="addEmoji('üì∑')" class="hover:bg-gray-600 rounded p-1">üì∑</button>
                                <button type="button" onclick="addEmoji('üì∏')" class="hover:bg-gray-600 rounded p-1">üì∏</button>
                                <button type="button" onclick="addEmoji('üìπ')" class="hover:bg-gray-600 rounded p-1">üìπ</button>
                                <button type="button" onclick="addEmoji('üé•')" class="hover:bg-gray-600 rounded p-1">üé•</button>
                                <button type="button" onclick="addEmoji('üìΩÔ∏è')" class="hover:bg-gray-600 rounded p-1">üìΩÔ∏è</button>
                                <button type="button" onclick="addEmoji('üì∫')" class="hover:bg-gray-600 rounded p-1">üì∫</button>
                                <button type="button" onclick="addEmoji('üìª')" class="hover:bg-gray-600 rounded p-1">üìª</button>
                                <button type="button" onclick="addEmoji('üéôÔ∏è')" class="hover:bg-gray-600 rounded p-1">üéôÔ∏è</button>
                                <button type="button" onclick="addEmoji('üìû')" class="hover:bg-gray-600 rounded p-1">üìû</button>
                                <button type="button" onclick="addEmoji('‚òéÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚òéÔ∏è</button>
                                <button type="button" onclick="addEmoji('üìü')" class="hover:bg-gray-600 rounded p-1">üìü</button>
                                <button type="button" onclick="addEmoji('üì†')" class="hover:bg-gray-600 rounded p-1">üì†</button>
                                <button type="button" onclick="addEmoji('üîã')" class="hover:bg-gray-600 rounded p-1">üîã</button>
                                <button type="button" onclick="addEmoji('üîå')" class="hover:bg-gray-600 rounded p-1">üîå</button>
                                <button type="button" onclick="addEmoji('üí°')" class="hover:bg-gray-600 rounded p-1">üí°</button>
                                <button type="button" onclick="addEmoji('üî¶')" class="hover:bg-gray-600 rounded p-1">üî¶</button>
                                <button type="button" onclick="addEmoji('üïØÔ∏è')" class="hover:bg-gray-600 rounded p-1">üïØÔ∏è</button>
                                <button type="button" onclick="addEmoji('üí∞')" class="hover:bg-gray-600 rounded p-1">üí∞</button>
                                <button type="button" onclick="addEmoji('üíµ')" class="hover:bg-gray-600 rounded p-1">üíµ</button>
                                <button type="button" onclick="addEmoji('üí¥')" class="hover:bg-gray-600 rounded p-1">üí¥</button>
                                <button type="button" onclick="addEmoji('üí∂')" class="hover:bg-gray-600 rounded p-1">üí∂</button>
                                <button type="button" onclick="addEmoji('üí∑')" class="hover:bg-gray-600 rounded p-1">üí∑</button>
                                <button type="button" onclick="addEmoji('üí≥')" class="hover:bg-gray-600 rounded p-1">üí≥</button>
                                <button type="button" onclick="addEmoji('üíé')" class="hover:bg-gray-600 rounded p-1">üíé</button>
                                <button type="button" onclick="addEmoji('‚öñÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚öñÔ∏è</button>
                                <button type="button" onclick="addEmoji('üîß')" class="hover:bg-gray-600 rounded p-1">üîß</button>
                                <button type="button" onclick="addEmoji('üî®')" class="hover:bg-gray-600 rounded p-1">üî®</button>
                                <button type="button" onclick="addEmoji('‚öíÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚öíÔ∏è</button>
                                <button type="button" onclick="addEmoji('üõ†Ô∏è')" class="hover:bg-gray-600 rounded p-1">üõ†Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚õèÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚õèÔ∏è</button>
                                <button type="button" onclick="addEmoji('üî©')" class="hover:bg-gray-600 rounded p-1">üî©</button>
                                <button type="button" onclick="addEmoji('‚öôÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚öôÔ∏è</button>
                                <button type="button" onclick="addEmoji('üîó')" class="hover:bg-gray-600 rounded p-1">üîó</button>
                                <button type="button" onclick="addEmoji('‚õìÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚õìÔ∏è</button>
                                <button type="button" onclick="addEmoji('üîí')" class="hover:bg-gray-600 rounded p-1">üîí</button>
                                <button type="button" onclick="addEmoji('üîì')" class="hover:bg-gray-600 rounded p-1">üîì</button>
                                <button type="button" onclick="addEmoji('üîë')" class="hover:bg-gray-600 rounded p-1">üîë</button>
                                <button type="button" onclick="addEmoji('üóùÔ∏è')" class="hover:bg-gray-600 rounded p-1">üóùÔ∏è</button>
                                <button type="button" onclick="addEmoji('üîê')" class="hover:bg-gray-600 rounded p-1">üîê</button>
                                <button type="button" onclick="addEmoji('üì¶')" class="hover:bg-gray-600 rounded p-1">üì¶</button>
                                <button type="button" onclick="addEmoji('üì´')" class="hover:bg-gray-600 rounded p-1">üì´</button>
                                <button type="button" onclick="addEmoji('üì¨')" class="hover:bg-gray-600 rounded p-1">üì¨</button>
                                <button type="button" onclick="addEmoji('üìß')" class="hover:bg-gray-600 rounded p-1">üìß</button>
                                <button type="button" onclick="addEmoji('üìù')" class="hover:bg-gray-600 rounded p-1">üìù</button>
                                <button type="button" onclick="addEmoji('üìÅ')" class="hover:bg-gray-600 rounded p-1">üìÅ</button>
                                <button type="button" onclick="addEmoji('üìÇ')" class="hover:bg-gray-600 rounded p-1">üìÇ</button>
                                <button type="button" onclick="addEmoji('üìÖ')" class="hover:bg-gray-600 rounded p-1">üìÖ</button>
                                <button type="button" onclick="addEmoji('üìÜ')" class="hover:bg-gray-600 rounded p-1">üìÜ</button>
                                <button type="button" onclick="addEmoji('üìä')" class="hover:bg-gray-600 rounded p-1">üìä</button>
                                <button type="button" onclick="addEmoji('üìà')" class="hover:bg-gray-600 rounded p-1">üìà</button>
                                <button type="button" onclick="addEmoji('üìâ')" class="hover:bg-gray-600 rounded p-1">üìâ</button>
                                <button type="button" onclick="addEmoji('üìã')" class="hover:bg-gray-600 rounded p-1">üìã</button>
                                <button type="button" onclick="addEmoji('üìå')" class="hover:bg-gray-600 rounded p-1">üìå</button>
                            </div>
                            <div id="emojiSymbols" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('‚ù§Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ù§Ô∏è</button>
                                <button type="button" onclick="addEmoji('üß°')" class="hover:bg-gray-600 rounded p-1">üß°</button>
                                <button type="button" onclick="addEmoji('üíõ')" class="hover:bg-gray-600 rounded p-1">üíõ</button>
                                <button type="button" onclick="addEmoji('üíö')" class="hover:bg-gray-600 rounded p-1">üíö</button>
                                <button type="button" onclick="addEmoji('üíô')" class="hover:bg-gray-600 rounded p-1">üíô</button>
                                <button type="button" onclick="addEmoji('üíú')" class="hover:bg-gray-600 rounded p-1">üíú</button>
                                <button type="button" onclick="addEmoji('üñ§')" class="hover:bg-gray-600 rounded p-1">üñ§</button>
                                <button type="button" onclick="addEmoji('ü§ç')" class="hover:bg-gray-600 rounded p-1">ü§ç</button>
                                <button type="button" onclick="addEmoji('ü§é')" class="hover:bg-gray-600 rounded p-1">ü§é</button>
                                <button type="button" onclick="addEmoji('üíî')" class="hover:bg-gray-600 rounded p-1">üíî</button>
                                <button type="button" onclick="addEmoji('‚ù£Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ù£Ô∏è</button>
                                <button type="button" onclick="addEmoji('üíï')" class="hover:bg-gray-600 rounded p-1">üíï</button>
                                <button type="button" onclick="addEmoji('üíû')" class="hover:bg-gray-600 rounded p-1">üíû</button>
                                <button type="button" onclick="addEmoji('üíì')" class="hover:bg-gray-600 rounded p-1">üíì</button>
                                <button type="button" onclick="addEmoji('üíó')" class="hover:bg-gray-600 rounded p-1">üíó</button>
                                <button type="button" onclick="addEmoji('üíñ')" class="hover:bg-gray-600 rounded p-1">üíñ</button>
                                <button type="button" onclick="addEmoji('üíò')" class="hover:bg-gray-600 rounded p-1">üíò</button>
                                <button type="button" onclick="addEmoji('üíù')" class="hover:bg-gray-600 rounded p-1">üíù</button>
                                <button type="button" onclick="addEmoji('üíü')" class="hover:bg-gray-600 rounded p-1">üíü</button>
                                <button type="button" onclick="addEmoji('‚òÆÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚òÆÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚úùÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úùÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚ò™Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ò™Ô∏è</button>
                                <button type="button" onclick="addEmoji('üïâÔ∏è')" class="hover:bg-gray-600 rounded p-1">üïâÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚òØÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚òØÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚ú°Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ú°Ô∏è</button>
                                <button type="button" onclick="addEmoji('üîØ')" class="hover:bg-gray-600 rounded p-1">üîØ</button>
                                <button type="button" onclick="addEmoji('‚ôà')" class="hover:bg-gray-600 rounded p-1">‚ôà</button>
                                <button type="button" onclick="addEmoji('‚ôâ')" class="hover:bg-gray-600 rounded p-1">‚ôâ</button>
                                <button type="button" onclick="addEmoji('‚ôä')" class="hover:bg-gray-600 rounded p-1">‚ôä</button>
                                <button type="button" onclick="addEmoji('‚ôã')" class="hover:bg-gray-600 rounded p-1">‚ôã</button>
                                <button type="button" onclick="addEmoji('‚ôå')" class="hover:bg-gray-600 rounded p-1">‚ôå</button>
                                <button type="button" onclick="addEmoji('‚ôç')" class="hover:bg-gray-600 rounded p-1">‚ôç</button>
                                <button type="button" onclick="addEmoji('‚ôé')" class="hover:bg-gray-600 rounded p-1">‚ôé</button>
                                <button type="button" onclick="addEmoji('‚ôè')" class="hover:bg-gray-600 rounded p-1">‚ôè</button>
                                <button type="button" onclick="addEmoji('‚ôê')" class="hover:bg-gray-600 rounded p-1">‚ôê</button>
                                <button type="button" onclick="addEmoji('‚ôë')" class="hover:bg-gray-600 rounded p-1">‚ôë</button>
                                <button type="button" onclick="addEmoji('‚ôí')" class="hover:bg-gray-600 rounded p-1">‚ôí</button>
                                <button type="button" onclick="addEmoji('‚ôì')" class="hover:bg-gray-600 rounded p-1">‚ôì</button>
                                <button type="button" onclick="addEmoji('‚õé')" class="hover:bg-gray-600 rounded p-1">‚õé</button>
                                <button type="button" onclick="addEmoji('üîÄ')" class="hover:bg-gray-600 rounded p-1">üîÄ</button>
                                <button type="button" onclick="addEmoji('üîÅ')" class="hover:bg-gray-600 rounded p-1">üîÅ</button>
                                <button type="button" onclick="addEmoji('üîÇ')" class="hover:bg-gray-600 rounded p-1">üîÇ</button>
                                <button type="button" onclick="addEmoji('‚ñ∂Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ñ∂Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚è©')" class="hover:bg-gray-600 rounded p-1">‚è©</button>
                                <button type="button" onclick="addEmoji('‚è≠Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚è≠Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚èØÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚èØÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚óÄÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚óÄÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚è™')" class="hover:bg-gray-600 rounded p-1">‚è™</button>
                                <button type="button" onclick="addEmoji('üîº')" class="hover:bg-gray-600 rounded p-1">üîº</button>
                                <button type="button" onclick="addEmoji('‚è´')" class="hover:bg-gray-600 rounded p-1">‚è´</button>
                                <button type="button" onclick="addEmoji('üîΩ')" class="hover:bg-gray-600 rounded p-1">üîΩ</button>
                                <button type="button" onclick="addEmoji('‚è¨')" class="hover:bg-gray-600 rounded p-1">‚è¨</button>
                                <button type="button" onclick="addEmoji('‚è∏Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚è∏Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚èπÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚èπÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚è∫Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚è∫Ô∏è</button>
                                <button type="button" onclick="addEmoji('üîÜ')" class="hover:bg-gray-600 rounded p-1">üîÜ</button>
                                <button type="button" onclick="addEmoji('üîÖ')" class="hover:bg-gray-600 rounded p-1">üîÖ</button>
                                <button type="button" onclick="addEmoji('üì∂')" class="hover:bg-gray-600 rounded p-1">üì∂</button>
                                <button type="button" onclick="addEmoji('üì≥')" class="hover:bg-gray-600 rounded p-1">üì≥</button>
                                <button type="button" onclick="addEmoji('üì¥')" class="hover:bg-gray-600 rounded p-1">üì¥</button>
                                <button type="button" onclick="addEmoji('‚úñÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úñÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚ûï')" class="hover:bg-gray-600 rounded p-1">‚ûï</button>
                                <button type="button" onclick="addEmoji('‚ûñ')" class="hover:bg-gray-600 rounded p-1">‚ûñ</button>
                                <button type="button" onclick="addEmoji('‚ûó')" class="hover:bg-gray-600 rounded p-1">‚ûó</button>
                                <button type="button" onclick="addEmoji('‚ôæÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚ôæÔ∏è</button>
                                <button type="button" onclick="addEmoji('üí≤')" class="hover:bg-gray-600 rounded p-1">üí≤</button>
                                <button type="button" onclick="addEmoji('üí±')" class="hover:bg-gray-600 rounded p-1">üí±</button>
                                <button type="button" onclick="addEmoji('‚Ñ¢Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚Ñ¢Ô∏è</button>
                                <button type="button" onclick="addEmoji('¬©Ô∏è')" class="hover:bg-gray-600 rounded p-1">¬©Ô∏è</button>
                                <button type="button" onclick="addEmoji('¬ÆÔ∏è')" class="hover:bg-gray-600 rounded p-1">¬ÆÔ∏è</button>
                                <button type="button" onclick="addEmoji('„Ä∞Ô∏è')" class="hover:bg-gray-600 rounded p-1">„Ä∞Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚û∞')" class="hover:bg-gray-600 rounded p-1">‚û∞</button>
                                <button type="button" onclick="addEmoji('‚ûø')" class="hover:bg-gray-600 rounded p-1">‚ûø</button>
                                <button type="button" onclick="addEmoji('üîö')" class="hover:bg-gray-600 rounded p-1">üîö</button>
                                <button type="button" onclick="addEmoji('üîô')" class="hover:bg-gray-600 rounded p-1">üîô</button>
                                <button type="button" onclick="addEmoji('üîõ')" class="hover:bg-gray-600 rounded p-1">üîõ</button>
                                <button type="button" onclick="addEmoji('üîù')" class="hover:bg-gray-600 rounded p-1">üîù</button>
                                <button type="button" onclick="addEmoji('üîú')" class="hover:bg-gray-600 rounded p-1">üîú</button>
                                <button type="button" onclick="addEmoji('‚úîÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚úîÔ∏è</button>
                                <button type="button" onclick="addEmoji('‚òëÔ∏è')" class="hover:bg-gray-600 rounded p-1">‚òëÔ∏è</button>
                                <button type="button" onclick="addEmoji('üîò')" class="hover:bg-gray-600 rounded p-1">üîò</button>
                                <button type="button" onclick="addEmoji('üî¥')" class="hover:bg-gray-600 rounded p-1">üî¥</button>
                                <button type="button" onclick="addEmoji('üü†')" class="hover:bg-gray-600 rounded p-1">üü†</button>
                                <button type="button" onclick="addEmoji('üü°')" class="hover:bg-gray-600 rounded p-1">üü°</button>
                                <button type="button" onclick="addEmoji('üü¢')" class="hover:bg-gray-600 rounded p-1">üü¢</button>
                                <button type="button" onclick="addEmoji('üîµ')" class="hover:bg-gray-600 rounded p-1">üîµ</button>
                                <button type="button" onclick="addEmoji('üü£')" class="hover:bg-gray-600 rounded p-1">üü£</button>
                                <button type="button" onclick="addEmoji('‚ö´')" class="hover:bg-gray-600 rounded p-1">‚ö´</button>
                                <button type="button" onclick="addEmoji('‚ö™')" class="hover:bg-gray-600 rounded p-1">‚ö™</button>
                                <button type="button" onclick="addEmoji('üü§')" class="hover:bg-gray-600 rounded p-1">üü§</button>
                                <button type="button" onclick="addEmoji('üî∫')" class="hover:bg-gray-600 rounded p-1">üî∫</button>
                                <button type="button" onclick="addEmoji('üîª')" class="hover:bg-gray-600 rounded p-1">üîª</button>
                                <button type="button" onclick="addEmoji('üî∏')" class="hover:bg-gray-600 rounded p-1">üî∏</button>
                                <button type="button" onclick="addEmoji('üîπ')" class="hover:bg-gray-600 rounded p-1">üîπ</button>
                                <button type="button" onclick="addEmoji('üî∂')" class="hover:bg-gray-600 rounded p-1">üî∂</button>
                                <button type="button" onclick="addEmoji('üî∑')" class="hover:bg-gray-600 rounded p-1">üî∑</button>
                                <button type="button" onclick="addEmoji('üî≥')" class="hover:bg-gray-600 rounded p-1">üî≥</button>
                                <button type="button" onclick="addEmoji('üî≤')" class="hover:bg-gray-600 rounded p-1">üî≤</button>
                                <button type="button" onclick="addEmoji('‚ñ™Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ñ™Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚ñ´Ô∏è')" class="hover:bg-gray-600 rounded p-1">‚ñ´Ô∏è</button>
                                <button type="button" onclick="addEmoji('‚óæ')" class="hover:bg-gray-600 rounded p-1">‚óæ</button>
                                <button type="button" onclick="addEmoji('‚óΩ')" class="hover:bg-gray-600 rounded p-1">‚óΩ</button>
                                <button type="button" onclick="addEmoji('‚¨õ')" class="hover:bg-gray-600 rounded p-1">‚¨õ</button>
                                <button type="button" onclick="addEmoji('‚¨ú')" class="hover:bg-gray-600 rounded p-1">‚¨ú</button>
                                <button type="button" onclick="addEmoji('üîî')" class="hover:bg-gray-600 rounded p-1">üîî</button>
                                <button type="button" onclick="addEmoji('üîï')" class="hover:bg-gray-600 rounded p-1">üîï</button>
                                <button type="button" onclick="addEmoji('üîä')" class="hover:bg-gray-600 rounded p-1">üîä</button>
                                <button type="button" onclick="addEmoji('üîá')" class="hover:bg-gray-600 rounded p-1">üîá</button>
                                <button type="button" onclick="addEmoji('üí¨')" class="hover:bg-gray-600 rounded p-1">üí¨</button>
                                <button type="button" onclick="addEmoji('üí≠')" class="hover:bg-gray-600 rounded p-1">üí≠</button>
                                <button type="button" onclick="addEmoji('üóØÔ∏è')" class="hover:bg-gray-600 rounded p-1">üóØÔ∏è</button>
                                <button type="button" onclick="addEmoji('üî•')" class="hover:bg-gray-600 rounded p-1">üî•</button>
                                <button type="button" onclick="addEmoji('‚ú®')" class="hover:bg-gray-600 rounded p-1">‚ú®</button>
                                <button type="button" onclick="addEmoji('üéâ')" class="hover:bg-gray-600 rounded p-1">üéâ</button>
                                <button type="button" onclick="addEmoji('üíØ')" class="hover:bg-gray-600 rounded p-1">üíØ</button>
                                <button type="button" onclick="addEmoji('‚≠ê')" class="hover:bg-gray-600 rounded p-1">‚≠ê</button>
                                <button type="button" onclick="addEmoji('üåü')" class="hover:bg-gray-600 rounded p-1">üåü</button>
                                <button type="button" onclick="addEmoji('üí´')" class="hover:bg-gray-600 rounded p-1">üí´</button>
                                <button type="button" onclick="addEmoji('‚ö°')" class="hover:bg-gray-600 rounded p-1">‚ö°</button>
                                <button type="button" onclick="addEmoji('üí•')" class="hover:bg-gray-600 rounded p-1">üí•</button>
                                <button type="button" onclick="addEmoji('üéä')" class="hover:bg-gray-600 rounded p-1">üéä</button>
                                <button type="button" onclick="addEmoji('üéÅ')" class="hover:bg-gray-600 rounded p-1">üéÅ</button>
                                <button type="button" onclick="addEmoji('üèÜ')" class="hover:bg-gray-600 rounded p-1">üèÜ</button>
                                <button type="button" onclick="addEmoji('ü•á')" class="hover:bg-gray-600 rounded p-1">ü•á</button>
                                <button type="button" onclick="addEmoji('ü•à')" class="hover:bg-gray-600 rounded p-1">ü•à</button>
                                <button type="button" onclick="addEmoji('ü•â')" class="hover:bg-gray-600 rounded p-1">ü•â</button>
                                <button type="button" onclick="addEmoji('üèÖ')" class="hover:bg-gray-600 rounded p-1">üèÖ</button>
                                <button type="button" onclick="addEmoji('üéñÔ∏è')" class="hover:bg-gray-600 rounded p-1">üéñÔ∏è</button>
                                <button type="button" onclick="addEmoji('üéóÔ∏è')" class="hover:bg-gray-600 rounded p-1">üéóÔ∏è</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="channelNotice" class="p-4 text-center text-gray-400 safe-bottom" style="display: none;">
                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                    </svg>
                    –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø–∏—Å–∞—Ç—å –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Menu Modal -->
    <div id="createMenuModal" class="hidden fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
            <h3 class="text-lg font-bold mb-4 text-center">–°–æ–∑–¥–∞—Ç—å</h3>
            <div class="space-y-2">
                <button onclick="showNewPrivateChat()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">–õ–∏—á–Ω—ã–π —á–∞—Ç</div>
                        <div class="text-xs text-gray-400">–ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</div>
                    </div>
                </button>
                <button onclick="showCreateGroup()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-green rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">–ì—Ä—É–ø–ø–∞</div>
                        <div class="text-xs text-gray-400">–î–æ 200 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    </div>
                </button>
                <button onclick="showCreateChannel()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-orange rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">–ö–∞–Ω–∞–ª</div>
                        <div class="text-xs text-gray-400">–¢–æ–ª—å–∫–æ –≤—ã –º–æ–∂–µ—Ç–µ –ø–∏—Å–∞—Ç—å</div>
                    </div>
                </button>
            </div>
            <button onclick="closeModal('createMenuModal')" class="w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
    
    <!-- New Private Chat Modal -->
    <div id="newPrivateChatModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md max-h-[80vh] flex flex-col fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">–ù–æ–≤—ã–π —á–∞—Ç</h3>
                <button onclick="closeModal('newPrivateChatModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="userSearchInput" oninput="searchUsersForChat()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
            <div id="userSearchResults" class="flex-1 overflow-y-auto chat-scroll"></div>
        </div>
    </div>
    
    <!-- Create Group Modal -->
    <div id="createGroupModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md max-h-[80vh] flex flex-col fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞</h3>
                <button onclick="closeModal('createGroupModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="groupName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
            <input type="text" id="groupSearchInput" oninput="searchUsersForGroup()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤...">
            <div id="selectedMembers" class="flex flex-wrap gap-2 mb-3"></div>
            <div id="groupSearchResults" class="flex-1 overflow-y-auto chat-scroll mb-3 min-h-[200px]"></div>
            <button onclick="createGroup()" class="w-full gradient-bg py-2.5 rounded-xl font-semibold hover:opacity-90">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
        </div>
    </div>
    
    <!-- Create Channel Modal -->
    <div id="createChannelModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">–ù–æ–≤—ã–π –∫–∞–Ω–∞–ª</h3>
                <button onclick="closeModal('createChannelModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="channelName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞">
            <textarea id="channelDescription" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500 resize-none h-20" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            <button onclick="createChannel()" class="w-full gradient-bg py-2.5 rounded-xl font-semibold hover:opacity-90">–°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</button>
        </div>
    </div>
    
    <!-- Account Switcher Modal -->
    <div id="accountSwitcherModal" class="hidden fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
            <h3 class="text-lg font-bold mb-4">–ê–∫–∫–∞—É–Ω—Ç—ã</h3>
            <div id="accountSwitcherList" class="space-y-2 max-h-64 overflow-y-auto mb-4"></div>
            <button onclick="addNewAccount()" class="w-full flex items-center justify-center gap-2 p-3 border-2 border-dashed border-gray-600 rounded-xl text-gray-400 hover:border-purple-500 hover:text-purple-400 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                –î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
            </button>
            <button onclick="closeModal('accountSwitcherModal')" class="w-full mt-3 py-2 text-gray-400 hover:text-white transition-colors">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-6 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">–ü—Ä–æ—Ñ–∏–ª—å</h3>
                <button onclick="closeModal('profileModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="text-center mb-6">
                <div id="profileAvatar" class="w-24 h-24 gradient-bg rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold"></div>
                <div id="profileNameDisplay" class="text-xl font-semibold"></div>
                <div id="profileEmail" class="text-gray-400"></div>
            </div>
            <form onsubmit="updateProfile(event)" class="space-y-4">
                <input type="text" id="newProfileName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="–ù–æ–≤–æ–µ –∏–º—è">
                <input type="text" id="newProfileStatus" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="–°—Ç–∞—Ç—É—Å">
                <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
            <button onclick="logout()" class="w-full mt-3 py-3 bg-red-600/20 text-red-400 rounded-xl font-medium hover:bg-red-600/30 transition-colors">–í—ã–π—Ç–∏</button>
        </div>
    </div>
    
    <!-- Reactions Picker -->
    <div id="reactionsPicker" class="hidden fixed bg-gray-800 rounded-2xl p-2 shadow-xl z-50 fade-in">
        <div class="flex gap-1">
            <button onclick="addReaction('üëç')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">üëç</button>
            <button onclick="addReaction('‚ù§Ô∏è')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">‚ù§Ô∏è</button>
            <button onclick="addReaction('üòÇ')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">üòÇ</button>
            <button onclick="addReaction('üòÆ')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">üòÆ</button>
            <button onclick="addReaction('üò¢')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">üò¢</button>
            <button onclick="addReaction('üî•')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">üî•</button>
        </div>
    </div>
    
    <!-- Image Viewer -->
    <div id="imageViewer" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onclick="closeImageViewer()">
        <button class="absolute top-4 right-4 p-2 text-white hover:bg-white/20 rounded-xl">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        <img id="viewerImage" src="" class="max-w-full max-h-full object-contain">
    </div>
    
    <!-- Group/Channel Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-6 w-full max-w-md fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold" id="settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button onclick="closeModal('settingsModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
                <div>
                    <label class="block text-sm text-gray-400 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="settingsName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500">
                </div>
                
                <!-- –û–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –∫–∞–Ω–∞–ª–æ–≤) -->
                <div id="settingsDescriptionBlock">
                    <label class="block text-sm text-gray-400 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="settingsDescription" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 resize-none h-20"></textarea>
                </div>
                
                <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
                <div id="settingsMembersBlock">
                    <label class="block text-sm text-gray-400 mb-2">–£—á–∞—Å—Ç–Ω–∏–∫–∏ (<span id="settingsMemberCount">0</span>)</label>
                    <div id="settingsMembersList" class="space-y-2 max-h-48 overflow-y-auto chat-scroll"></div>
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <button onclick="saveSettings()" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                
                <button onclick="deleteGroupOrChannel()" class="w-full py-3 bg-red-600/20 text-red-400 rounded-xl font-medium hover:bg-red-600/30 transition-colors">
                    <span id="deleteButtonText">–£–¥–∞–ª–∏—Ç—å</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="hidden fixed top-4 right-4 left-4 md:left-auto bg-gray-800 border border-gray-700 rounded-xl p-4 shadow-xl z-50 fade-in cursor-pointer" onclick="handleToastClick()">
        <div class="flex items-center gap-3">
            <div id="toastIcon" class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold shrink-0"></div>
            <div class="min-w-0">
                <div id="toastTitle" class="font-semibold truncate"></div>
                <div id="toastMessage" class="text-sm text-gray-400 truncate"></div>
            </div>
        </div>
    </div>

    <script>
        // imgBB API Key –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        const IMGBB_API_KEY = 'f457bea1a8c6cf16c4a03634c8ea3177';
        
        // –°–ø–∏—Å–æ–∫ email-–∞–¥—Ä–µ—Å–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        const DEVELOPER_EMAILS = [
            'stepanu142z@gmail.com',
            'stepan42z@yandex.ru'
        ];
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º
        function isDeveloper(email) {
            if (!email) return false;
            return DEVELOPER_EMAILS.some(devEmail => devEmail.toLowerCase() === email.toLowerCase());
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è HTML –±–µ–π–¥–∂–∏–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        function getDevBadgeHtml() {
            return `<span class="dev-badge"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>DEV</span>`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Å –±–µ–π–¥–∂–∏–∫–æ–º (–µ—Å–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫)
        function getNameWithBadge(name, email) {
            if (isDeveloper(email)) {
                return escapeHtml(name) + getDevBadgeHtml();
            }
            return escapeHtml(name);
        }
        
        const firebaseConfig = {
            apiKey: "AIzaSyBeLAiCwZjij3d6FZ4OzylJnaxPwlyf1Ag",
            authDomain: "webchat-28b64.firebaseapp.com",
            databaseURL: "https://webchat-28b64-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webchat-28b64",
            storageBucket: "webchat-28b64.firebasestorage.app",
            messagingSenderId: "307131215178",
            appId: "1:307131215178:web:0e510297256e30959825b3",
            measurementId: "G-JD21B447LF"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        let currentUser = null;
        let currentUserData = null;
        let currentChat = null;
        let currentChatType = null;
        let currentChatData = null;
        let typingTimeout = null;
        let unreadCounts = {};
        let selectedGroupMembers = [];
        let currentMessageId = null;
        let currentTab = 'all';
        let allChats = [];
        let allUsers = {};
        let toastChatId = null;
        let pendingFile = null;
        let uploadTask = null;
        let isUploading = false;

        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        function loadSavedAccounts() {
            const accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            const container = document.getElementById('savedAccounts');
            const list = document.getElementById('accountsList');
            
            if (accounts.length > 0) {
                container.classList.remove('hidden');
                list.innerHTML = accounts.map(acc => `
                    <div class="flex items-center gap-3 p-2 bg-gray-700/50 rounded-xl">
                        <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center font-bold text-sm">${acc.name.charAt(0).toUpperCase()}</div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-sm truncate">${acc.name}</div>
                            <div class="text-xs text-gray-400 truncate">${acc.email}</div>
                        </div>
                        <button onclick="quickLogin('${acc.email}', '${acc.password}')" class="text-xs bg-purple-600 px-2 py-1 rounded-lg">–í–æ–π—Ç–∏</button>
                        <button onclick="removeAccount('${acc.email}')" class="text-gray-400 hover:text-red-400 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `).join('');
            } else {
                container.classList.add('hidden');
            }
        }

        function saveAccount(email, password, name) {
            let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            accounts = accounts.filter(a => a.email !== email);
            accounts.unshift({ email, password, name });
            if (accounts.length > 5) accounts = accounts.slice(0, 5);
            localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
        }

        function removeAccount(email) {
            let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            accounts = accounts.filter(a => a.email !== email);
            localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
            loadSavedAccounts();
        }

        function quickLogin(email, password) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = password;
            login(new Event('submit'));
        }

        loadSavedAccounts();

        auth.onAuthStateChanged(async user => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadAllUsers();
                showChatScreen();
                updateOnlineStatus(true);
                loadAllChats();
                setupNotificationListener();
                
                database.ref(`users/${user.uid}/online`).onDisconnect().set(false);
                database.ref(`users/${user.uid}/lastSeen`).onDisconnect().set(firebase.database.ServerValue.TIMESTAMP);
            } else {
                currentUser = null;
                showAuthScreen();
            }
        });

        async function loadAllUsers() {
            try {
                const snap = await database.ref('users').once('value');
                allUsers = snap.val() || {};
                console.log('Loaded users:', Object.keys(allUsers).length);
            } catch (e) {
                console.error('Error loading users:', e);
            }
        }

        function showTab(tab) {
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            document.getElementById('loginTab').classList.toggle('bg-purple-600', tab === 'login');
            document.getElementById('loginTab').classList.toggle('text-white', tab === 'login');
            document.getElementById('loginTab').classList.toggle('text-gray-400', tab !== 'login');
            document.getElementById('registerTab').classList.toggle('bg-purple-600', tab === 'register');
            document.getElementById('registerTab').classList.toggle('text-white', tab === 'register');
            document.getElementById('registerTab').classList.toggle('text-gray-400', tab !== 'register');
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const save = document.getElementById('saveAccount').checked;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                if (save) {
                    const snapshot = await database.ref(`users/${auth.currentUser.uid}`).once('value');
                    const userData = snapshot.val();
                    saveAccount(email, password, userData?.name || email);
                }
            } catch (error) {
                showAuthError(getErrorMessage(error.code));
            }
        }

        async function register(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            if (!name) return showAuthError('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
            
            try {
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                await database.ref(`users/${cred.user.uid}`).set({
                    name,
                    nameLower: name.toLowerCase(),
                    email,
                    status: '–ü—Ä–∏–≤–µ—Ç! –Ø –∏—Å–ø–æ–ª—å–∑—É—é FlashChat',
                    online: true,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });
                saveAccount(email, password, name);
            } catch (error) {
                showAuthError(getErrorMessage(error.code));
            }
        }

        function getErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è',
                'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π email',
                'auth/weak-password': '–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å',
                'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å'
            };
            return messages[code] || '–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
        }

        function showAuthError(msg) {
            const el = document.getElementById('authError');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 4000);
        }

        function logout() {
            updateOnlineStatus(false);
            auth.signOut();
            closeModal('profileModal');
        }

        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('chatScreen').classList.remove('active');
        }

        function showChatScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('authScreen').style.display = 'none';
            
            const chatScreen = document.getElementById('chatScreen');
            chatScreen.classList.add('active');
            chatScreen.style.display = 'flex';
            
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = 'flex';
            sidebar.classList.remove('chat-open');
            
            const chatArea = document.getElementById('chatArea');
            chatArea.classList.remove('active');
            
            // –ù–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º chatArea —Å–ø—Ä–∞–≤–∞
            if (window.innerWidth >= 768) {
                chatArea.style.display = 'flex';
                document.getElementById('emptyChat').style.display = 'flex';
                document.getElementById('activeChat').style.display = 'none';
            } else {
                chatArea.style.display = 'none';
            }
        }

        async function loadUserData() {
            const snapshot = await database.ref(`users/${currentUser.uid}`).once('value');
            currentUserData = snapshot.val() || {};
        }

        function updateOnlineStatus(status) {
            if (currentUser) {
                database.ref(`users/${currentUser.uid}`).update({
                    online: status,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
            }
        }

        function showChatTab(tab) {
            currentTab = tab;
            ['all', 'private', 'groups', 'channels'].forEach(t => {
                const el = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
                el.classList.toggle('bg-purple-600', t === tab);
                el.classList.toggle('text-white', t === tab);
                el.classList.toggle('text-gray-400', t !== tab);
            });
            renderChatList();
        }

        function loadAllChats() {
            // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            database.ref(`userChats/${currentUser.uid}`).off('value');
            
            database.ref(`userChats/${currentUser.uid}`).on('value', async snapshot => {
                const chats = snapshot.val() || {};
                allChats = [];
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º Set –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                const processedChatIds = new Set();
                
                for (const [chatId, chatData] of Object.entries(chats)) {
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —á–∞—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
                    if (processedChatIds.has(chatId)) continue;
                    processedChatIds.add(chatId);
                    
                    try {
                        let chatInfo = { id: chatId, ...chatData, unread: 0 };
                        
                        const msgSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').limitToLast(1).once('value');
                        const msgs = msgSnap.val();
                        if (msgs) {
                            const lastMsg = Object.values(msgs)[0];
                            chatInfo.lastMessage = lastMsg.text || (lastMsg.fileUrl ? 'üìé –§–∞–π–ª' : '');
                            chatInfo.lastTime = lastMsg.timestamp;
                            chatInfo.lastSenderId = lastMsg.senderId;
                        }
                        
                        const unreadSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').once('value');
                        const allMsgs = unreadSnap.val() || {};
                        let unreadCount = 0;
                        for (const [msgId, msg] of Object.entries(allMsgs)) {
                            if (msg.senderId !== currentUser.uid && (!msg.readBy || !msg.readBy[currentUser.uid])) {
                                unreadCount++;
                            }
                        }
                        chatInfo.unread = unreadCount;
                        unreadCounts[chatId] = unreadCount;
                        
                        if (chatData.type === 'private') {
                            const userData = allUsers[chatData.oderId];
                            if (userData) {
                                chatInfo.name = userData.name;
                                chatInfo.email = userData.email;
                                chatInfo.online = userData.online;
                                chatInfo.avatar = userData.name.charAt(0).toUpperCase();
                            }
                        } else {
                            const groupSnap = await database.ref(`${chatData.type}s/${chatId}`).once('value');
                            const groupData = groupSnap.val();
                            if (groupData) {
                                chatInfo.name = groupData.name;
                                chatInfo.avatar = groupData.name.charAt(0).toUpperCase();
                                chatInfo.members = groupData.members;
                                chatInfo.owner = groupData.owner;
                                chatInfo.description = groupData.description;
                            }
                        }
                        
                        if (chatInfo.name) allChats.push(chatInfo);
                    } catch (e) { console.error(e); }
                }
                
                allChats.sort((a, b) => (b.lastTime || 0) - (a.lastTime || 0));
                renderChatList();
            });
        }

        function renderChatList() {
            const container = document.getElementById('chatList');
            let filtered = allChats;
            
            if (currentTab !== 'all') {
                const typeMap = { 'private': 'private', 'groups': 'group', 'channels': 'channel' };
                filtered = allChats.filter(c => c.type === typeMap[currentTab]);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">–ù–µ—Ç —á–∞—Ç–æ–≤</div>';
                return;
            }
            
            container.innerHTML = filtered.map(chat => {
                const isActive = currentChat === chat.id;
                const statusDot = chat.type === 'private' && chat.online ? 'bg-green-500' : 'bg-gray-500';
                const typeIcon = chat.type === 'group' ? 'üë•' : chat.type === 'channel' ? 'üì¢' : '';
                const unreadBadge = chat.unread > 0 ? `<div class="min-w-[20px] h-5 bg-blue-500 rounded-full text-xs flex items-center justify-center px-1 unread-badge">${chat.unread}</div>` : '';
                const lastMsgPrefix = chat.lastSenderId === currentUser.uid ? '–í—ã: ' : '';
                const gradientClass = chat.type === 'group' ? 'gradient-green' : chat.type === 'channel' ? 'gradient-orange' : 'gradient-bg';
                const chatNameHtml = chat.type === 'private' ? getNameWithBadge(chat.name, chat.email) : escapeHtml(chat.name);
                
                return `
                    <div onclick="openChat('${chat.id}', '${chat.type}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer transition-colors ${isActive ? 'bg-gray-700/50' : ''}">
                        <div class="relative shrink-0">
                            <div class="w-12 h-12 rounded-full ${gradientClass} flex items-center justify-center font-bold">${chat.avatar}</div>
                            ${chat.type === 'private' ? `<div class="absolute bottom-0 right-0 w-3.5 h-3.5 ${statusDot} rounded-full border-2 border-gray-800"></div>` : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <span class="font-medium truncate flex items-center">${typeIcon} ${chatNameHtml}</span>
                                <span class="text-xs text-gray-400 shrink-0 ml-2">${formatTime(chat.lastTime)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-gray-400 truncate">${lastMsgPrefix}${chat.lastMessage ? escapeHtml(chat.lastMessage) : '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π'}</p>
                                ${unreadBadge}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function openChat(chatId, type) {
            currentChat = chatId;
            currentChatType = type;
            
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            // –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è - —Å–∫—Ä—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
            if (window.innerWidth < 768) {
                sidebar.style.display = 'none';
            } else {
                sidebar.classList.add('chat-open');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞
            chatArea.classList.add('active');
            chatArea.style.display = 'flex';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —á–∞—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π
            emptyChat.style.display = 'none';
            activeChat.classList.add('active');
            activeChat.style.display = 'flex';

            // –ö—Ä–∏—Ç–∏—á–Ω–æ: —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –±–ª–æ–∫–∏ –Ω–µ –±—ã–ª–∏ —Å–∫—Ä—ã—Ç—ã/–ø–æ–ª–æ–º–∞–Ω—ã –±—Ä–∞—É–∑–µ—Ä–æ–º
            document.getElementById('messagesContainer').style.display = 'block';
            document.getElementById('typingIndicator').style.display = 'none';
            // uploadPreview –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é hidden –∫–ª–∞—Å—Å–æ–º, –Ω–µ —Ç—Ä–æ–≥–∞–µ–º
            
            if (type === 'private') {
                const chatData = allChats.find(c => c.id === chatId);
                if (chatData) {
                    currentChatData = chatData;
                    document.getElementById('chatAvatar').textContent = chatData.avatar;
                    document.getElementById('chatAvatar').className = 'w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold flex-shrink-0';
                    document.getElementById('chatName').innerHTML = getNameWithBadge(chatData.name, chatData.email);
                    
                    database.ref(`users/${chatData.oderId}`).on('value', snap => {
                        const u = snap.val();
                        if (u) {
                            document.getElementById('chatStatus').textContent = u.online ? '–í —Å–µ—Ç–∏' : `–ë—ã–ª(–∞) ${formatLastSeen(u.lastSeen)}`;
                        }
                    });
                }
                document.getElementById('chatHeaderActions').innerHTML = '';
            } else {
                const snap = await database.ref(`${type}s/${chatId}`).once('value');
                const data = snap.val();
                currentChatData = data;
                
                document.getElementById('chatAvatar').textContent = data.name.charAt(0).toUpperCase();
                document.getElementById('chatAvatar').className = `w-10 h-10 rounded-full ${type === 'group' ? 'gradient-green' : 'gradient-orange'} flex items-center justify-center font-bold flex-shrink-0`;
                document.getElementById('chatName').textContent = (type === 'group' ? 'üë• ' : 'üì¢ ') + data.name;
                
                const memberCount = Object.keys(data.members || {}).length;
                document.getElementById('chatStatus').textContent = type === 'group' ? `${memberCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤` : `${memberCount} –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –≤–ª–∞–¥–µ–ª–µ—Ü
                const isOwner = data.owner === currentUser.uid;
                if (isOwner) {
                    document.getElementById('chatHeaderActions').innerHTML = `
                        <button onclick="showSettings('${chatId}', '${type}')" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                    `;
                } else {
                    document.getElementById('chatHeaderActions').innerHTML = '';
                }
            }
            
            const isChannel = type === 'channel';
            const isOwner = currentChatData?.owner === currentUser.uid;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            const messageInputArea = document.getElementById('messageInputArea');
            const channelNotice = document.getElementById('channelNotice');
            
            if (isChannel && !isOwner) {
                messageInputArea.style.display = 'none';
                channelNotice.style.display = 'block';
            } else {
                messageInputArea.style.display = 'block';
                channelNotice.style.display = 'none';
            }
            
            loadMessages(chatId);
            markAsRead(chatId);
            renderChatList();

            // –§–∏–∫—Å: –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–∞—Ç–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∏—Å–ø–ª–µ–∏
            requestAnimationFrame(() => {
                const mc = document.getElementById('messagesContainer');
                mc.scrollTop = mc.scrollHeight;
            });
        }

        function closeChat() {
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∞–π–¥–±–∞—Ä
            sidebar.style.display = 'flex';
            sidebar.classList.remove('chat-open');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (window.innerWidth < 768) {
                chatArea.classList.remove('active');
                chatArea.style.display = 'none';
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π
            activeChat.classList.remove('active');
            activeChat.style.display = 'none';
            emptyChat.style.display = 'flex';
            
            currentChat = null;
        }

        function loadMessages(chatId) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            database.ref(`messages/${chatId}`).orderByChild('timestamp').off();
            database.ref(`messages/${chatId}`).orderByChild('timestamp').on('child_added', snapshot => {
                const msg = snapshot.val();
                const msgId = snapshot.key;
                addMessageToUI(msg, msgId);
            });
            
            database.ref(`messages/${chatId}`).on('child_changed', snapshot => {
                const msg = snapshot.val();
                const msgId = snapshot.key;
                updateMessageUI(msg, msgId);
            });
        }

        async function addMessageToUI(msg, msgId) {
            const container = document.getElementById('messagesContainer');
            const isOwn = msg.senderId === currentUser.uid;
            
            let senderName = '';
            let senderNameHtml = '';
            if (!isOwn && currentChatType !== 'private') {
                const senderData = allUsers[msg.senderId];
                senderName = senderData?.name || 'Unknown';
                senderNameHtml = getNameWithBadge(senderName, senderData?.email);
            }
            
            const reactions = msg.reactions || {};
            const reactionsList = Object.entries(reactions).reduce((acc, [emoji, users]) => {
                const count = Object.keys(users).length;
                const hasOwn = users[currentUser.uid];
                if (count > 0) acc.push({ emoji, count, hasOwn });
                return acc;
            }, []);
            
            const reactionsHtml = reactionsList.length > 0 ? `
                <div class="flex flex-wrap gap-1 mt-1">
                    ${reactionsList.map(r => `
                        <button onclick="toggleReaction('${msgId}', '${r.emoji}')" class="flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${r.hasOwn ? 'bg-purple-600/50' : 'bg-gray-600/50'} hover:bg-gray-500/50">
                            <span>${r.emoji}</span><span>${r.count}</span>
                        </button>
                    `).join('')}
                </div>
            ` : '';
            
            let contentHtml = '';
            if (msg.fileUrl) {
                if (msg.fileType && msg.fileType.startsWith('image/')) {
                    contentHtml = `<div class="message-image mb-1"><img src="${msg.fileUrl}" alt="Image" class="image-preview cursor-pointer" onclick="viewImage('${msg.fileUrl}')" loading="lazy"></div>`;
                } else if (msg.fileType && msg.fileType.startsWith('video/')) {
                    contentHtml = `<div class="message-image mb-1"><video src="${msg.fileUrl}" controls class="image-preview"></video></div>`;
                } else {
                    contentHtml = `
                        <a href="${msg.fileUrl}" target="_blank" class="flex items-center gap-2 p-2 bg-gray-600/50 rounded-lg mb-2 hover:bg-gray-500/50">
                            <svg class="w-8 h-8 text-purple-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span class="text-sm truncate">${escapeHtml(msg.fileName || '–§–∞–π–ª')}</span>
                        </a>
                    `;
                }
            }
            if (msg.text) {
                contentHtml += `<p class="break-words mt-1">${escapeHtml(msg.text)}</p>`;
            }
            
            const div = document.createElement('div');
            div.id = `msg-${msgId}`;
            div.className = `flex ${isOwn ? 'justify-end' : 'justify-start'} fade-in`;
            div.innerHTML = `
                <div class="max-w-[75%] md:max-w-md lg:max-w-lg group relative">
                    ${senderNameHtml ? `<div class="text-xs text-purple-400 mb-1 ml-1 flex items-center">${senderNameHtml}</div>` : ''}
                    <div oncontextmenu="showReactions(event, '${msgId}')" onclick="handleMessageTap(event, '${msgId}')" class="relative ${isOwn ? 'message-out gradient-bg' : 'message-in bg-gray-700'} px-3 py-2 cursor-pointer">
                        ${contentHtml}
                        <div class="flex items-center justify-end gap-1 mt-1">
                            <span class="text-xs ${isOwn ? 'text-white/70' : 'text-gray-400'}">${formatTime(msg.timestamp)}</span>
                            ${isOwn ? getReadIcon(msg) : ''}
                        </div>
                        ${reactionsHtml}
                    </div>
                </div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function updateMessageUI(msg, msgId) {
            const el = document.getElementById(`msg-${msgId}`);
            if (!el) return;
            
            const reactions = msg.reactions || {};
            const reactionsList = Object.entries(reactions).reduce((acc, [emoji, users]) => {
                const count = Object.keys(users).length;
                const hasOwn = users[currentUser.uid];
                if (count > 0) acc.push({ emoji, count, hasOwn });
                return acc;
            }, []);
            
            let reactionsContainer = el.querySelector('.flex.flex-wrap');
            if (reactionsList.length > 0) {
                const html = reactionsList.map(r => `
                    <button onclick="toggleReaction('${msgId}', '${r.emoji}')" class="flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${r.hasOwn ? 'bg-purple-600/50' : 'bg-gray-600/50'} hover:bg-gray-500/50">
                        <span>${r.emoji}</span><span>${r.count}</span>
                    </button>
                `).join('');
                
                if (reactionsContainer) {
                    reactionsContainer.innerHTML = html;
                } else {
                    const msgDiv = el.querySelector('.message-in, .message-out');
                    msgDiv.insertAdjacentHTML('beforeend', `<div class="flex flex-wrap gap-1 mt-1">${html}</div>`);
                }
            } else if (reactionsContainer) {
                reactionsContainer.remove();
            }
        }

        function getReadIcon(msg) {
            if (msg.readBy && Object.keys(msg.readBy).some(uid => uid !== currentUser.uid)) {
                return '<svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24"><path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"/></svg>';
            }
            return '<svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>';
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 32MB –¥–ª—è imgBB, 10MB –¥–ª—è –¥—Ä—É–≥–∏—Ö)
            const maxSize = file.type.startsWith('image/') ? 32 * 1024 * 1024 : 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showToast('‚ö†Ô∏è', '–û—à–∏–±–∫–∞', `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. ${file.type.startsWith('image/') ? '32' : '10'}MB)`);
                return;
            }
            
            pendingFile = file;
            const preview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('uploadPreviewImage');
            const previewFile = document.getElementById('uploadPreviewFile');
            const fileName = document.getElementById('uploadFileName');
            
            preview.classList.remove('hidden');
            
            if (file.type.startsWith('image/')) {
                previewImage.classList.remove('hidden');
                previewFile.classList.add('hidden');
                previewImage.src = URL.createObjectURL(file);
            } else {
                previewImage.classList.add('hidden');
                previewFile.classList.remove('hidden');
                previewFile.style.display = 'flex';
                fileName.textContent = file.name;
            }
            
            event.target.value = '';
        }

        function cancelUpload() {
            if (uploadTask) {
                uploadTask.cancel();
                uploadTask = null;
            }
            isUploading = false;
            pendingFile = null;
            document.getElementById('uploadPreview').classList.add('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadProgressBar').style.width = '0%';
            document.getElementById('imageCaption').value = '';
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–∞ —Å –ø–æ–¥–ø–∏—Å—å—é
        async function sendFileWithCaption() {
            if (!pendingFile || !currentChat) return;
            
            if (isUploading) {
                showToast('‚è≥', '–ü–æ–¥–æ–∂–¥–∏—Ç–µ', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...');
                return;
            }
            
            const caption = document.getElementById('imageCaption').value.trim();
            
            isUploading = true;
            
            let messageData = {
                senderId: currentUser.uid,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                readBy: { [currentUser.uid]: true }
            };
            
            if (caption) messageData.text = caption;
            
            try {
                const fileUrl = await uploadFile(pendingFile);
                messageData.fileUrl = fileUrl;
                messageData.fileName = pendingFile.name;
                messageData.fileType = pendingFile.type;
                
                await database.ref(`messages/${currentChat}`).push(messageData);
                await database.ref(`userChats/${currentUser.uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                
                if (currentChatType === 'private') {
                    const chatData = allChats.find(c => c.id === currentChat);
                    if (chatData) {
                        await database.ref(`userChats/${chatData.oderId}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                    }
                } else if (currentChatData?.members) {
                    for (const uid of Object.keys(currentChatData.members)) {
                        if (uid !== currentUser.uid) {
                            await database.ref(`userChats/${uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                        }
                    }
                }
                
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', '–§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
            } catch (error) {
                console.error('File upload failed:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: ' + error.message);
            } finally {
                isUploading = false;
                cancelUpload();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ imgBB API
        async function uploadImageToImgBB(file) {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('image', file);
                formData.append('key', IMGBB_API_KEY);
                
                document.getElementById('uploadProgress').classList.remove('hidden');
                
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://api.imgbb.com/1/upload');
                
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const progress = (e.loaded / e.total) * 100;
                        document.getElementById('uploadProgressBar').style.width = progress + '%';
                    }
                };
                
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                console.log('imgBB upload success:', response.data.url);
                                resolve(response.data.url);
                            } else {
                                reject(new Error('imgBB upload failed: ' + (response.error?.message || 'Unknown error')));
                            }
                        } catch (e) {
                            reject(new Error('Failed to parse imgBB response'));
                        }
                    } else {
                        reject(new Error('imgBB upload failed with status: ' + xhr.status));
                    }
                };
                
                xhr.onerror = () => {
                    reject(new Error('Network error during upload'));
                };
                
                xhr.send(formData);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ Firebase Storage (–¥–ª—è –Ω–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
        async function uploadFileToFirebase(file) {
            return new Promise((resolve, reject) => {
                const fileName = `${Date.now()}_${file.name.replace(/[^a-zA-Z0-9._-]/g, '_')}`;
                const filePath = `uploads/${currentUser.uid}/${fileName}`;
                const fileRef = storage.ref(filePath);
                
                const metadata = {
                    contentType: file.type,
                    customMetadata: {
                        'uploadedBy': currentUser.uid,
                        'originalName': file.name
                    }
                };
                
                document.getElementById('uploadProgress').classList.remove('hidden');
                document.getElementById('uploadProgressBar').style.width = '0%';
                
                console.log('Starting Firebase upload:', filePath);
                
                uploadTask = fileRef.put(file, metadata);
                
                uploadTask.on('state_changed', 
                    snapshot => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        document.getElementById('uploadProgressBar').style.width = progress + '%';
                    },
                    error => {
                        console.error('Firebase upload error:', error);
                        document.getElementById('uploadProgress').classList.add('hidden');
                        reject(error);
                    },
                    async () => {
                        try {
                            const url = await uploadTask.snapshot.ref.getDownloadURL();
                            console.log('Firebase upload success:', url);
                            resolve(url);
                        } catch (e) {
                            reject(e);
                        }
                    }
                );
            });
        }

        // –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        async function uploadFile(file) {
            // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ imgBB
            if (file.type.startsWith('image/')) {
                console.log('Uploading image to imgBB...');
                return await uploadImageToImgBB(file);
            }
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ Firebase Storage
            console.log('Uploading file to Firebase Storage...');
            return await uploadFileToFirebase(file);
        }

        function viewImage(url) {
            document.getElementById('viewerImage').src = url;
            document.getElementById('imageViewer').classList.remove('hidden');
        }

        function closeImageViewer() {
            document.getElementById('imageViewer').classList.add('hidden');
        }

        let lastTap = 0;
        function handleMessageTap(e, msgId) {
            const now = Date.now();
            if (now - lastTap < 300) {
                showReactions(e, msgId);
            }
            lastTap = now;
        }

        function showReactions(e, msgId) {
            e.preventDefault();
            currentMessageId = msgId;
            const picker = document.getElementById('reactionsPicker');
            picker.classList.remove('hidden');
            
            const rect = e.target.getBoundingClientRect();
            picker.style.left = Math.min(rect.left, window.innerWidth - 220) + 'px';
            picker.style.top = (rect.top - 50) + 'px';
            
            setTimeout(() => {
                document.addEventListener('click', hideReactions, { once: true });
            }, 10);
        }

        function hideReactions() {
            document.getElementById('reactionsPicker').classList.add('hidden');
        }

        function addReaction(emoji) {
            if (!currentMessageId || !currentChat) return;
            database.ref(`messages/${currentChat}/${currentMessageId}/reactions/${emoji}/${currentUser.uid}`).set(true);
            hideReactions();
        }

        function toggleReaction(msgId, emoji) {
            database.ref(`messages/${currentChat}/${msgId}/reactions/${emoji}/${currentUser.uid}`).once('value', snap => {
                if (snap.exists()) {
                    snap.ref.remove();
                } else {
                    snap.ref.set(true);
                }
            });
        }

        async function sendMessage(e) {
            e.preventDefault();
            
            if (isUploading) {
                showToast('‚è≥', '–ü–æ–¥–æ–∂–¥–∏—Ç–µ', '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...');
                return;
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ –ø—Ä–µ–≤—å—é
            if (pendingFile) {
                sendFileWithCaption();
                return;
            }
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            if (!currentChat) return;
            
            input.value = '';
            
            if (typingTimeout) {
                clearTimeout(typingTimeout);
                database.ref(`typing/${currentChat}/${currentUser.uid}`).set(false);
            }
            
            let messageData = {
                senderId: currentUser.uid,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                readBy: { [currentUser.uid]: true },
                text: text
            };
            
            await database.ref(`messages/${currentChat}`).push(messageData);
            await database.ref(`userChats/${currentUser.uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
            
            if (currentChatType === 'private') {
                const chatData = allChats.find(c => c.id === currentChat);
                if (chatData) {
                    await database.ref(`userChats/${chatData.oderId}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                }
            } else if (currentChatData?.members) {
                for (const uid of Object.keys(currentChatData.members)) {
                    if (uid !== currentUser.uid) {
                        await database.ref(`userChats/${uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                    }
                }
            }
        }

        function handleTyping() {
            if (!currentChat) return;
            database.ref(`typing/${currentChat}/${currentUser.uid}`).set(true);
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                database.ref(`typing/${currentChat}/${currentUser.uid}`).set(false);
            }, 2000);
        }

        function markAsRead(chatId) {
            database.ref(`messages/${chatId}`).once('value', snap => {
                const msgs = snap.val() || {};
                for (const [msgId, msg] of Object.entries(msgs)) {
                    if (msg.senderId !== currentUser.uid) {
                        database.ref(`messages/${chatId}/${msgId}/readBy/${currentUser.uid}`).set(true);
                    }
                }
            });
            unreadCounts[chatId] = 0;
        }

        function setupNotificationListener() {
            database.ref(`userChats/${currentUser.uid}`).on('child_changed', async snap => {
                const chatId = snap.key;
                if (chatId === currentChat && document.visibilityState === 'visible') return;
                
                const msgSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').limitToLast(1).once('value');
                const msgs = msgSnap.val();
                if (!msgs) return;
                
                const lastMsg = Object.values(msgs)[0];
                if (lastMsg.senderId === currentUser.uid) return;
                
                const senderName = allUsers[lastMsg.senderId]?.name || '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ';
                const msgText = lastMsg.text || (lastMsg.fileUrl ? 'üìé –§–∞–π–ª' : '');
                
                showToast(senderName.charAt(0).toUpperCase(), senderName, msgText, chatId);
                
                if (Notification.permission === 'granted' && document.visibilityState !== 'visible') {
                    new Notification(senderName, { body: msgText, icon: '/favicon.ico' });
                }
            });
        }

        function showToast(icon, title, msg, chatId = null) {
            toastChatId = chatId;
            document.getElementById('toastIcon').textContent = icon;
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = msg;
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 4000);
        }

        function handleToastClick() {
            document.getElementById('toast').classList.add('hidden');
            if (toastChatId) {
                const chat = allChats.find(c => c.id === toastChatId);
                if (chat) openChat(toastChatId, chat.type);
            }
        }

        function showCreateMenu() {
            document.getElementById('createMenuModal').classList.remove('hidden');
        }

        function showNewPrivateChat() {
            closeModal('createMenuModal');
            document.getElementById('newPrivateChatModal').classList.remove('hidden');
            document.getElementById('userSearchInput').value = '';
            document.getElementById('userSearchResults').innerHTML = '';
            renderUsersForChat();
        }

        function renderUsersForChat() {
            const container = document.getElementById('userSearchResults');
            const users = Object.entries(allUsers).filter(([uid]) => uid !== currentUser.uid);
            
            if (users.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            const uniqueUsers = new Map();
            users.forEach(([uid, user]) => {
                if (!uniqueUsers.has(uid)) {
                    uniqueUsers.set(uid, user);
                }
            });
            
            container.innerHTML = Array.from(uniqueUsers.entries()).map(([uid, user]) => `
                <div onclick="startPrivateChat('${uid}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer rounded-xl" data-uid="${uid}">
                    <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                    <div>
                        <div class="font-medium flex items-center">${getNameWithBadge(user.name || 'Unknown', user.email)}</div>
                        <div class="text-xs text-gray-400">${user.online ? '–í —Å–µ—Ç–∏' : '–ù–µ –≤ —Å–µ—Ç–∏'}</div>
                    </div>
                </div>
            `).join('');
        }

        function searchUsersForChat() {
            const query = document.getElementById('userSearchInput').value.toLowerCase();
            const items = document.querySelectorAll('#userSearchResults > div');
            items.forEach(item => {
                const name = item.querySelector('.font-medium')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? '' : 'none';
            });
        }

        async function startPrivateChat(otherUserId) {
            closeModal('newPrivateChatModal');
            
            const chatId = currentUser.uid < otherUserId ? `${currentUser.uid}_${otherUserId}` : `${otherUserId}_${currentUser.uid}`;
            
            await database.ref(`userChats/${currentUser.uid}/${chatId}`).set({
                type: 'private',
                oderId: otherUserId,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
            await database.ref(`userChats/${otherUserId}/${chatId}`).set({
                type: 'private',
                oderId: currentUser.uid,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            setTimeout(() => openChat(chatId, 'private'), 500);
        }

        function showCreateGroup() {
            closeModal('createMenuModal');
            document.getElementById('createGroupModal').classList.remove('hidden');
            document.getElementById('groupName').value = '';
            document.getElementById('groupSearchInput').value = '';
            document.getElementById('groupSearchResults').innerHTML = '';
            selectedGroupMembers = [];
            renderSelectedMembers();
            renderUsersForGroup();
        }

        function renderUsersForGroup() {
            const container = document.getElementById('groupSearchResults');
            const users = Object.entries(allUsers).filter(([uid]) => uid !== currentUser.uid);
            
            if (users.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Map –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
            const uniqueUsers = new Map();
            users.forEach(([uid, user]) => {
                if (!uniqueUsers.has(uid)) {
                    uniqueUsers.set(uid, user);
                }
            });
            
            container.innerHTML = Array.from(uniqueUsers.entries()).map(([uid, user]) => {
                const selected = selectedGroupMembers.includes(uid);
                return `
                    <div onclick="toggleGroupMember('${uid}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer rounded-xl ${selected ? 'bg-purple-600/20' : ''}" data-uid="${uid}">
                        <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                        <div class="flex-1">
                            <div class="font-medium flex items-center">${getNameWithBadge(user.name || 'Unknown', user.email)}</div>
                        </div>
                        ${selected ? '<svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>' : ''}
                    </div>
                `;
            }).join('');
        }

        function searchUsersForGroup() {
            const query = document.getElementById('groupSearchInput').value.toLowerCase();
            const items = document.querySelectorAll('#groupSearchResults > div');
            items.forEach(item => {
                const name = item.querySelector('.font-medium')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? '' : 'none';
            });
        }

        function toggleGroupMember(uid) {
            const idx = selectedGroupMembers.indexOf(uid);
            if (idx >= 0) {
                selectedGroupMembers.splice(idx, 1);
            } else {
                selectedGroupMembers.push(uid);
            }
            renderSelectedMembers();
            renderUsersForGroup();
        }

        function renderSelectedMembers() {
            const container = document.getElementById('selectedMembers');
            if (selectedGroupMembers.length === 0) {
                container.innerHTML = '';
                return;
            }
            container.innerHTML = selectedGroupMembers.map(uid => {
                const user = allUsers[uid];
                return `
                    <div class="flex items-center gap-1 bg-purple-600/30 rounded-full px-2 py-1">
                        <span class="text-sm">${escapeHtml(user?.name || 'User')}</span>
                        <button onclick="toggleGroupMember('${uid}')" class="text-gray-400 hover:text-white">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
        }

        async function createGroup() {
            const nameInput = document.getElementById('groupName');
            const name = nameInput ? nameInput.value.trim() : '';
            
            console.log('createGroup called, name:', name);
            
            if (!name) {
                showToast('‚ö†Ô∏è', '–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                return;
            }
            if (selectedGroupMembers.length === 0) {
                showToast('‚ö†Ô∏è', '–û—à–∏–±–∫–∞', '–î–æ–±–∞–≤—å—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤');
                return;
            }
            
            try {
                // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É
                const groupId = database.ref().child('groups').push().key;
                console.log('Generated group ID:', groupId);
                
                const members = { [currentUser.uid]: true };
                selectedGroupMembers.forEach(uid => members[uid] = true);
                
                const groupData = {
                    name: name,
                    owner: currentUser.uid,
                    members: members,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                console.log('Saving group data:', groupData);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥—Ä—É–ø–ø—É
                await database.ref('groups/' + groupId).set(groupData);
                console.log('Group saved to database');
                
                // –î–æ–±–∞–≤–ª—è–µ–º —á–∞—Ç –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
                const updates = {};
                Object.keys(members).forEach(uid => {
                    updates[`userChats/${uid}/${groupId}`] = {
                        type: 'group',
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    };
                });
                
                await database.ref().update(updates);
                console.log('User chats updated');
                
                closeModal('createGroupModal');
                selectedGroupMembers = [];
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', '–ì—Ä—É–ø–ø–∞ —Å–æ–∑–¥–∞–Ω–∞');
                
                setTimeout(() => openChat(groupId, 'group'), 500);
            } catch (error) {
                console.error('Error creating group:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', error.message);
            }
        }

        function showCreateChannel() {
            closeModal('createMenuModal');
            document.getElementById('createChannelModal').classList.remove('hidden');
            document.getElementById('channelName').value = '';
            document.getElementById('channelDescription').value = '';
        }

        async function createChannel() {
            const nameInput = document.getElementById('channelName');
            const descInput = document.getElementById('channelDescription');
            const name = nameInput ? nameInput.value.trim() : '';
            const description = descInput ? descInput.value.trim() : '';
            
            console.log('createChannel called, name:', name);
            
            if (!name) {
                showToast('‚ö†Ô∏è', '–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞');
                return;
            }
            
            try {
                // –°–æ–∑–¥–∞–µ–º –∫–∞–Ω–∞–ª
                const channelId = database.ref().child('channels').push().key;
                console.log('Generated channel ID:', channelId);
                
                const channelData = {
                    name: name,
                    description: description,
                    owner: currentUser.uid,
                    members: { [currentUser.uid]: true },
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                console.log('Saving channel data:', channelData);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–Ω–∞–ª –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —á–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
                const updates = {};
                updates['channels/' + channelId] = channelData;
                updates[`userChats/${currentUser.uid}/${channelId}`] = {
                    type: 'channel',
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref().update(updates);
                console.log('Channel created successfully');
                
                closeModal('createChannelModal');
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', '–ö–∞–Ω–∞–ª —Å–æ–∑–¥–∞–Ω');
                
                setTimeout(() => openChat(channelId, 'channel'), 500);
            } catch (error) {
                console.error('Error creating channel:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', error.message);
            }
        }

        function showAccountSwitcher() {
            const accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            const container = document.getElementById('accountSwitcherList');
            
            container.innerHTML = accounts.map(acc => {
                const isCurrent = currentUser?.email === acc.email;
                return `
                    <div class="flex items-center gap-3 p-3 ${isCurrent ? 'bg-purple-600/20' : 'hover:bg-gray-700/50'} rounded-xl ${isCurrent ? '' : 'cursor-pointer'}" ${isCurrent ? '' : `onclick="switchAccount('${acc.email}', '${acc.password}')"`}>
                        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center font-bold">${acc.name.charAt(0).toUpperCase()}</div>
                        <div class="flex-1">
                            <div class="font-medium">${acc.name}</div>
                            <div class="text-xs text-gray-400">${acc.email}</div>
                        </div>
                        ${isCurrent ? '<span class="text-xs text-purple-400">–¢–µ–∫—É—â–∏–π</span>' : ''}
                    </div>
                `;
            }).join('') || '<div class="p-4 text-center text-gray-500">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>';
            
            document.getElementById('accountSwitcherModal').classList.remove('hidden');
        }

        async function switchAccount(email, password) {
            closeModal('accountSwitcherModal');
            await auth.signOut();
            await auth.signInWithEmailAndPassword(email, password);
        }

        function addNewAccount() {
            closeModal('accountSwitcherModal');
            auth.signOut();
        }

        async function showProfile() {
            const snap = await database.ref(`users/${currentUser.uid}`).once('value');
            const user = snap.val();
            
            document.getElementById('profileAvatar').textContent = user.name.charAt(0).toUpperCase();
            document.getElementById('profileNameDisplay').innerHTML = getNameWithBadge(user.name, currentUser.email);
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('newProfileName').value = user.name;
            document.getElementById('newProfileStatus').value = user.status || '';
            
            document.getElementById('profileModal').classList.remove('hidden');
        }

        async function updateProfile(e) {
            e.preventDefault();
            const name = document.getElementById('newProfileName').value.trim();
            const status = document.getElementById('newProfileStatus').value.trim();
            
            if (name) {
                await database.ref(`users/${currentUser.uid}`).update({ name, status, nameLower: name.toLowerCase() });
                showToast('‚úì', '–£—Å–ø–µ—à–Ω–æ', '–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω');
                closeModal('profileModal');
                
                let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
                accounts = accounts.map(a => a.email === currentUser.email ? { ...a, name } : a);
                localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
                
                await loadAllUsers();
            }
        }

        function searchAll() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('searchResults');
            
            if (!query) {
                container.classList.add('hidden');
                return;
            }
            
            const results = allChats.filter(c => c.name.toLowerCase().includes(query));
            
            if (results.length === 0) {
                container.innerHTML = '<div class="p-3 text-center text-gray-500">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
            } else {
                container.innerHTML = results.map(chat => {
                    const gradientClass = chat.type === 'group' ? 'gradient-green' : chat.type === 'channel' ? 'gradient-orange' : 'gradient-bg';
                    return `
                        <div onclick="openChat('${chat.id}', '${chat.type}'); document.getElementById('searchInput').value=''; document.getElementById('searchResults').classList.add('hidden');" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer">
                            <div class="w-10 h-10 rounded-full ${gradientClass} flex items-center justify-center font-bold">${chat.avatar}</div>
                            <div class="font-medium">${escapeHtml(chat.name)}</div>
                        </div>
                    `;
                }).join('');
            }
            container.classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª–∞
        async function showSettings(chatId, type) {
            const snap = await database.ref(`${type}s/${chatId}`).once('value');
            const data = snap.val();
            
            if (!data || data.owner !== currentUser.uid) {
                showToast('‚ùå', '–û—à–∏–±–∫–∞', '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            document.getElementById('settingsTitle').textContent = type === 'group' ? '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä—É–ø–ø—ã' : '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞';
            document.getElementById('settingsName').value = data.name || '';
            document.getElementById('settingsDescription').value = data.description || '';
            document.getElementById('deleteButtonText').textContent = type === 'group' ? '–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É' : '–£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤)
            document.getElementById('settingsDescriptionBlock').classList.toggle('hidden', type === 'group');
            
            // –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const members = data.members || {};
            const memberCount = Object.keys(members).length;
            document.getElementById('settingsMemberCount').textContent = memberCount;
            
            const membersList = document.getElementById('settingsMembersList');
            membersList.innerHTML = '';
            
            for (const uid of Object.keys(members)) {
                const user = allUsers[uid];
                if (!user) continue;
                
                const isOwner = uid === data.owner;
                const isSelf = uid === currentUser.uid;
                
                membersList.innerHTML += `
                    <div class="flex items-center gap-3 p-2 bg-gray-700/30 rounded-xl">
                        <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center font-bold text-sm">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-sm truncate flex items-center gap-1">
                                ${getNameWithBadge(user.name || 'Unknown', user.email)}
                                ${isOwner ? '<span class="text-xs text-purple-400">(–≤–ª–∞–¥–µ–ª–µ—Ü)</span>' : ''}
                            </div>
                        </div>
                        ${!isSelf && !isOwner ? `
                            <button onclick="removeMember('${chatId}', '${type}', '${uid}')" class="p-1 text-gray-400 hover:text-red-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        ` : ''}
                    </div>
                `;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ saveSettings
            document.getElementById('settingsModal').dataset.chatId = chatId;
            document.getElementById('settingsModal').dataset.type = type;
            
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        async function saveSettings() {
            const modal = document.getElementById('settingsModal');
            const chatId = modal.dataset.chatId;
            const type = modal.dataset.type;
            
            const name = document.getElementById('settingsName').value.trim();
            const description = document.getElementById('settingsDescription').value.trim();
            
            if (!name) {
                showToast('‚ö†Ô∏è', '–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
                return;
            }
            
            try {
                const updates = { name };
                if (type === 'channel') {
                    updates.description = description;
                }
                
                await database.ref(`${type}s/${chatId}`).update(updates);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
                document.getElementById('chatName').textContent = (type === 'group' ? 'üë• ' : 'üì¢ ') + name;
                
                closeModal('settingsModal');
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadAllUsers();
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', error.message);
            }
        }

        // –£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞
        async function removeMember(chatId, type, uid) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞?')) return;
            
            try {
                // –£–¥–∞–ª—è–µ–º –∏–∑ —á–ª–µ–Ω–æ–≤ –≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª–∞
                await database.ref(`${type}s/${chatId}/members/${uid}`).remove();
                
                // –£–¥–∞–ª—è–µ–º —á–∞—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await database.ref(`userChats/${uid}/${chatId}`).remove();
                
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', '–£—á–∞—Å—Ç–Ω–∏–∫ —É–¥–∞–ª–µ–Ω');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                showSettings(chatId, type);
            } catch (error) {
                console.error('Error removing member:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', error.message);
            }
        }

        // –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
        async function deleteGroupOrChannel() {
            const modal = document.getElementById('settingsModal');
            const chatId = modal.dataset.chatId;
            const type = modal.dataset.type;
            
            const typeName = type === 'group' ? '–≥—Ä—É–ø–ø—É' : '–∫–∞–Ω–∞–ª';
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ${typeName}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) return;
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                const snap = await database.ref(`${type}s/${chatId}/members`).once('value');
                const members = snap.val() || {};
                
                // –£–¥–∞–ª—è–µ–º —á–∞—Ç —É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                for (const uid of Object.keys(members)) {
                    await database.ref(`userChats/${uid}/${chatId}`).remove();
                }
                
                // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                await database.ref(`messages/${chatId}`).remove();
                
                // –£–¥–∞–ª—è–µ–º –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
                await database.ref(`${type}s/${chatId}`).remove();
                
                closeModal('settingsModal');
                closeChat();
                showToast('‚úÖ', '–£—Å–ø–µ—à–Ω–æ', type === 'group' ? '–ì—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞' : '–ö–∞–Ω–∞–ª —É–¥–∞–ª–µ–Ω');
            } catch (error) {
                console.error('Error deleting:', error);
                showToast('‚ùå', '–û—à–∏–±–∫–∞', error.message);
            }
        }

        function toggleEmoji() {
            document.getElementById('emojiPicker').classList.toggle('hidden');
        }

        function addEmoji(emoji) {
            const input = document.getElementById('messageInput');
            input.value += emoji;
            input.focus();
        }

        function showEmojiCategory(category) {
            const categories = ['smileys', 'gestures', 'animals', 'food', 'activities', 'travel', 'objects', 'symbols'];
            categories.forEach(cat => {
                const el = document.getElementById('emoji' + cat.charAt(0).toUpperCase() + cat.slice(1));
                const btn = document.getElementById('emojiCat' + cat.charAt(0).toUpperCase() + cat.slice(1));
                if (el) el.classList.toggle('hidden', cat !== category);
                if (btn) btn.classList.toggle('border-purple-500', cat === category);
                if (btn) btn.classList.toggle('border-transparent', cat !== category);
            });
        }

        function openFilePicker() {
            const menu = document.createElement('div');
            menu.className = 'fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4';
            menu.innerHTML = `
                <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
                    <h3 class="text-lg font-bold mb-4 text-center">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å</h3>
                    <div class="space-y-2">
                        <button onclick="selectFileType('photo')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">–§–æ—Ç–æ –∏–ª–∏ –í–∏–¥–µ–æ</div>
                                <div class="text-xs text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ imgBB (–¥–æ 32MB)</div>
                            </div>
                        </button>
                        <button onclick="selectFileType('camera')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">–ö–∞–º–µ—Ä–∞</div>
                                <div class="text-xs text-gray-400">–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</div>
                            </div>
                        </button>
                        <button onclick="selectFileType('document')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-yellow-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">–î–æ–∫—É–º–µ–Ω—Ç</div>
                                <div class="text-xs text-gray-400">PDF, Word, Excel</div>
                            </div>
                        </button>
                    </div>
                    <button onclick="closeFilePicker()" class="w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            menu.id = 'filePickerModal';
            document.body.appendChild(menu);
        }

        function closeFilePicker() {
            const modal = document.getElementById('filePickerModal');
            if (modal) modal.remove();
        }

        function selectFileType(type) {
            const input = document.getElementById('fileInput');
            
            if (type === 'camera') {
                input.accept = 'image/*';
                input.capture = 'environment';
            } else if (type === 'photo') {
                input.accept = 'image/*,video/*';
                input.removeAttribute('capture');
            } else if (type === 'document') {
                input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar';
                input.removeAttribute('capture');
            }
            
            input.click();
            closeFilePicker();
        }

        function formatTime(ts) {
            if (!ts) return '';
            const d = new Date(ts);
            const now = new Date();
            if (d.toDateString() === now.toDateString()) {
                return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            }
            return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
        }

        function formatLastSeen(ts) {
            if (!ts) return '–¥–∞–≤–Ω–æ';
            const diff = Date.now() - ts;
            if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (diff < 3600000) return `${Math.floor(diff / 60000)} –º–∏–Ω –Ω–∞–∑–∞–¥`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} —á –Ω–∞–∑–∞–¥`;
            return new Date(ts).toLocaleDateString('ru-RU');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('visibilitychange', () => {
            if (currentUser) updateOnlineStatus(!document.hidden);
            if (!document.hidden && currentChat) markAsRead(currentChat);
        });

        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            if (window.innerWidth >= 768) {
                // –î–µ—Å–∫—Ç–æ–ø - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–∞ –ø–∞–Ω–µ–ª–∏
                sidebar.style.display = 'flex';
                chatArea.style.display = 'flex';
                
                if (currentChat) {
                    sidebar.classList.add('chat-open');
                    chatArea.classList.add('active');
                    emptyChat.style.display = 'none';
                    activeChat.classList.add('active');
                    activeChat.style.display = 'flex';
                } else {
                    sidebar.classList.remove('chat-open');
                    chatArea.classList.remove('active');
                    emptyChat.style.display = 'flex';
                    activeChat.classList.remove('active');
                    activeChat.style.display = 'none';
                }
            } else {
                // –ú–æ–±–∏–ª—å–Ω—ã–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø–∞–Ω–µ–ª—å
                if (currentChat) {
                    sidebar.style.display = 'none';
                    chatArea.style.display = 'flex';
                    chatArea.classList.add('active');
                } else {
                    sidebar.style.display = 'flex';
                    chatArea.style.display = 'none';
                    chatArea.classList.remove('active');
                }
            }
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden'));
                closeImageViewer();
            }
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', e => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        });
    </script>
</body>
</html>