<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FlashChat Pro - ĞœĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ñ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { 
            font-family: 'Inter', sans-serif; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        html { 
            height: 100%;
            height: -webkit-fill-available;
        }
        body { 
            margin: 0;
            padding: 0;
            height: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .chat-scroll::-webkit-scrollbar { width: 6px; }
        .chat-scroll::-webkit-scrollbar-track { background: transparent; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        .message-in { border-radius: 18px 18px 18px 4px; }
        .message-out { border-radius: 18px 18px 4px 18px; }
        .typing-dot { animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up { animation: slideUp 0.3s ease; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .gradient-orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .gradient-blue { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); }
        .unread-badge { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .reaction-btn { transition: all 0.2s; }
        .reaction-btn:hover { transform: scale(1.3); }
        .modal-overlay { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .image-preview { 
            max-width: 280px; 
            max-height: 280px; 
            width: 100%;
            height: auto;
            object-fit: contain; 
            border-radius: 12px;
            display: block;
        }
        .message-image {
            max-width: 100%;
            border-radius: 12px;
            overflow: hidden;
        }
        .file-upload-progress { transition: width 0.3s; }
        
        /* Developer Badge */
        .dev-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: devBadgeGlow 2s ease-in-out infinite;
            vertical-align: middle;
        }
        .dev-badge svg {
            width: 10px;
            height: 10px;
        }
        @keyframes devBadgeGlow {
            0%, 100% { box-shadow: 0 0 5px rgba(240, 147, 251, 0.5); }
            50% { box-shadow: 0 0 15px rgba(240, 147, 251, 0.8), 0 0 25px rgba(245, 87, 108, 0.5); }
        }
        
        @supports (padding-top: env(safe-area-inset-top)) {
            .safe-top { padding-top: env(safe-area-inset-top); }
            .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        }
        
        /* ===== ĞĞ¡ĞĞĞ’ĞĞ«Ğ• ĞšĞĞĞ¢Ğ•Ğ™ĞĞ•Ğ Ğ« ===== */
        
        /* Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ Ñ‡Ğ°Ñ‚Ğ° */
        #chatScreen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
        
        #chatScreen.active {
            display: flex;
            flex-direction: row;
        }
        
        /* Ğ¡Ğ°Ğ¹Ğ´Ğ±Ğ°Ñ€ */
        #sidebar {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            width: 100%;
            background: rgba(31, 41, 55, 0.5);
        }
        
        #chatList {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        /* ĞĞ±Ğ»Ğ°ÑÑ‚ÑŒ Ñ‡Ğ°Ñ‚Ğ° */
        #chatArea {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: #111827;
        }
        
        #chatArea.active {
            display: flex;
            flex-direction: column;
        }
        
        /* ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ñ‡Ğ°Ñ‚ */
        #emptyChat {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚ */
        #activeChat {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        #activeChat.active {
            display: flex;
        }
        
        /* Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ‡Ğ°Ñ‚Ğ° - Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ */
        #activeChat > .chat-header {
            flex-shrink: 0;
        }
        
        /* Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ‡Ğ°Ñ‚Ğ° */
        .chat-header {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-bottom: 1px solid rgba(75, 85, 99, 0.5);
            z-index: 20;
        }
        
        /* ĞšĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ */
        #messagesContainer {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding: 16px;
            padding-bottom: 20px;
            min-height: 0;
        }
        
        /* Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ¸ */
        #typingIndicator {
            flex: 0 0 auto;
        }
        
        /* ĞŸÑ€ĞµĞ²ÑŒÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ */
        #uploadPreview {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        /* ĞĞ±Ğ»Ğ°ÑÑ‚ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ */
        #messageInputArea {
            flex: 0 0 auto;
            background: #1f2937;
            border-top: 1px solid #374151;
            padding: 12px;
            padding-bottom: 12px;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            z-index: 100;
        }
        
        /* Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ²Ğ²Ğ¾Ğ´Ğ° */
        #messageInputArea form {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        #messageInputArea input[type="text"] {
            flex: 1;
            min-width: 0;
            height: 44px;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid #4b5563;
            border-radius: 12px;
            padding: 0 16px;
            color: white;
            font-size: 14px;
        }
        
        #messageInputArea input[type="text"]:focus {
            outline: none;
            border-color: #8b5cf6;
        }
        
        #messageInputArea button {
            flex-shrink: 0;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        #messageInputArea button:hover {
            opacity: 0.8;
        }
        
        #messageInputArea button[type="submit"] {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        #messageInputArea button[type="button"] {
            background: transparent;
            color: #9ca3af;
        }
        
        #messageInputArea button[type="button"]:hover {
            background: rgba(55, 65, 81, 0.5);
            color: white;
        }
        
        /* Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ° */
        #channelNotice {
            flex: 0 0 auto;
            background: rgba(31, 41, 55, 0.95);
            border-top: 1px solid rgba(75, 85, 99, 0.5);
        }
        
        /* ===== ĞœĞĞ‘Ğ˜Ğ›Ğ¬ĞĞĞ¯ ĞĞ”ĞĞŸĞ¢ĞĞ¦Ğ˜Ğ¯ ===== */
        @media (max-width: 768px) {
            #sidebar {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
            }
            
            #chatArea {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }
        }
        
        /* ===== Ğ”Ğ•Ğ¡ĞšĞ¢ĞĞŸ ===== */
        @media (min-width: 769px) {
            #chatScreen.active {
                flex-direction: row;
            }
            
            #sidebar {
                position: relative;
                width: 100%;
                max-width: 100%;
                transition: all 0.3s ease;
            }
            
            #sidebar.chat-open {
                width: 384px;
                min-width: 384px;
                max-width: 384px;
                flex: 0 0 384px;
            }
            
            #chatArea {
                position: relative;
                flex: 1 1 auto;
            }
            
            #chatArea.active {
                display: flex;
            }
        }
        
        /* Ğ¤Ğ¸ĞºÑ Ğ´Ğ»Ñ iOS Safari */
        @supports (-webkit-touch-callout: none) {
            body {
                height: -webkit-fill-available;
            }
            #chatScreen, #chatArea, #sidebar, #activeChat {
                height: -webkit-fill-available;
            }
        }
        
        /* Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ¸ĞºÑÑ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ¾Ğ² */
        @media screen and (max-height: 500px) {
            #messageInputArea {
                padding: 8px;
            }
            #emojiPicker {
                max-height: 120px;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden">
    <!-- Auth Screen -->
    <div id="authScreen" class="h-full flex items-center justify-center p-4 overflow-y-auto">
        <div class="w-full max-w-md">
            <div class="text-center mb-6">
                <div class="w-20 h-20 gradient-bg rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg shadow-purple-500/30">
                    <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-white">FlashChat Pro</h1>
                <p class="text-gray-400 mt-2">ĞœĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ĞºĞ¾Ğ»ĞµĞ½Ğ¸Ñ</p>
            </div>
            
            <div id="savedAccounts" class="hidden mb-4">
                <p class="text-sm text-gray-400 mb-2">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹:</p>
                <div id="accountsList" class="space-y-2 max-h-32 overflow-y-auto"></div>
            </div>
            
            <div class="bg-gray-800/50 backdrop-blur-xl rounded-3xl p-6 shadow-2xl border border-gray-700/50">
                <div class="flex mb-6 bg-gray-700/50 rounded-xl p-1">
                    <button onclick="showTab('login')" id="loginTab" class="flex-1 py-2 px-4 rounded-lg font-medium transition-all bg-purple-600 text-white">Ğ’Ñ…Ğ¾Ğ´</button>
                    <button onclick="showTab('register')" id="registerTab" class="flex-1 py-2 px-4 rounded-lg font-medium transition-all text-gray-400">Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ</button>
                </div>
                
                <form id="loginForm" onsubmit="login(event)" class="space-y-4">
                    <input type="email" id="loginEmail" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="Email">
                    <input type="password" id="loginPassword" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ">
                    <label class="flex items-center gap-2 text-sm text-gray-400">
                        <input type="checkbox" id="saveAccount" checked class="rounded">
                        <span>Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚</span>
                    </label>
                    <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-lg shadow-purple-500/30">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
                </form>
                
                <form id="registerForm" onsubmit="register(event)" class="space-y-4 hidden">
                    <input type="text" id="registerName" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="Ğ˜Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ">
                    <input type="email" id="registerEmail" required class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="Email">
                    <input type="password" id="registerPassword" required minlength="6" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 transition-colors" placeholder="ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ (Ğ¼Ğ¸Ğ½. 6 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)">
                    <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-lg shadow-purple-500/30">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚</button>
                </form>
                
                <div id="authError" class="mt-4 text-red-400 text-sm text-center hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main Chat Screen -->
    <div id="chatScreen" class="h-full">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-gray-800/50 backdrop-blur-xl border-r border-gray-700/50 safe-top">
            <div class="p-3 border-b border-gray-700/50 flex-shrink-0">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-xl font-bold text-white">FlashChat</h2>
                    <div class="flex gap-1">
                        <button onclick="showCreateMenu()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                        </button>
                        <button onclick="showAccountSwitcher()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                        <button onclick="showProfile()" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="flex gap-1 mb-3 bg-gray-700/30 rounded-xl p-1">
                    <button onclick="showChatTab('all')" id="tabAll" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium bg-purple-600">Ğ’ÑĞµ</button>
                    <button onclick="showChatTab('private')" id="tabPrivate" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğµ</button>
                    <button onclick="showChatTab('groups')" id="tabGroups" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">Ğ“Ñ€ÑƒĞ¿Ğ¿Ñ‹</button>
                    <button onclick="showChatTab('channels')" id="tabChannels" class="flex-1 py-2 px-3 rounded-lg text-sm font-medium text-gray-400">ĞšĞ°Ğ½Ğ°Ğ»Ñ‹</button>
                </div>
                
                <div class="relative">
                    <input type="text" id="searchInput" oninput="searchAll()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 pl-10 focus:outline-none focus:border-purple-500 transition-colors text-sm" placeholder="ĞŸĞ¾Ğ¸ÑĞº...">
                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
            </div>
            
            <div id="searchResults" class="hidden border-b border-gray-700/50 max-h-64 overflow-y-auto flex-shrink-0"></div>
            <div id="chatList" class="overflow-y-auto chat-scroll"></div>
        </div>
        
        <!-- Chat Area -->
        <div id="chatArea" class="bg-gray-900">
            <div id="emptyChat">
                <div class="text-center p-4">
                    <div class="w-24 h-24 bg-gray-800 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <svg class="w-12 h-12 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-400">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‡Ğ°Ñ‚</h3>
                    <p class="text-gray-500 mt-2">Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹</p>
                </div>
            </div>
            
            <div id="activeChat">
                <!-- Chat Header -->
                <div class="chat-header p-3 flex items-center gap-3 safe-top">
                    <button onclick="closeChat()" class="md:hidden p-2 hover:bg-gray-700/50 rounded-xl">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div id="chatAvatar" class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold flex-shrink-0"></div>
                    <div class="flex-1 min-w-0">
                        <h3 id="chatName" class="font-semibold truncate"></h3>
                        <p id="chatStatus" class="text-xs text-gray-400 truncate"></p>
                    </div>
                    <div id="chatHeaderActions" class="flex gap-1 flex-shrink-0"></div>
                </div>
                
                <!-- Messages Container -->
                <div id="messagesContainer" class="p-4 space-y-3 chat-scroll"></div>
                
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="hidden px-4 py-2">
                    <div class="flex items-center gap-2 text-gray-400 text-sm">
                        <div class="flex gap-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                        </div>
                        <span id="typingText">Ğ¿ĞµÑ‡Ğ°Ñ‚Ğ°ĞµÑ‚...</span>
                    </div>
                </div>
                
                <!-- Upload Preview -->
                <div id="uploadPreview" class="hidden p-3 border-t border-gray-700/50 bg-gray-800/50">
                    <div class="flex flex-col gap-2">
                        <div class="flex items-start gap-3">
                            <img id="uploadPreviewImage" src="" class="w-20 h-20 object-cover rounded-xl hidden">
                            <div id="uploadPreviewFile" class="hidden flex items-center gap-2 p-2 bg-gray-700/50 rounded-xl">
                                <svg class="w-8 h-8 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <span id="uploadFileName" class="text-sm truncate max-w-[150px]"></span>
                            </div>
                            <div class="flex-1 flex flex-col gap-2">
                                <input type="text" id="imageCaption" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-3 py-2 text-sm focus:outline-none focus:border-purple-500" placeholder="Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ...">
                                <div id="uploadProgress" class="h-2 bg-gray-700 rounded-full overflow-hidden hidden">
                                    <div id="uploadProgressBar" class="h-full gradient-bg file-upload-progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <button onclick="cancelUpload()" class="p-2 hover:bg-gray-700/50 rounded-xl text-gray-400 shrink-0">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        <button onclick="sendFileWithCaption()" class="w-full gradient-bg py-2 rounded-xl font-medium text-sm hover:opacity-90 transition-opacity">
                            ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ
                        </button>
                    </div>
                </div>
                
                <!-- Message Input -->
                <div id="messageInputArea">
                    <form onsubmit="sendMessage(event)">
                        <input type="file" id="fileInput" class="hidden" accept="image/*,video/*,.pdf,.doc,.docx,.xls,.xlsx,.zip,.rar" onchange="handleFileSelect(event)">
                        
                        <button type="button" onclick="openFilePicker()" title="ĞŸÑ€Ğ¸ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                            </svg>
                        </button>
                        
                        <button type="button" onclick="toggleEmoji()" title="Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </button>
                        
                        <input type="text" id="messageInput" oninput="handleTyping()" placeholder="Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ..." autocomplete="off">
                        
                        <button type="submit" title="ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                            </svg>
                        </button>
                    </form>
                    
                    <div id="emojiPicker" class="hidden mt-2 bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
                        <!-- ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ -->
                        <div class="flex border-b border-gray-700 bg-gray-800/50">
                            <button type="button" onclick="showEmojiCategory('smileys')" id="emojiCatSmileys" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-purple-500">ğŸ˜€</button>
                            <button type="button" onclick="showEmojiCategory('gestures')" id="emojiCatGestures" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">ğŸ‘‹</button>
                            <button type="button" onclick="showEmojiCategory('animals')" id="emojiCatAnimals" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">ğŸ±</button>
                            <button type="button" onclick="showEmojiCategory('food')" id="emojiCatFood" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">ğŸ•</button>
                            <button type="button" onclick="showEmojiCategory('activities')" id="emojiCatActivities" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">âš½</button>
                            <button type="button" onclick="showEmojiCategory('travel')" id="emojiCatTravel" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">ğŸš—</button>
                            <button type="button" onclick="showEmojiCategory('objects')" id="emojiCatObjects" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">ğŸ’¡</button>
                            <button type="button" onclick="showEmojiCategory('symbols')" id="emojiCatSymbols" class="flex-1 p-2 text-lg hover:bg-gray-700 border-b-2 border-transparent">â¤ï¸</button>
                        </div>
                        <!-- Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€ -->
                        <div id="emojiContainer" class="p-2 max-h-48 overflow-y-auto chat-scroll">
                            <div id="emojiSmileys" class="grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('ğŸ˜€')" class="hover:bg-gray-600 rounded p-1">ğŸ˜€</button>
                                <button type="button" onclick="addEmoji('ğŸ˜ƒ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜ƒ</button>
                                <button type="button" onclick="addEmoji('ğŸ˜„')" class="hover:bg-gray-600 rounded p-1">ğŸ˜„</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ˜…')" class="hover:bg-gray-600 rounded p-1">ğŸ˜…</button>
                                <button type="button" onclick="addEmoji('ğŸ˜‚')" class="hover:bg-gray-600 rounded p-1">ğŸ˜‚</button>
                                <button type="button" onclick="addEmoji('ğŸ¤£')" class="hover:bg-gray-600 rounded p-1">ğŸ¤£</button>
                                <button type="button" onclick="addEmoji('ğŸ˜Š')" class="hover:bg-gray-600 rounded p-1">ğŸ˜Š</button>
                                <button type="button" onclick="addEmoji('ğŸ˜‡')" class="hover:bg-gray-600 rounded p-1">ğŸ˜‡</button>
                                <button type="button" onclick="addEmoji('ğŸ™‚')" class="hover:bg-gray-600 rounded p-1">ğŸ™‚</button>
                                <button type="button" onclick="addEmoji('ğŸ˜‰')" class="hover:bg-gray-600 rounded p-1">ğŸ˜‰</button>
                                <button type="button" onclick="addEmoji('ğŸ˜Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ¥°')" class="hover:bg-gray-600 rounded p-1">ğŸ¥°</button>
                                <button type="button" onclick="addEmoji('ğŸ˜˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜˜</button>
                                <button type="button" onclick="addEmoji('ğŸ˜—')" class="hover:bg-gray-600 rounded p-1">ğŸ˜—</button>
                                <button type="button" onclick="addEmoji('ğŸ˜‹')" class="hover:bg-gray-600 rounded p-1">ğŸ˜‹</button>
                                <button type="button" onclick="addEmoji('ğŸ˜›')" class="hover:bg-gray-600 rounded p-1">ğŸ˜›</button>
                                <button type="button" onclick="addEmoji('ğŸ˜œ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜œ</button>
                                <button type="button" onclick="addEmoji('ğŸ¤ª')" class="hover:bg-gray-600 rounded p-1">ğŸ¤ª</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ¤‘')" class="hover:bg-gray-600 rounded p-1">ğŸ¤‘</button>
                                <button type="button" onclick="addEmoji('ğŸ¤—')" class="hover:bg-gray-600 rounded p-1">ğŸ¤—</button>
                                <button type="button" onclick="addEmoji('ğŸ¤­')" class="hover:bg-gray-600 rounded p-1">ğŸ¤­</button>
                                <button type="button" onclick="addEmoji('ğŸ¤«')" class="hover:bg-gray-600 rounded p-1">ğŸ¤«</button>
                                <button type="button" onclick="addEmoji('ğŸ¤”')" class="hover:bg-gray-600 rounded p-1">ğŸ¤”</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¨</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ˜‘')" class="hover:bg-gray-600 rounded p-1">ğŸ˜‘</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¶')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¶</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ˜’')" class="hover:bg-gray-600 rounded p-1">ğŸ˜’</button>
                                <button type="button" onclick="addEmoji('ğŸ™„')" class="hover:bg-gray-600 rounded p-1">ğŸ™„</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¬')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¬</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¥</button>
                                <button type="button" onclick="addEmoji('ğŸ˜Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ˜”')" class="hover:bg-gray-600 rounded p-1">ğŸ˜”</button>
                                <button type="button" onclick="addEmoji('ğŸ˜ª')" class="hover:bg-gray-600 rounded p-1">ğŸ˜ª</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¤</button>
                                <button type="button" onclick="addEmoji('ğŸ˜´')" class="hover:bg-gray-600 rounded p-1">ğŸ˜´</button>
                                <button type="button" onclick="addEmoji('ğŸ˜·')" class="hover:bg-gray-600 rounded p-1">ğŸ˜·</button>
                                <button type="button" onclick="addEmoji('ğŸ¤’')" class="hover:bg-gray-600 rounded p-1">ğŸ¤’</button>
                                <button type="button" onclick="addEmoji('ğŸ¤•')" class="hover:bg-gray-600 rounded p-1">ğŸ¤•</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¢')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¢</button>
                                <button type="button" onclick="addEmoji('ğŸ¤®')" class="hover:bg-gray-600 rounded p-1">ğŸ¤®</button>
                                <button type="button" onclick="addEmoji('ğŸ¥µ')" class="hover:bg-gray-600 rounded p-1">ğŸ¥µ</button>
                                <button type="button" onclick="addEmoji('ğŸ¥¶')" class="hover:bg-gray-600 rounded p-1">ğŸ¥¶</button>
                                <button type="button" onclick="addEmoji('ğŸ¥´')" class="hover:bg-gray-600 rounded p-1">ğŸ¥´</button>
                                <button type="button" onclick="addEmoji('ğŸ˜µ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜µ</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¯')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¯</button>
                                <button type="button" onclick="addEmoji('ğŸ¤ ')" class="hover:bg-gray-600 rounded p-1">ğŸ¤ </button>
                                <button type="button" onclick="addEmoji('ğŸ¥³')" class="hover:bg-gray-600 rounded p-1">ğŸ¥³</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ¤“')" class="hover:bg-gray-600 rounded p-1">ğŸ¤“</button>
                                <button type="button" onclick="addEmoji('ğŸ§')" class="hover:bg-gray-600 rounded p-1">ğŸ§</button>
                                <button type="button" onclick="addEmoji('ğŸ˜•')" class="hover:bg-gray-600 rounded p-1">ğŸ˜•</button>
                                <button type="button" onclick="addEmoji('ğŸ˜Ÿ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜Ÿ</button>
                                <button type="button" onclick="addEmoji('ğŸ™')" class="hover:bg-gray-600 rounded p-1">ğŸ™</button>
                                <button type="button" onclick="addEmoji('ğŸ˜®')" class="hover:bg-gray-600 rounded p-1">ğŸ˜®</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¯')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¯</button>
                                <button type="button" onclick="addEmoji('ğŸ˜²')" class="hover:bg-gray-600 rounded p-1">ğŸ˜²</button>
                                <button type="button" onclick="addEmoji('ğŸ˜³')" class="hover:bg-gray-600 rounded p-1">ğŸ˜³</button>
                                <button type="button" onclick="addEmoji('ğŸ¥º')" class="hover:bg-gray-600 rounded p-1">ğŸ¥º</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¦')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¦</button>
                                <button type="button" onclick="addEmoji('ğŸ˜§')" class="hover:bg-gray-600 rounded p-1">ğŸ˜§</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¨')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¨</button>
                                <button type="button" onclick="addEmoji('ğŸ˜°')" class="hover:bg-gray-600 rounded p-1">ğŸ˜°</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¥')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¥</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¢')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¢</button>
                                <button type="button" onclick="addEmoji('ğŸ˜­')" class="hover:bg-gray-600 rounded p-1">ğŸ˜­</button>
                                <button type="button" onclick="addEmoji('ğŸ˜±')" class="hover:bg-gray-600 rounded p-1">ğŸ˜±</button>
                                <button type="button" onclick="addEmoji('ğŸ˜–')" class="hover:bg-gray-600 rounded p-1">ğŸ˜–</button>
                                <button type="button" onclick="addEmoji('ğŸ˜£')" class="hover:bg-gray-600 rounded p-1">ğŸ˜£</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ˜“')" class="hover:bg-gray-600 rounded p-1">ğŸ˜“</button>
                                <button type="button" onclick="addEmoji('ğŸ˜©')" class="hover:bg-gray-600 rounded p-1">ğŸ˜©</button>
                                <button type="button" onclick="addEmoji('ğŸ˜«')" class="hover:bg-gray-600 rounded p-1">ğŸ˜«</button>
                                <button type="button" onclick="addEmoji('ğŸ¥±')" class="hover:bg-gray-600 rounded p-1">ğŸ¥±</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¤')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¤</button>
                                <button type="button" onclick="addEmoji('ğŸ˜¡')" class="hover:bg-gray-600 rounded p-1">ğŸ˜¡</button>
                                <button type="button" onclick="addEmoji('ğŸ˜ ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜ </button>
                                <button type="button" onclick="addEmoji('ğŸ¤¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¬</button>
                                <button type="button" onclick="addEmoji('ğŸ˜ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ˜ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘¿')" class="hover:bg-gray-600 rounded p-1">ğŸ‘¿</button>
                                <button type="button" onclick="addEmoji('ğŸ’€')" class="hover:bg-gray-600 rounded p-1">ğŸ’€</button>
                                <button type="button" onclick="addEmoji('â˜ ï¸')" class="hover:bg-gray-600 rounded p-1">â˜ ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’©')" class="hover:bg-gray-600 rounded p-1">ğŸ’©</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¡')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¡</button>
                                <button type="button" onclick="addEmoji('ğŸ‘¹')" class="hover:bg-gray-600 rounded p-1">ğŸ‘¹</button>
                                <button type="button" onclick="addEmoji('ğŸ‘º')" class="hover:bg-gray-600 rounded p-1">ğŸ‘º</button>
                                <button type="button" onclick="addEmoji('ğŸ‘»')" class="hover:bg-gray-600 rounded p-1">ğŸ‘»</button>
                                <button type="button" onclick="addEmoji('ğŸ‘½')" class="hover:bg-gray-600 rounded p-1">ğŸ‘½</button>
                                <button type="button" onclick="addEmoji('ğŸ‘¾')" class="hover:bg-gray-600 rounded p-1">ğŸ‘¾</button>
                                <button type="button" onclick="addEmoji('ğŸ¤–')" class="hover:bg-gray-600 rounded p-1">ğŸ¤–</button>
                            </div>
                            <div id="emojiGestures" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('ğŸ‘‹')" class="hover:bg-gray-600 rounded p-1">ğŸ‘‹</button>
                                <button type="button" onclick="addEmoji('ğŸ¤š')" class="hover:bg-gray-600 rounded p-1">ğŸ¤š</button>
                                <button type="button" onclick="addEmoji('ğŸ–ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ–ï¸</button>
                                <button type="button" onclick="addEmoji('âœ‹')" class="hover:bg-gray-600 rounded p-1">âœ‹</button>
                                <button type="button" onclick="addEmoji('ğŸ––')" class="hover:bg-gray-600 rounded p-1">ğŸ––</button>
                                <button type="button" onclick="addEmoji('ğŸ‘Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ‘Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ¤Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ¤Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('âœŒï¸')" class="hover:bg-gray-600 rounded p-1">âœŒï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ¤Ÿ')" class="hover:bg-gray-600 rounded p-1">ğŸ¤Ÿ</button>
                                <button type="button" onclick="addEmoji('ğŸ¤˜')" class="hover:bg-gray-600 rounded p-1">ğŸ¤˜</button>
                                <button type="button" onclick="addEmoji('ğŸ¤™')" class="hover:bg-gray-600 rounded p-1">ğŸ¤™</button>
                                <button type="button" onclick="addEmoji('ğŸ‘ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ‘ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘‰')" class="hover:bg-gray-600 rounded p-1">ğŸ‘‰</button>
                                <button type="button" onclick="addEmoji('ğŸ‘†')" class="hover:bg-gray-600 rounded p-1">ğŸ‘†</button>
                                <button type="button" onclick="addEmoji('ğŸ–•')" class="hover:bg-gray-600 rounded p-1">ğŸ–•</button>
                                <button type="button" onclick="addEmoji('ğŸ‘‡')" class="hover:bg-gray-600 rounded p-1">ğŸ‘‡</button>
                                <button type="button" onclick="addEmoji('â˜ï¸')" class="hover:bg-gray-600 rounded p-1">â˜ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('âœŠ')" class="hover:bg-gray-600 rounded p-1">âœŠ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘Š')" class="hover:bg-gray-600 rounded p-1">ğŸ‘Š</button>
                                <button type="button" onclick="addEmoji('ğŸ¤›')" class="hover:bg-gray-600 rounded p-1">ğŸ¤›</button>
                                <button type="button" onclick="addEmoji('ğŸ¤œ')" class="hover:bg-gray-600 rounded p-1">ğŸ¤œ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('ğŸ™Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ™Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('ğŸ¤²')" class="hover:bg-gray-600 rounded p-1">ğŸ¤²</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ™')" class="hover:bg-gray-600 rounded p-1">ğŸ™</button>
                                <button type="button" onclick="addEmoji('âœï¸')" class="hover:bg-gray-600 rounded p-1">âœï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’…')" class="hover:bg-gray-600 rounded p-1">ğŸ’…</button>
                                <button type="button" onclick="addEmoji('ğŸ¤³')" class="hover:bg-gray-600 rounded p-1">ğŸ¤³</button>
                                <button type="button" onclick="addEmoji('ğŸ’ª')" class="hover:bg-gray-600 rounded p-1">ğŸ’ª</button>
                                <button type="button" onclick="addEmoji('ğŸ¦¾')" class="hover:bg-gray-600 rounded p-1">ğŸ¦¾</button>
                                <button type="button" onclick="addEmoji('ğŸ¦¿')" class="hover:bg-gray-600 rounded p-1">ğŸ¦¿</button>
                                <button type="button" onclick="addEmoji('ğŸ¦µ')" class="hover:bg-gray-600 rounded p-1">ğŸ¦µ</button>
                                <button type="button" onclick="addEmoji('ğŸ¦¶')" class="hover:bg-gray-600 rounded p-1">ğŸ¦¶</button>
                                <button type="button" onclick="addEmoji('ğŸ‘‚')" class="hover:bg-gray-600 rounded p-1">ğŸ‘‚</button>
                                <button type="button" onclick="addEmoji('ğŸ‘ƒ')" class="hover:bg-gray-600 rounded p-1">ğŸ‘ƒ</button>
                                <button type="button" onclick="addEmoji('ğŸ‘€')" class="hover:bg-gray-600 rounded p-1">ğŸ‘€</button>
                                <button type="button" onclick="addEmoji('ğŸ‘ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ‘ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ‘…')" class="hover:bg-gray-600 rounded p-1">ğŸ‘…</button>
                                <button type="button" onclick="addEmoji('ğŸ‘„')" class="hover:bg-gray-600 rounded p-1">ğŸ‘„</button>
                                <button type="button" onclick="addEmoji('ğŸ’‹')" class="hover:bg-gray-600 rounded p-1">ğŸ’‹</button>
                                <button type="button" onclick="addEmoji('ğŸ§ ')" class="hover:bg-gray-600 rounded p-1">ğŸ§ </button>
                                <button type="button" onclick="addEmoji('ğŸ«€')" class="hover:bg-gray-600 rounded p-1">ğŸ«€</button>
                            </div>
                            <div id="emojiAnimals" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('ğŸ¶')" class="hover:bg-gray-600 rounded p-1">ğŸ¶</button>
                                <button type="button" onclick="addEmoji('ğŸ±')" class="hover:bg-gray-600 rounded p-1">ğŸ±</button>
                                <button type="button" onclick="addEmoji('ğŸ­')" class="hover:bg-gray-600 rounded p-1">ğŸ­</button>
                                <button type="button" onclick="addEmoji('ğŸ¹')" class="hover:bg-gray-600 rounded p-1">ğŸ¹</button>
                                <button type="button" onclick="addEmoji('ğŸ°')" class="hover:bg-gray-600 rounded p-1">ğŸ°</button>
                                <button type="button" onclick="addEmoji('ğŸ¦Š')" class="hover:bg-gray-600 rounded p-1">ğŸ¦Š</button>
                                <button type="button" onclick="addEmoji('ğŸ»')" class="hover:bg-gray-600 rounded p-1">ğŸ»</button>
                                <button type="button" onclick="addEmoji('ğŸ¼')" class="hover:bg-gray-600 rounded p-1">ğŸ¼</button>
                                <button type="button" onclick="addEmoji('ğŸ¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¨</button>
                                <button type="button" onclick="addEmoji('ğŸ¯')" class="hover:bg-gray-600 rounded p-1">ğŸ¯</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ®')" class="hover:bg-gray-600 rounded p-1">ğŸ®</button>
                                <button type="button" onclick="addEmoji('ğŸ·')" class="hover:bg-gray-600 rounded p-1">ğŸ·</button>
                                <button type="button" onclick="addEmoji('ğŸ¸')" class="hover:bg-gray-600 rounded p-1">ğŸ¸</button>
                                <button type="button" onclick="addEmoji('ğŸµ')" class="hover:bg-gray-600 rounded p-1">ğŸµ</button>
                                <button type="button" onclick="addEmoji('ğŸ™ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ™ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ™‰')" class="hover:bg-gray-600 rounded p-1">ğŸ™‰</button>
                                <button type="button" onclick="addEmoji('ğŸ™Š')" class="hover:bg-gray-600 rounded p-1">ğŸ™Š</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('ğŸ”')" class="hover:bg-gray-600 rounded p-1">ğŸ”</button>
                                <button type="button" onclick="addEmoji('ğŸ§')" class="hover:bg-gray-600 rounded p-1">ğŸ§</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ¦†')" class="hover:bg-gray-600 rounded p-1">ğŸ¦†</button>
                                <button type="button" onclick="addEmoji('ğŸ¦…')" class="hover:bg-gray-600 rounded p-1">ğŸ¦…</button>
                                <button type="button" onclick="addEmoji('ğŸ¦‰')" class="hover:bg-gray-600 rounded p-1">ğŸ¦‰</button>
                                <button type="button" onclick="addEmoji('ğŸ¦‡')" class="hover:bg-gray-600 rounded p-1">ğŸ¦‡</button>
                                <button type="button" onclick="addEmoji('ğŸº')" class="hover:bg-gray-600 rounded p-1">ğŸº</button>
                                <button type="button" onclick="addEmoji('ğŸ—')" class="hover:bg-gray-600 rounded p-1">ğŸ—</button>
                                <button type="button" onclick="addEmoji('ğŸ´')" class="hover:bg-gray-600 rounded p-1">ğŸ´</button>
                                <button type="button" onclick="addEmoji('ğŸ¦„')" class="hover:bg-gray-600 rounded p-1">ğŸ¦„</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ›')" class="hover:bg-gray-600 rounded p-1">ğŸ›</button>
                                <button type="button" onclick="addEmoji('ğŸ¦‹')" class="hover:bg-gray-600 rounded p-1">ğŸ¦‹</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸœ')" class="hover:bg-gray-600 rounded p-1">ğŸœ</button>
                                <button type="button" onclick="addEmoji('ğŸ¦Ÿ')" class="hover:bg-gray-600 rounded p-1">ğŸ¦Ÿ</button>
                                <button type="button" onclick="addEmoji('ğŸ¢')" class="hover:bg-gray-600 rounded p-1">ğŸ¢</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¦–')" class="hover:bg-gray-600 rounded p-1">ğŸ¦–</button>
                                <button type="button" onclick="addEmoji('ğŸ¦•')" class="hover:bg-gray-600 rounded p-1">ğŸ¦•</button>
                                <button type="button" onclick="addEmoji('ğŸ™')" class="hover:bg-gray-600 rounded p-1">ğŸ™</button>
                                <button type="button" onclick="addEmoji('ğŸ¦‘')" class="hover:bg-gray-600 rounded p-1">ğŸ¦‘</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¦€')" class="hover:bg-gray-600 rounded p-1">ğŸ¦€</button>
                                <button type="button" onclick="addEmoji('ğŸ¡')" class="hover:bg-gray-600 rounded p-1">ğŸ¡</button>
                                <button type="button" onclick="addEmoji('ğŸ ')" class="hover:bg-gray-600 rounded p-1">ğŸ </button>
                                <button type="button" onclick="addEmoji('ğŸŸ')" class="hover:bg-gray-600 rounded p-1">ğŸŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¬</button>
                                <button type="button" onclick="addEmoji('ğŸ³')" class="hover:bg-gray-600 rounded p-1">ğŸ³</button>
                                <button type="button" onclick="addEmoji('ğŸ¦ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ¦ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸŠ')" class="hover:bg-gray-600 rounded p-1">ğŸŠ</button>
                                <button type="button" onclick="addEmoji('ğŸ…')" class="hover:bg-gray-600 rounded p-1">ğŸ…</button>
                            </div>
                            <div id="emojiFood" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸŠ')" class="hover:bg-gray-600 rounded p-1">ğŸŠ</button>
                                <button type="button" onclick="addEmoji('ğŸ‹')" class="hover:bg-gray-600 rounded p-1">ğŸ‹</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸ‰')" class="hover:bg-gray-600 rounded p-1">ğŸ‰</button>
                                <button type="button" onclick="addEmoji('ğŸ‡')" class="hover:bg-gray-600 rounded p-1">ğŸ‡</button>
                                <button type="button" onclick="addEmoji('ğŸ“')" class="hover:bg-gray-600 rounded p-1">ğŸ“</button>
                                <button type="button" onclick="addEmoji('ğŸ«')" class="hover:bg-gray-600 rounded p-1">ğŸ«</button>
                                <button type="button" onclick="addEmoji('ğŸˆ')" class="hover:bg-gray-600 rounded p-1">ğŸˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('ğŸ¥­')" class="hover:bg-gray-600 rounded p-1">ğŸ¥­</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ¥¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥¥</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ…')" class="hover:bg-gray-600 rounded p-1">ğŸ…</button>
                                <button type="button" onclick="addEmoji('ğŸ¥‘')" class="hover:bg-gray-600 rounded p-1">ğŸ¥‘</button>
                                <button type="button" onclick="addEmoji('ğŸ†')" class="hover:bg-gray-600 rounded p-1">ğŸ†</button>
                                <button type="button" onclick="addEmoji('ğŸ¥”')" class="hover:bg-gray-600 rounded p-1">ğŸ¥”</button>
                                <button type="button" onclick="addEmoji('ğŸ¥•')" class="hover:bg-gray-600 rounded p-1">ğŸ¥•</button>
                                <button type="button" onclick="addEmoji('ğŸŒ½')" class="hover:bg-gray-600 rounded p-1">ğŸŒ½</button>
                                <button type="button" onclick="addEmoji('ğŸŒ¶ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸŒ¶ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¥’')" class="hover:bg-gray-600 rounded p-1">ğŸ¥’</button>
                                <button type="button" onclick="addEmoji('ğŸ¥¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¥¬</button>
                                <button type="button" onclick="addEmoji('ğŸ§„')" class="hover:bg-gray-600 rounded p-1">ğŸ§„</button>
                                <button type="button" onclick="addEmoji('ğŸ§…')" class="hover:bg-gray-600 rounded p-1">ğŸ§…</button>
                                <button type="button" onclick="addEmoji('ğŸ„')" class="hover:bg-gray-600 rounded p-1">ğŸ„</button>
                                <button type="button" onclick="addEmoji('ğŸ¥œ')" class="hover:bg-gray-600 rounded p-1">ğŸ¥œ</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ¥–')" class="hover:bg-gray-600 rounded p-1">ğŸ¥–</button>
                                <button type="button" onclick="addEmoji('ğŸ¥¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¥¨</button>
                                <button type="button" onclick="addEmoji('ğŸ§€')" class="hover:bg-gray-600 rounded p-1">ğŸ§€</button>
                                <button type="button" onclick="addEmoji('ğŸ¥š')" class="hover:bg-gray-600 rounded p-1">ğŸ¥š</button>
                                <button type="button" onclick="addEmoji('ğŸ³')" class="hover:bg-gray-600 rounded p-1">ğŸ³</button>
                                <button type="button" onclick="addEmoji('ğŸ¥“')" class="hover:bg-gray-600 rounded p-1">ğŸ¥“</button>
                                <button type="button" onclick="addEmoji('ğŸ¥©')" class="hover:bg-gray-600 rounded p-1">ğŸ¥©</button>
                                <button type="button" onclick="addEmoji('ğŸ—')" class="hover:bg-gray-600 rounded p-1">ğŸ—</button>
                                <button type="button" onclick="addEmoji('ğŸ–')" class="hover:bg-gray-600 rounded p-1">ğŸ–</button>
                                <button type="button" onclick="addEmoji('ğŸŒ­')" class="hover:bg-gray-600 rounded p-1">ğŸŒ­</button>
                                <button type="button" onclick="addEmoji('ğŸ”')" class="hover:bg-gray-600 rounded p-1">ğŸ”</button>
                                <button type="button" onclick="addEmoji('ğŸŸ')" class="hover:bg-gray-600 rounded p-1">ğŸŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ•')" class="hover:bg-gray-600 rounded p-1">ğŸ•</button>
                                <button type="button" onclick="addEmoji('ğŸ¥ª')" class="hover:bg-gray-600 rounded p-1">ğŸ¥ª</button>
                                <button type="button" onclick="addEmoji('ğŸŒ®')" class="hover:bg-gray-600 rounded p-1">ğŸŒ®</button>
                                <button type="button" onclick="addEmoji('ğŸŒ¯')" class="hover:bg-gray-600 rounded p-1">ğŸŒ¯</button>
                                <button type="button" onclick="addEmoji('ğŸ¥™')" class="hover:bg-gray-600 rounded p-1">ğŸ¥™</button>
                                <button type="button" onclick="addEmoji('ğŸ§†')" class="hover:bg-gray-600 rounded p-1">ğŸ§†</button>
                                <button type="button" onclick="addEmoji('ğŸ¥—')" class="hover:bg-gray-600 rounded p-1">ğŸ¥—</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸœ')" class="hover:bg-gray-600 rounded p-1">ğŸœ</button>
                                <button type="button" onclick="addEmoji('ğŸ²')" class="hover:bg-gray-600 rounded p-1">ğŸ²</button>
                                <button type="button" onclick="addEmoji('ğŸ›')" class="hover:bg-gray-600 rounded p-1">ğŸ›</button>
                                <button type="button" onclick="addEmoji('ğŸ£')" class="hover:bg-gray-600 rounded p-1">ğŸ£</button>
                                <button type="button" onclick="addEmoji('ğŸ±')" class="hover:bg-gray-600 rounded p-1">ğŸ±</button>
                                <button type="button" onclick="addEmoji('ğŸ™')" class="hover:bg-gray-600 rounded p-1">ğŸ™</button>
                                <button type="button" onclick="addEmoji('ğŸš')" class="hover:bg-gray-600 rounded p-1">ğŸš</button>
                                <button type="button" onclick="addEmoji('ğŸ˜')" class="hover:bg-gray-600 rounded p-1">ğŸ˜</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ¥®')" class="hover:bg-gray-600 rounded p-1">ğŸ¥®</button>
                                <button type="button" onclick="addEmoji('ğŸ¢')" class="hover:bg-gray-600 rounded p-1">ğŸ¢</button>
                                <button type="button" onclick="addEmoji('ğŸ§')" class="hover:bg-gray-600 rounded p-1">ğŸ§</button>
                                <button type="button" onclick="addEmoji('ğŸ¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¨</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¥§')" class="hover:bg-gray-600 rounded p-1">ğŸ¥§</button>
                                <button type="button" onclick="addEmoji('ğŸ§')" class="hover:bg-gray-600 rounded p-1">ğŸ§</button>
                                <button type="button" onclick="addEmoji('ğŸ°')" class="hover:bg-gray-600 rounded p-1">ğŸ°</button>
                                <button type="button" onclick="addEmoji('ğŸ‚')" class="hover:bg-gray-600 rounded p-1">ğŸ‚</button>
                                <button type="button" onclick="addEmoji('ğŸ®')" class="hover:bg-gray-600 rounded p-1">ğŸ®</button>
                                <button type="button" onclick="addEmoji('ğŸ­')" class="hover:bg-gray-600 rounded p-1">ğŸ­</button>
                                <button type="button" onclick="addEmoji('ğŸ¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¬</button>
                                <button type="button" onclick="addEmoji('ğŸ«')" class="hover:bg-gray-600 rounded p-1">ğŸ«</button>
                                <button type="button" onclick="addEmoji('ğŸ¿')" class="hover:bg-gray-600 rounded p-1">ğŸ¿</button>
                                <button type="button" onclick="addEmoji('ğŸ©')" class="hover:bg-gray-600 rounded p-1">ğŸ©</button>
                                <button type="button" onclick="addEmoji('ğŸª')" class="hover:bg-gray-600 rounded p-1">ğŸª</button>
                                <button type="button" onclick="addEmoji('â˜•')" class="hover:bg-gray-600 rounded p-1">â˜•</button>
                                <button type="button" onclick="addEmoji('ğŸµ')" class="hover:bg-gray-600 rounded p-1">ğŸµ</button>
                                <button type="button" onclick="addEmoji('ğŸ§ƒ')" class="hover:bg-gray-600 rounded p-1">ğŸ§ƒ</button>
                                <button type="button" onclick="addEmoji('ğŸ¥¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¥¤</button>
                                <button type="button" onclick="addEmoji('ğŸ§‹')" class="hover:bg-gray-600 rounded p-1">ğŸ§‹</button>
                                <button type="button" onclick="addEmoji('ğŸº')" class="hover:bg-gray-600 rounded p-1">ğŸº</button>
                                <button type="button" onclick="addEmoji('ğŸ»')" class="hover:bg-gray-600 rounded p-1">ğŸ»</button>
                                <button type="button" onclick="addEmoji('ğŸ¥‚')" class="hover:bg-gray-600 rounded p-1">ğŸ¥‚</button>
                                <button type="button" onclick="addEmoji('ğŸ·')" class="hover:bg-gray-600 rounded p-1">ğŸ·</button>
                                <button type="button" onclick="addEmoji('ğŸ¸')" class="hover:bg-gray-600 rounded p-1">ğŸ¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¹')" class="hover:bg-gray-600 rounded p-1">ğŸ¹</button>
                            </div>
                            <div id="emojiActivities" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('âš½')" class="hover:bg-gray-600 rounded p-1">âš½</button>
                                <button type="button" onclick="addEmoji('ğŸ€')" class="hover:bg-gray-600 rounded p-1">ğŸ€</button>
                                <button type="button" onclick="addEmoji('ğŸˆ')" class="hover:bg-gray-600 rounded p-1">ğŸˆ</button>
                                <button type="button" onclick="addEmoji('âš¾')" class="hover:bg-gray-600 rounded p-1">âš¾</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ¾')" class="hover:bg-gray-600 rounded p-1">ğŸ¾</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ‰')" class="hover:bg-gray-600 rounded p-1">ğŸ‰</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ±')" class="hover:bg-gray-600 rounded p-1">ğŸ±</button>
                                <button type="button" onclick="addEmoji('ğŸª€')" class="hover:bg-gray-600 rounded p-1">ğŸª€</button>
                                <button type="button" onclick="addEmoji('ğŸ“')" class="hover:bg-gray-600 rounded p-1">ğŸ“</button>
                                <button type="button" onclick="addEmoji('ğŸ¸')" class="hover:bg-gray-600 rounded p-1">ğŸ¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('ğŸ‘')" class="hover:bg-gray-600 rounded p-1">ğŸ‘</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('â›³')" class="hover:bg-gray-600 rounded p-1">â›³</button>
                                <button type="button" onclick="addEmoji('ğŸª')" class="hover:bg-gray-600 rounded p-1">ğŸª</button>
                                <button type="button" onclick="addEmoji('ğŸ¹')" class="hover:bg-gray-600 rounded p-1">ğŸ¹</button>
                                <button type="button" onclick="addEmoji('ğŸ£')" class="hover:bg-gray-600 rounded p-1">ğŸ£</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¿')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¿</button>
                                <button type="button" onclick="addEmoji('ğŸ¥Š')" class="hover:bg-gray-600 rounded p-1">ğŸ¥Š</button>
                                <button type="button" onclick="addEmoji('ğŸ¥‹')" class="hover:bg-gray-600 rounded p-1">ğŸ¥‹</button>
                                <button type="button" onclick="addEmoji('ğŸ½')" class="hover:bg-gray-600 rounded p-1">ğŸ½</button>
                                <button type="button" onclick="addEmoji('ğŸ›¹')" class="hover:bg-gray-600 rounded p-1">ğŸ›¹</button>
                                <button type="button" onclick="addEmoji('ğŸ›·')" class="hover:bg-gray-600 rounded p-1">ğŸ›·</button>
                                <button type="button" onclick="addEmoji('â›¸ï¸')" class="hover:bg-gray-600 rounded p-1">â›¸ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¥Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ¥Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ¿')" class="hover:bg-gray-600 rounded p-1">ğŸ¿</button>
                                <button type="button" onclick="addEmoji('â›·ï¸')" class="hover:bg-gray-600 rounded p-1">â›·ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ‚')" class="hover:bg-gray-600 rounded p-1">ğŸ‚</button>
                                <button type="button" onclick="addEmoji('ğŸ‹ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ‹ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¼')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¼</button>
                                <button type="button" onclick="addEmoji('ğŸ¤¸')" class="hover:bg-gray-600 rounded p-1">ğŸ¤¸</button>
                                <button type="button" onclick="addEmoji('â›¹ï¸')" class="hover:bg-gray-600 rounded p-1">â›¹ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¤º')" class="hover:bg-gray-600 rounded p-1">ğŸ¤º</button>
                                <button type="button" onclick="addEmoji('ğŸ‡')" class="hover:bg-gray-600 rounded p-1">ğŸ‡</button>
                                <button type="button" onclick="addEmoji('ğŸ§˜')" class="hover:bg-gray-600 rounded p-1">ğŸ§˜</button>
                                <button type="button" onclick="addEmoji('ğŸ„')" class="hover:bg-gray-600 rounded p-1">ğŸ„</button>
                                <button type="button" onclick="addEmoji('ğŸŠ')" class="hover:bg-gray-600 rounded p-1">ğŸŠ</button>
                                <button type="button" onclick="addEmoji('ğŸš´')" class="hover:bg-gray-600 rounded p-1">ğŸš´</button>
                                <button type="button" onclick="addEmoji('ğŸšµ')" class="hover:bg-gray-600 rounded p-1">ğŸšµ</button>
                                <button type="button" onclick="addEmoji('ğŸª')" class="hover:bg-gray-600 rounded p-1">ğŸª</button>
                                <button type="button" onclick="addEmoji('ğŸ­')" class="hover:bg-gray-600 rounded p-1">ğŸ­</button>
                                <button type="button" onclick="addEmoji('ğŸ¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¨</button>
                                <button type="button" onclick="addEmoji('ğŸ¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¬</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ§')" class="hover:bg-gray-600 rounded p-1">ğŸ§</button>
                                <button type="button" onclick="addEmoji('ğŸ¼')" class="hover:bg-gray-600 rounded p-1">ğŸ¼</button>
                                <button type="button" onclick="addEmoji('ğŸ¹')" class="hover:bg-gray-600 rounded p-1">ğŸ¹</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ·')" class="hover:bg-gray-600 rounded p-1">ğŸ·</button>
                                <button type="button" onclick="addEmoji('ğŸº')" class="hover:bg-gray-600 rounded p-1">ğŸº</button>
                                <button type="button" onclick="addEmoji('ğŸ¸')" class="hover:bg-gray-600 rounded p-1">ğŸ¸</button>
                                <button type="button" onclick="addEmoji('ğŸ»')" class="hover:bg-gray-600 rounded p-1">ğŸ»</button>
                                <button type="button" onclick="addEmoji('ğŸ²')" class="hover:bg-gray-600 rounded p-1">ğŸ²</button>
                                <button type="button" onclick="addEmoji('â™Ÿï¸')" class="hover:bg-gray-600 rounded p-1">â™Ÿï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ¯')" class="hover:bg-gray-600 rounded p-1">ğŸ¯</button>
                                <button type="button" onclick="addEmoji('ğŸ³')" class="hover:bg-gray-600 rounded p-1">ğŸ³</button>
                                <button type="button" onclick="addEmoji('ğŸ®')" class="hover:bg-gray-600 rounded p-1">ğŸ®</button>
                                <button type="button" onclick="addEmoji('ğŸ•¹ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ•¹ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ°')" class="hover:bg-gray-600 rounded p-1">ğŸ°</button>
                                <button type="button" onclick="addEmoji('ğŸ§©')" class="hover:bg-gray-600 rounded p-1">ğŸ§©</button>
                            </div>
                            <div id="emojiTravel" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('ğŸš—')" class="hover:bg-gray-600 rounded p-1">ğŸš—</button>
                                <button type="button" onclick="addEmoji('ğŸš•')" class="hover:bg-gray-600 rounded p-1">ğŸš•</button>
                                <button type="button" onclick="addEmoji('ğŸš™')" class="hover:bg-gray-600 rounded p-1">ğŸš™</button>
                                <button type="button" onclick="addEmoji('ğŸšŒ')" class="hover:bg-gray-600 rounded p-1">ğŸšŒ</button>
                                <button type="button" onclick="addEmoji('ğŸš')" class="hover:bg-gray-600 rounded p-1">ğŸš</button>
                                <button type="button" onclick="addEmoji('ğŸï¸')" class="hover:bg-gray-600 rounded p-1">ğŸï¸</button>
                                <button type="button" onclick="addEmoji('ğŸš“')" class="hover:bg-gray-600 rounded p-1">ğŸš“</button>
                                <button type="button" onclick="addEmoji('ğŸš‘')" class="hover:bg-gray-600 rounded p-1">ğŸš‘</button>
                                <button type="button" onclick="addEmoji('ğŸš’')" class="hover:bg-gray-600 rounded p-1">ğŸš’</button>
                                <button type="button" onclick="addEmoji('ğŸš')" class="hover:bg-gray-600 rounded p-1">ğŸš</button>
                                <button type="button" onclick="addEmoji('ğŸ›»')" class="hover:bg-gray-600 rounded p-1">ğŸ›»</button>
                                <button type="button" onclick="addEmoji('ğŸšš')" class="hover:bg-gray-600 rounded p-1">ğŸšš</button>
                                <button type="button" onclick="addEmoji('ğŸš›')" class="hover:bg-gray-600 rounded p-1">ğŸš›</button>
                                <button type="button" onclick="addEmoji('ğŸšœ')" class="hover:bg-gray-600 rounded p-1">ğŸšœ</button>
                                <button type="button" onclick="addEmoji('ğŸï¸')" class="hover:bg-gray-600 rounded p-1">ğŸï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ›µ')" class="hover:bg-gray-600 rounded p-1">ğŸ›µ</button>
                                <button type="button" onclick="addEmoji('ğŸš²')" class="hover:bg-gray-600 rounded p-1">ğŸš²</button>
                                <button type="button" onclick="addEmoji('ğŸ›´')" class="hover:bg-gray-600 rounded p-1">ğŸ›´</button>
                                <button type="button" onclick="addEmoji('ğŸš')" class="hover:bg-gray-600 rounded p-1">ğŸš</button>
                                <button type="button" onclick="addEmoji('âœˆï¸')" class="hover:bg-gray-600 rounded p-1">âœˆï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ›©ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ›©ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸš€')" class="hover:bg-gray-600 rounded p-1">ğŸš€</button>
                                <button type="button" onclick="addEmoji('ğŸ›¸')" class="hover:bg-gray-600 rounded p-1">ğŸ›¸</button>
                                <button type="button" onclick="addEmoji('ğŸš¢')" class="hover:bg-gray-600 rounded p-1">ğŸš¢</button>
                                <button type="button" onclick="addEmoji('â›µ')" class="hover:bg-gray-600 rounded p-1">â›µ</button>
                                <button type="button" onclick="addEmoji('ğŸš¤')" class="hover:bg-gray-600 rounded p-1">ğŸš¤</button>
                                <button type="button" onclick="addEmoji('ğŸ›¥ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ›¥ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸš‚')" class="hover:bg-gray-600 rounded p-1">ğŸš‚</button>
                                <button type="button" onclick="addEmoji('ğŸšƒ')" class="hover:bg-gray-600 rounded p-1">ğŸšƒ</button>
                                <button type="button" onclick="addEmoji('ğŸš„')" class="hover:bg-gray-600 rounded p-1">ğŸš„</button>
                                <button type="button" onclick="addEmoji('ğŸš…')" class="hover:bg-gray-600 rounded p-1">ğŸš…</button>
                                <button type="button" onclick="addEmoji('ğŸš†')" class="hover:bg-gray-600 rounded p-1">ğŸš†</button>
                                <button type="button" onclick="addEmoji('ğŸš‡')" class="hover:bg-gray-600 rounded p-1">ğŸš‡</button>
                                <button type="button" onclick="addEmoji('ğŸšˆ')" class="hover:bg-gray-600 rounded p-1">ğŸšˆ</button>
                                <button type="button" onclick="addEmoji('ğŸš‰')" class="hover:bg-gray-600 rounded p-1">ğŸš‰</button>
                                <button type="button" onclick="addEmoji('ğŸ ')" class="hover:bg-gray-600 rounded p-1">ğŸ </button>
                                <button type="button" onclick="addEmoji('ğŸ¡')" class="hover:bg-gray-600 rounded p-1">ğŸ¡</button>
                                <button type="button" onclick="addEmoji('ğŸ¢')" class="hover:bg-gray-600 rounded p-1">ğŸ¢</button>
                                <button type="button" onclick="addEmoji('ğŸ£')" class="hover:bg-gray-600 rounded p-1">ğŸ£</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ¦')" class="hover:bg-gray-600 rounded p-1">ğŸ¦</button>
                                <button type="button" onclick="addEmoji('ğŸ¨')" class="hover:bg-gray-600 rounded p-1">ğŸ¨</button>
                                <button type="button" onclick="addEmoji('ğŸ©')" class="hover:bg-gray-600 rounded p-1">ğŸ©</button>
                                <button type="button" onclick="addEmoji('ğŸª')" class="hover:bg-gray-600 rounded p-1">ğŸª</button>
                                <button type="button" onclick="addEmoji('ğŸ«')" class="hover:bg-gray-600 rounded p-1">ğŸ«</button>
                                <button type="button" onclick="addEmoji('ğŸ¬')" class="hover:bg-gray-600 rounded p-1">ğŸ¬</button>
                                <button type="button" onclick="addEmoji('ğŸ­')" class="hover:bg-gray-600 rounded p-1">ğŸ­</button>
                                <button type="button" onclick="addEmoji('ğŸ¯')" class="hover:bg-gray-600 rounded p-1">ğŸ¯</button>
                                <button type="button" onclick="addEmoji('ğŸ°')" class="hover:bg-gray-600 rounded p-1">ğŸ°</button>
                                <button type="button" onclick="addEmoji('ğŸ’’')" class="hover:bg-gray-600 rounded p-1">ğŸ’’</button>
                                <button type="button" onclick="addEmoji('ğŸ—¼')" class="hover:bg-gray-600 rounded p-1">ğŸ—¼</button>
                                <button type="button" onclick="addEmoji('ğŸ—½')" class="hover:bg-gray-600 rounded p-1">ğŸ—½</button>
                                <button type="button" onclick="addEmoji('â›ª')" class="hover:bg-gray-600 rounded p-1">â›ª</button>
                                <button type="button" onclick="addEmoji('ğŸ•Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ•Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ›•')" class="hover:bg-gray-600 rounded p-1">ğŸ›•</button>
                                <button type="button" onclick="addEmoji('â›©ï¸')" class="hover:bg-gray-600 rounded p-1">â›©ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸŒ')" class="hover:bg-gray-600 rounded p-1">ğŸŒ</button>
                                <button type="button" onclick="addEmoji('ğŸ—ºï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ—ºï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ§­')" class="hover:bg-gray-600 rounded p-1">ğŸ§­</button>
                                <button type="button" onclick="addEmoji('ğŸ”ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ”ï¸</button>
                                <button type="button" onclick="addEmoji('â›°ï¸')" class="hover:bg-gray-600 rounded p-1">â›°ï¸</button>
                            </div>
                            <div id="emojiObjects" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('âŒš')" class="hover:bg-gray-600 rounded p-1">âŒš</button>
                                <button type="button" onclick="addEmoji('ğŸ“±')" class="hover:bg-gray-600 rounded p-1">ğŸ“±</button>
                                <button type="button" onclick="addEmoji('ğŸ’»')" class="hover:bg-gray-600 rounded p-1">ğŸ’»</button>
                                <button type="button" onclick="addEmoji('âŒ¨ï¸')" class="hover:bg-gray-600 rounded p-1">âŒ¨ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ–¥ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ–¥ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ–¨ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ–¨ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ–±ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ–±ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’½')" class="hover:bg-gray-600 rounded p-1">ğŸ’½</button>
                                <button type="button" onclick="addEmoji('ğŸ’¾')" class="hover:bg-gray-600 rounded p-1">ğŸ’¾</button>
                                <button type="button" onclick="addEmoji('ğŸ’¿')" class="hover:bg-gray-600 rounded p-1">ğŸ’¿</button>
                                <button type="button" onclick="addEmoji('ğŸ“€')" class="hover:bg-gray-600 rounded p-1">ğŸ“€</button>
                                <button type="button" onclick="addEmoji('ğŸ“·')" class="hover:bg-gray-600 rounded p-1">ğŸ“·</button>
                                <button type="button" onclick="addEmoji('ğŸ“¸')" class="hover:bg-gray-600 rounded p-1">ğŸ“¸</button>
                                <button type="button" onclick="addEmoji('ğŸ“¹')" class="hover:bg-gray-600 rounded p-1">ğŸ“¹</button>
                                <button type="button" onclick="addEmoji('ğŸ¥')" class="hover:bg-gray-600 rounded p-1">ğŸ¥</button>
                                <button type="button" onclick="addEmoji('ğŸ“½ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ“½ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ“º')" class="hover:bg-gray-600 rounded p-1">ğŸ“º</button>
                                <button type="button" onclick="addEmoji('ğŸ“»')" class="hover:bg-gray-600 rounded p-1">ğŸ“»</button>
                                <button type="button" onclick="addEmoji('ğŸ™ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ™ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ“')" class="hover:bg-gray-600 rounded p-1">ğŸ“</button>
                                <button type="button" onclick="addEmoji('â˜ï¸')" class="hover:bg-gray-600 rounded p-1">â˜ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ“Ÿ')" class="hover:bg-gray-600 rounded p-1">ğŸ“Ÿ</button>
                                <button type="button" onclick="addEmoji('ğŸ“ ')" class="hover:bg-gray-600 rounded p-1">ğŸ“ </button>
                                <button type="button" onclick="addEmoji('ğŸ”‹')" class="hover:bg-gray-600 rounded p-1">ğŸ”‹</button>
                                <button type="button" onclick="addEmoji('ğŸ”Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ”Œ</button>
                                <button type="button" onclick="addEmoji('ğŸ’¡')" class="hover:bg-gray-600 rounded p-1">ğŸ’¡</button>
                                <button type="button" onclick="addEmoji('ğŸ”¦')" class="hover:bg-gray-600 rounded p-1">ğŸ”¦</button>
                                <button type="button" onclick="addEmoji('ğŸ•¯ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ•¯ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’°')" class="hover:bg-gray-600 rounded p-1">ğŸ’°</button>
                                <button type="button" onclick="addEmoji('ğŸ’µ')" class="hover:bg-gray-600 rounded p-1">ğŸ’µ</button>
                                <button type="button" onclick="addEmoji('ğŸ’´')" class="hover:bg-gray-600 rounded p-1">ğŸ’´</button>
                                <button type="button" onclick="addEmoji('ğŸ’¶')" class="hover:bg-gray-600 rounded p-1">ğŸ’¶</button>
                                <button type="button" onclick="addEmoji('ğŸ’·')" class="hover:bg-gray-600 rounded p-1">ğŸ’·</button>
                                <button type="button" onclick="addEmoji('ğŸ’³')" class="hover:bg-gray-600 rounded p-1">ğŸ’³</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('âš–ï¸')" class="hover:bg-gray-600 rounded p-1">âš–ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”§')" class="hover:bg-gray-600 rounded p-1">ğŸ”§</button>
                                <button type="button" onclick="addEmoji('ğŸ”¨')" class="hover:bg-gray-600 rounded p-1">ğŸ”¨</button>
                                <button type="button" onclick="addEmoji('âš’ï¸')" class="hover:bg-gray-600 rounded p-1">âš’ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ› ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ› ï¸</button>
                                <button type="button" onclick="addEmoji('â›ï¸')" class="hover:bg-gray-600 rounded p-1">â›ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”©')" class="hover:bg-gray-600 rounded p-1">ğŸ”©</button>
                                <button type="button" onclick="addEmoji('âš™ï¸')" class="hover:bg-gray-600 rounded p-1">âš™ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”—')" class="hover:bg-gray-600 rounded p-1">ğŸ”—</button>
                                <button type="button" onclick="addEmoji('â›“ï¸')" class="hover:bg-gray-600 rounded p-1">â›“ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”’')" class="hover:bg-gray-600 rounded p-1">ğŸ”’</button>
                                <button type="button" onclick="addEmoji('ğŸ”“')" class="hover:bg-gray-600 rounded p-1">ğŸ”“</button>
                                <button type="button" onclick="addEmoji('ğŸ”‘')" class="hover:bg-gray-600 rounded p-1">ğŸ”‘</button>
                                <button type="button" onclick="addEmoji('ğŸ—ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ—ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”')" class="hover:bg-gray-600 rounded p-1">ğŸ”</button>
                                <button type="button" onclick="addEmoji('ğŸ“¦')" class="hover:bg-gray-600 rounded p-1">ğŸ“¦</button>
                                <button type="button" onclick="addEmoji('ğŸ“«')" class="hover:bg-gray-600 rounded p-1">ğŸ“«</button>
                                <button type="button" onclick="addEmoji('ğŸ“¬')" class="hover:bg-gray-600 rounded p-1">ğŸ“¬</button>
                                <button type="button" onclick="addEmoji('ğŸ“§')" class="hover:bg-gray-600 rounded p-1">ğŸ“§</button>
                                <button type="button" onclick="addEmoji('ğŸ“')" class="hover:bg-gray-600 rounded p-1">ğŸ“</button>
                                <button type="button" onclick="addEmoji('ğŸ“')" class="hover:bg-gray-600 rounded p-1">ğŸ“</button>
                                <button type="button" onclick="addEmoji('ğŸ“‚')" class="hover:bg-gray-600 rounded p-1">ğŸ“‚</button>
                                <button type="button" onclick="addEmoji('ğŸ“…')" class="hover:bg-gray-600 rounded p-1">ğŸ“…</button>
                                <button type="button" onclick="addEmoji('ğŸ“†')" class="hover:bg-gray-600 rounded p-1">ğŸ“†</button>
                                <button type="button" onclick="addEmoji('ğŸ“Š')" class="hover:bg-gray-600 rounded p-1">ğŸ“Š</button>
                                <button type="button" onclick="addEmoji('ğŸ“ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ“ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ“‰')" class="hover:bg-gray-600 rounded p-1">ğŸ“‰</button>
                                <button type="button" onclick="addEmoji('ğŸ“‹')" class="hover:bg-gray-600 rounded p-1">ğŸ“‹</button>
                                <button type="button" onclick="addEmoji('ğŸ“Œ')" class="hover:bg-gray-600 rounded p-1">ğŸ“Œ</button>
                            </div>
                            <div id="emojiSymbols" class="hidden grid grid-cols-8 gap-1 text-xl">
                                <button type="button" onclick="addEmoji('â¤ï¸')" class="hover:bg-gray-600 rounded p-1">â¤ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ§¡')" class="hover:bg-gray-600 rounded p-1">ğŸ§¡</button>
                                <button type="button" onclick="addEmoji('ğŸ’›')" class="hover:bg-gray-600 rounded p-1">ğŸ’›</button>
                                <button type="button" onclick="addEmoji('ğŸ’š')" class="hover:bg-gray-600 rounded p-1">ğŸ’š</button>
                                <button type="button" onclick="addEmoji('ğŸ’™')" class="hover:bg-gray-600 rounded p-1">ğŸ’™</button>
                                <button type="button" onclick="addEmoji('ğŸ’œ')" class="hover:bg-gray-600 rounded p-1">ğŸ’œ</button>
                                <button type="button" onclick="addEmoji('ğŸ–¤')" class="hover:bg-gray-600 rounded p-1">ğŸ–¤</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ’”')" class="hover:bg-gray-600 rounded p-1">ğŸ’”</button>
                                <button type="button" onclick="addEmoji('â£ï¸')" class="hover:bg-gray-600 rounded p-1">â£ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’•')" class="hover:bg-gray-600 rounded p-1">ğŸ’•</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('ğŸ’“')" class="hover:bg-gray-600 rounded p-1">ğŸ’“</button>
                                <button type="button" onclick="addEmoji('ğŸ’—')" class="hover:bg-gray-600 rounded p-1">ğŸ’—</button>
                                <button type="button" onclick="addEmoji('ğŸ’–')" class="hover:bg-gray-600 rounded p-1">ğŸ’–</button>
                                <button type="button" onclick="addEmoji('ğŸ’˜')" class="hover:bg-gray-600 rounded p-1">ğŸ’˜</button>
                                <button type="button" onclick="addEmoji('ğŸ’')" class="hover:bg-gray-600 rounded p-1">ğŸ’</button>
                                <button type="button" onclick="addEmoji('ğŸ’Ÿ')" class="hover:bg-gray-600 rounded p-1">ğŸ’Ÿ</button>
                                <button type="button" onclick="addEmoji('â˜®ï¸')" class="hover:bg-gray-600 rounded p-1">â˜®ï¸</button>
                                <button type="button" onclick="addEmoji('âœï¸')" class="hover:bg-gray-600 rounded p-1">âœï¸</button>
                                <button type="button" onclick="addEmoji('â˜ªï¸')" class="hover:bg-gray-600 rounded p-1">â˜ªï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ•‰ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ•‰ï¸</button>
                                <button type="button" onclick="addEmoji('â˜¯ï¸')" class="hover:bg-gray-600 rounded p-1">â˜¯ï¸</button>
                                <button type="button" onclick="addEmoji('âœ¡ï¸')" class="hover:bg-gray-600 rounded p-1">âœ¡ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”¯')" class="hover:bg-gray-600 rounded p-1">ğŸ”¯</button>
                                <button type="button" onclick="addEmoji('â™ˆ')" class="hover:bg-gray-600 rounded p-1">â™ˆ</button>
                                <button type="button" onclick="addEmoji('â™‰')" class="hover:bg-gray-600 rounded p-1">â™‰</button>
                                <button type="button" onclick="addEmoji('â™Š')" class="hover:bg-gray-600 rounded p-1">â™Š</button>
                                <button type="button" onclick="addEmoji('â™‹')" class="hover:bg-gray-600 rounded p-1">â™‹</button>
                                <button type="button" onclick="addEmoji('â™Œ')" class="hover:bg-gray-600 rounded p-1">â™Œ</button>
                                <button type="button" onclick="addEmoji('â™')" class="hover:bg-gray-600 rounded p-1">â™</button>
                                <button type="button" onclick="addEmoji('â™')" class="hover:bg-gray-600 rounded p-1">â™</button>
                                <button type="button" onclick="addEmoji('â™')" class="hover:bg-gray-600 rounded p-1">â™</button>
                                <button type="button" onclick="addEmoji('â™')" class="hover:bg-gray-600 rounded p-1">â™</button>
                                <button type="button" onclick="addEmoji('â™‘')" class="hover:bg-gray-600 rounded p-1">â™‘</button>
                                <button type="button" onclick="addEmoji('â™’')" class="hover:bg-gray-600 rounded p-1">â™’</button>
                                <button type="button" onclick="addEmoji('â™“')" class="hover:bg-gray-600 rounded p-1">â™“</button>
                                <button type="button" onclick="addEmoji('â›')" class="hover:bg-gray-600 rounded p-1">â›</button>
                                <button type="button" onclick="addEmoji('ğŸ”€')" class="hover:bg-gray-600 rounded p-1">ğŸ”€</button>
                                <button type="button" onclick="addEmoji('ğŸ”')" class="hover:bg-gray-600 rounded p-1">ğŸ”</button>
                                <button type="button" onclick="addEmoji('ğŸ”‚')" class="hover:bg-gray-600 rounded p-1">ğŸ”‚</button>
                                <button type="button" onclick="addEmoji('â–¶ï¸')" class="hover:bg-gray-600 rounded p-1">â–¶ï¸</button>
                                <button type="button" onclick="addEmoji('â©')" class="hover:bg-gray-600 rounded p-1">â©</button>
                                <button type="button" onclick="addEmoji('â­ï¸')" class="hover:bg-gray-600 rounded p-1">â­ï¸</button>
                                <button type="button" onclick="addEmoji('â¯ï¸')" class="hover:bg-gray-600 rounded p-1">â¯ï¸</button>
                                <button type="button" onclick="addEmoji('â—€ï¸')" class="hover:bg-gray-600 rounded p-1">â—€ï¸</button>
                                <button type="button" onclick="addEmoji('âª')" class="hover:bg-gray-600 rounded p-1">âª</button>
                                <button type="button" onclick="addEmoji('ğŸ”¼')" class="hover:bg-gray-600 rounded p-1">ğŸ”¼</button>
                                <button type="button" onclick="addEmoji('â«')" class="hover:bg-gray-600 rounded p-1">â«</button>
                                <button type="button" onclick="addEmoji('ğŸ”½')" class="hover:bg-gray-600 rounded p-1">ğŸ”½</button>
                                <button type="button" onclick="addEmoji('â¬')" class="hover:bg-gray-600 rounded p-1">â¬</button>
                                <button type="button" onclick="addEmoji('â¸ï¸')" class="hover:bg-gray-600 rounded p-1">â¸ï¸</button>
                                <button type="button" onclick="addEmoji('â¹ï¸')" class="hover:bg-gray-600 rounded p-1">â¹ï¸</button>
                                <button type="button" onclick="addEmoji('âºï¸')" class="hover:bg-gray-600 rounded p-1">âºï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”†')" class="hover:bg-gray-600 rounded p-1">ğŸ”†</button>
                                <button type="button" onclick="addEmoji('ğŸ”…')" class="hover:bg-gray-600 rounded p-1">ğŸ”…</button>
                                <button type="button" onclick="addEmoji('ğŸ“¶')" class="hover:bg-gray-600 rounded p-1">ğŸ“¶</button>
                                <button type="button" onclick="addEmoji('ğŸ“³')" class="hover:bg-gray-600 rounded p-1">ğŸ“³</button>
                                <button type="button" onclick="addEmoji('ğŸ“´')" class="hover:bg-gray-600 rounded p-1">ğŸ“´</button>
                                <button type="button" onclick="addEmoji('âœ–ï¸')" class="hover:bg-gray-600 rounded p-1">âœ–ï¸</button>
                                <button type="button" onclick="addEmoji('â•')" class="hover:bg-gray-600 rounded p-1">â•</button>
                                <button type="button" onclick="addEmoji('â–')" class="hover:bg-gray-600 rounded p-1">â–</button>
                                <button type="button" onclick="addEmoji('â—')" class="hover:bg-gray-600 rounded p-1">â—</button>
                                <button type="button" onclick="addEmoji('â™¾ï¸')" class="hover:bg-gray-600 rounded p-1">â™¾ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ’²')" class="hover:bg-gray-600 rounded p-1">ğŸ’²</button>
                                <button type="button" onclick="addEmoji('ğŸ’±')" class="hover:bg-gray-600 rounded p-1">ğŸ’±</button>
                                <button type="button" onclick="addEmoji('â„¢ï¸')" class="hover:bg-gray-600 rounded p-1">â„¢ï¸</button>
                                <button type="button" onclick="addEmoji('Â©ï¸')" class="hover:bg-gray-600 rounded p-1">Â©ï¸</button>
                                <button type="button" onclick="addEmoji('Â®ï¸')" class="hover:bg-gray-600 rounded p-1">Â®ï¸</button>
                                <button type="button" onclick="addEmoji('ã€°ï¸')" class="hover:bg-gray-600 rounded p-1">ã€°ï¸</button>
                                <button type="button" onclick="addEmoji('â°')" class="hover:bg-gray-600 rounded p-1">â°</button>
                                <button type="button" onclick="addEmoji('â¿')" class="hover:bg-gray-600 rounded p-1">â¿</button>
                                <button type="button" onclick="addEmoji('ğŸ”š')" class="hover:bg-gray-600 rounded p-1">ğŸ”š</button>
                                <button type="button" onclick="addEmoji('ğŸ”™')" class="hover:bg-gray-600 rounded p-1">ğŸ”™</button>
                                <button type="button" onclick="addEmoji('ğŸ”›')" class="hover:bg-gray-600 rounded p-1">ğŸ”›</button>
                                <button type="button" onclick="addEmoji('ğŸ”')" class="hover:bg-gray-600 rounded p-1">ğŸ”</button>
                                <button type="button" onclick="addEmoji('ğŸ”œ')" class="hover:bg-gray-600 rounded p-1">ğŸ”œ</button>
                                <button type="button" onclick="addEmoji('âœ”ï¸')" class="hover:bg-gray-600 rounded p-1">âœ”ï¸</button>
                                <button type="button" onclick="addEmoji('â˜‘ï¸')" class="hover:bg-gray-600 rounded p-1">â˜‘ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”˜')" class="hover:bg-gray-600 rounded p-1">ğŸ”˜</button>
                                <button type="button" onclick="addEmoji('ğŸ”´')" class="hover:bg-gray-600 rounded p-1">ğŸ”´</button>
                                <button type="button" onclick="addEmoji('ğŸŸ ')" class="hover:bg-gray-600 rounded p-1">ğŸŸ </button>
                                <button type="button" onclick="addEmoji('ğŸŸ¡')" class="hover:bg-gray-600 rounded p-1">ğŸŸ¡</button>
                                <button type="button" onclick="addEmoji('ğŸŸ¢')" class="hover:bg-gray-600 rounded p-1">ğŸŸ¢</button>
                                <button type="button" onclick="addEmoji('ğŸ”µ')" class="hover:bg-gray-600 rounded p-1">ğŸ”µ</button>
                                <button type="button" onclick="addEmoji('ğŸŸ£')" class="hover:bg-gray-600 rounded p-1">ğŸŸ£</button>
                                <button type="button" onclick="addEmoji('âš«')" class="hover:bg-gray-600 rounded p-1">âš«</button>
                                <button type="button" onclick="addEmoji('âšª')" class="hover:bg-gray-600 rounded p-1">âšª</button>
                                <button type="button" onclick="addEmoji('ğŸŸ¤')" class="hover:bg-gray-600 rounded p-1">ğŸŸ¤</button>
                                <button type="button" onclick="addEmoji('ğŸ”º')" class="hover:bg-gray-600 rounded p-1">ğŸ”º</button>
                                <button type="button" onclick="addEmoji('ğŸ”»')" class="hover:bg-gray-600 rounded p-1">ğŸ”»</button>
                                <button type="button" onclick="addEmoji('ğŸ”¸')" class="hover:bg-gray-600 rounded p-1">ğŸ”¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”¹')" class="hover:bg-gray-600 rounded p-1">ğŸ”¹</button>
                                <button type="button" onclick="addEmoji('ğŸ”¶')" class="hover:bg-gray-600 rounded p-1">ğŸ”¶</button>
                                <button type="button" onclick="addEmoji('ğŸ”·')" class="hover:bg-gray-600 rounded p-1">ğŸ”·</button>
                                <button type="button" onclick="addEmoji('ğŸ”³')" class="hover:bg-gray-600 rounded p-1">ğŸ”³</button>
                                <button type="button" onclick="addEmoji('ğŸ”²')" class="hover:bg-gray-600 rounded p-1">ğŸ”²</button>
                                <button type="button" onclick="addEmoji('â–ªï¸')" class="hover:bg-gray-600 rounded p-1">â–ªï¸</button>
                                <button type="button" onclick="addEmoji('â–«ï¸')" class="hover:bg-gray-600 rounded p-1">â–«ï¸</button>
                                <button type="button" onclick="addEmoji('â—¾')" class="hover:bg-gray-600 rounded p-1">â—¾</button>
                                <button type="button" onclick="addEmoji('â—½')" class="hover:bg-gray-600 rounded p-1">â—½</button>
                                <button type="button" onclick="addEmoji('â¬›')" class="hover:bg-gray-600 rounded p-1">â¬›</button>
                                <button type="button" onclick="addEmoji('â¬œ')" class="hover:bg-gray-600 rounded p-1">â¬œ</button>
                                <button type="button" onclick="addEmoji('ğŸ””')" class="hover:bg-gray-600 rounded p-1">ğŸ””</button>
                                <button type="button" onclick="addEmoji('ğŸ”•')" class="hover:bg-gray-600 rounded p-1">ğŸ”•</button>
                                <button type="button" onclick="addEmoji('ğŸ”Š')" class="hover:bg-gray-600 rounded p-1">ğŸ”Š</button>
                                <button type="button" onclick="addEmoji('ğŸ”‡')" class="hover:bg-gray-600 rounded p-1">ğŸ”‡</button>
                                <button type="button" onclick="addEmoji('ğŸ’¬')" class="hover:bg-gray-600 rounded p-1">ğŸ’¬</button>
                                <button type="button" onclick="addEmoji('ğŸ’­')" class="hover:bg-gray-600 rounded p-1">ğŸ’­</button>
                                <button type="button" onclick="addEmoji('ğŸ—¯ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ—¯ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ”¥')" class="hover:bg-gray-600 rounded p-1">ğŸ”¥</button>
                                <button type="button" onclick="addEmoji('âœ¨')" class="hover:bg-gray-600 rounded p-1">âœ¨</button>
                                <button type="button" onclick="addEmoji('ğŸ‰')" class="hover:bg-gray-600 rounded p-1">ğŸ‰</button>
                                <button type="button" onclick="addEmoji('ğŸ’¯')" class="hover:bg-gray-600 rounded p-1">ğŸ’¯</button>
                                <button type="button" onclick="addEmoji('â­')" class="hover:bg-gray-600 rounded p-1">â­</button>
                                <button type="button" onclick="addEmoji('ğŸŒŸ')" class="hover:bg-gray-600 rounded p-1">ğŸŒŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ’«')" class="hover:bg-gray-600 rounded p-1">ğŸ’«</button>
                                <button type="button" onclick="addEmoji('âš¡')" class="hover:bg-gray-600 rounded p-1">âš¡</button>
                                <button type="button" onclick="addEmoji('ğŸ’¥')" class="hover:bg-gray-600 rounded p-1">ğŸ’¥</button>
                                <button type="button" onclick="addEmoji('ğŸŠ')" class="hover:bg-gray-600 rounded p-1">ğŸŠ</button>
                                <button type="button" onclick="addEmoji('ğŸ')" class="hover:bg-gray-600 rounded p-1">ğŸ</button>
                                <button type="button" onclick="addEmoji('ğŸ†')" class="hover:bg-gray-600 rounded p-1">ğŸ†</button>
                                <button type="button" onclick="addEmoji('ğŸ¥‡')" class="hover:bg-gray-600 rounded p-1">ğŸ¥‡</button>
                                <button type="button" onclick="addEmoji('ğŸ¥ˆ')" class="hover:bg-gray-600 rounded p-1">ğŸ¥ˆ</button>
                                <button type="button" onclick="addEmoji('ğŸ¥‰')" class="hover:bg-gray-600 rounded p-1">ğŸ¥‰</button>
                                <button type="button" onclick="addEmoji('ğŸ…')" class="hover:bg-gray-600 rounded p-1">ğŸ…</button>
                                <button type="button" onclick="addEmoji('ğŸ–ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ–ï¸</button>
                                <button type="button" onclick="addEmoji('ğŸ—ï¸')" class="hover:bg-gray-600 rounded p-1">ğŸ—ï¸</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="channelNotice" class="p-4 text-center text-gray-400 safe-bottom" style="display: none;">
                    <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                    </svg>
                    Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² ÑÑ‚Ğ¾Ñ‚ ĞºĞ°Ğ½Ğ°Ğ»
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Menu Modal -->
    <div id="createMenuModal" class="hidden fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
            <h3 class="text-lg font-bold mb-4 text-center">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ</h3>
            <div class="space-y-2">
                <button onclick="showNewPrivateChat()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">Ğ›Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚</div>
                        <div class="text-xs text-gray-400">ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ</div>
                    </div>
                </button>
                <button onclick="showCreateGroup()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-green rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ°</div>
                        <div class="text-xs text-gray-400">Ğ”Ğ¾ 200 ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²</div>
                    </div>
                </button>
                <button onclick="showCreateChannel()" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                    <div class="w-10 h-10 gradient-orange rounded-full flex items-center justify-center">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                        </svg>
                    </div>
                    <div class="text-left">
                        <div class="font-medium">ĞšĞ°Ğ½Ğ°Ğ»</div>
                        <div class="text-xs text-gray-400">Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ</div>
                    </div>
                </button>
            </div>
            <button onclick="closeModal('createMenuModal')" class="w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
        </div>
    </div>
    
    <!-- New Private Chat Modal -->
    <div id="newPrivateChatModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md max-h-[80vh] flex flex-col fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚</h3>
                <button onclick="closeModal('newPrivateChatModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="userSearchInput" oninput="searchUsersForChat()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹...">
            <div id="userSearchResults" class="flex-1 overflow-y-auto chat-scroll"></div>
        </div>
    </div>
    
    <!-- Create Group Modal -->
    <div id="createGroupModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md max-h-[80vh] flex flex-col fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ĞĞ¾Ğ²Ğ°Ñ Ğ³Ñ€ÑƒĞ¿Ğ¿Ğ°</h3>
                <button onclick="closeModal('createGroupModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="groupName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹">
            <input type="text" id="groupSearchInput" oninput="searchUsersForGroup()" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²...">
            <div id="selectedMembers" class="flex flex-wrap gap-2 mb-3"></div>
            <div id="groupSearchResults" class="flex-1 overflow-y-auto chat-scroll mb-3 min-h-[200px]"></div>
            <button onclick="createGroup()" class="w-full gradient-bg py-2.5 rounded-xl font-semibold hover:opacity-90">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ</button>
        </div>
    </div>
    
    <!-- Create Channel Modal -->
    <div id="createChannelModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ĞĞ¾Ğ²Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ»</h3>
                <button onclick="closeModal('createChannelModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <input type="text" id="channelName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°">
            <textarea id="channelDescription" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-2.5 mb-3 focus:outline-none focus:border-purple-500 resize-none h-20" placeholder="ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)"></textarea>
            <button onclick="createChannel()" class="w-full gradient-bg py-2.5 rounded-xl font-semibold hover:opacity-90">Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ»</button>
        </div>
    </div>
    
    <!-- Account Switcher Modal -->
    <div id="accountSwitcherModal" class="hidden fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
            <h3 class="text-lg font-bold mb-4">ĞĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹</h3>
            <div id="accountSwitcherList" class="space-y-2 max-h-64 overflow-y-auto mb-4"></div>
            <button onclick="addNewAccount()" class="w-full flex items-center justify-center gap-2 p-3 border-2 border-dashed border-gray-600 rounded-xl text-gray-400 hover:border-purple-500 hover:text-purple-400 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚
            </button>
            <button onclick="closeModal('accountSwitcherModal')" class="w-full mt-3 py-2 text-gray-400 hover:text-white transition-colors">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-6 w-full max-w-md fade-in">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</h3>
                <button onclick="closeModal('profileModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="text-center mb-6">
                <div id="profileAvatar" class="w-24 h-24 gradient-bg rounded-full mx-auto mb-4 flex items-center justify-center text-3xl font-bold"></div>
                <div id="profileNameDisplay" class="text-xl font-semibold"></div>
                <div id="profileEmail" class="text-gray-400"></div>
            </div>
            <form onsubmit="updateProfile(event)" class="space-y-4">
                <input type="text" id="newProfileName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="ĞĞ¾Ğ²Ğ¾Ğµ Ğ¸Ğ¼Ñ">
                <input type="text" id="newProfileStatus" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500" placeholder="Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ">
                <button type="submit" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
            </form>
            <button onclick="logout()" class="w-full mt-3 py-3 bg-red-600/20 text-red-400 rounded-xl font-medium hover:bg-red-600/30 transition-colors">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</button>
        </div>
    </div>
    
    <!-- Reactions Picker -->
    <div id="reactionsPicker" class="hidden fixed bg-gray-800 rounded-2xl p-2 shadow-xl z-50 fade-in">
        <div class="flex gap-1">
            <button onclick="addReaction('ğŸ‘')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">ğŸ‘</button>
            <button onclick="addReaction('â¤ï¸')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">â¤ï¸</button>
            <button onclick="addReaction('ğŸ˜‚')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">ğŸ˜‚</button>
            <button onclick="addReaction('ğŸ˜®')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">ğŸ˜®</button>
            <button onclick="addReaction('ğŸ˜¢')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">ğŸ˜¢</button>
            <button onclick="addReaction('ğŸ”¥')" class="reaction-btn text-2xl p-1 hover:bg-gray-700 rounded-lg">ğŸ”¥</button>
        </div>
    </div>
    
    <!-- Image Viewer -->
    <div id="imageViewer" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onclick="closeImageViewer()">
        <button class="absolute top-4 right-4 p-2 text-white hover:bg-white/20 rounded-xl">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
        <img id="viewerImage" src="" class="max-w-full max-h-full object-contain">
    </div>
    
    <!-- Group/Channel Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-3xl p-6 w-full max-w-md fade-in max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold" id="settingsTitle">ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</h3>
                <button onclick="closeModal('settingsModal')" class="p-2 hover:bg-gray-700 rounded-xl">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <!-- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ -->
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label>
                    <input type="text" id="settingsName" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500">
                </div>
                
                <!-- ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ğ´Ğ»Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²) -->
                <div id="settingsDescriptionBlock">
                    <label class="block text-sm text-gray-400 mb-1">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label>
                    <textarea id="settingsDescription" class="w-full bg-gray-700/50 border border-gray-600 rounded-xl px-4 py-3 focus:outline-none focus:border-purple-500 resize-none h-20"></textarea>
                </div>
                
                <!-- Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸ -->
                <div id="settingsMembersBlock">
                    <label class="block text-sm text-gray-400 mb-2">Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¸ (<span id="settingsMemberCount">0</span>)</label>
                    <div id="settingsMembersList" class="space-y-2 max-h-48 overflow-y-auto chat-scroll"></div>
                </div>
                
                <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ -->
                <button onclick="saveSettings()" class="w-full gradient-bg py-3 rounded-xl font-semibold hover:opacity-90">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
                
                <button onclick="deleteGroupOrChannel()" class="w-full py-3 bg-red-600/20 text-red-400 rounded-xl font-medium hover:bg-red-600/30 transition-colors">
                    <span id="deleteButtonText">Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="hidden fixed top-4 right-4 left-4 md:left-auto bg-gray-800 border border-gray-700 rounded-xl p-4 shadow-xl z-50 fade-in cursor-pointer" onclick="handleToastClick()">
        <div class="flex items-center gap-3">
            <div id="toastIcon" class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold shrink-0"></div>
            <div class="min-w-0">
                <div id="toastTitle" class="font-semibold truncate"></div>
                <div id="toastMessage" class="text-sm text-gray-400 truncate"></div>
            </div>
        </div>
    </div>

    <script>
        // imgBB API Key Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
        const IMGBB_API_KEY = 'f457bea1a8c6cf16c4a03634c8ea3177';
        
        // Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº email-Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ² Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²
        const DEVELOPER_EMAILS = [
            'stepanu142z@gmail.com',
            'stepan42z@yandex.ru'
        ];
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ¼
        function isDeveloper(email) {
            if (!email) return false;
            return DEVELOPER_EMAILS.some(devEmail => devEmail.toLowerCase() === email.toLowerCase());
        }
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ HTML Ğ±ĞµĞ¹Ğ´Ğ¶Ğ¸ĞºĞ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ°
        function getDevBadgeHtml() {
            return `<span class="dev-badge"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>DEV</span>`;
        }
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ñ Ğ±ĞµĞ¹Ğ´Ğ¶Ğ¸ĞºĞ¾Ğ¼ (ĞµÑĞ»Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº)
        function getNameWithBadge(name, email) {
            if (isDeveloper(email)) {
                return escapeHtml(name) + getDevBadgeHtml();
            }
            return escapeHtml(name);
        }
        
        const firebaseConfig = {
            apiKey: "AIzaSyBeLAiCwZjij3d6FZ4OzylJnaxPwlyf1Ag",
            authDomain: "webchat-28b64.firebaseapp.com",
            databaseURL: "https://webchat-28b64-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "webchat-28b64",
            storageBucket: "webchat-28b64.firebasestorage.app",
            messagingSenderId: "307131215178",
            appId: "1:307131215178:web:0e510297256e30959825b3",
            measurementId: "G-JD21B447LF"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        let currentUser = null;
        let currentUserData = null;
        let currentChat = null;
        let currentChatType = null;
        let currentChatData = null;
        let typingTimeout = null;
        let unreadCounts = {};
        let selectedGroupMembers = [];
        let currentMessageId = null;
        let currentTab = 'all';
        let allChats = [];
        let allUsers = {};
        let toastChatId = null;
        let pendingFile = null;
        let uploadTask = null;
        let isUploading = false;

        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        function loadSavedAccounts() {
            const accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            const container = document.getElementById('savedAccounts');
            const list = document.getElementById('accountsList');
            
            if (accounts.length > 0) {
                container.classList.remove('hidden');
                list.innerHTML = accounts.map(acc => `
                    <div class="flex items-center gap-3 p-2 bg-gray-700/50 rounded-xl">
                        <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center font-bold text-sm">${acc.name.charAt(0).toUpperCase()}</div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-sm truncate">${acc.name}</div>
                            <div class="text-xs text-gray-400 truncate">${acc.email}</div>
                        </div>
                        <button onclick="quickLogin('${acc.email}', '${acc.password}')" class="text-xs bg-purple-600 px-2 py-1 rounded-lg">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
                        <button onclick="removeAccount('${acc.email}')" class="text-gray-400 hover:text-red-400 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `).join('');
            } else {
                container.classList.add('hidden');
            }
        }

        function saveAccount(email, password, name) {
            let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            accounts = accounts.filter(a => a.email !== email);
            accounts.unshift({ email, password, name });
            if (accounts.length > 5) accounts = accounts.slice(0, 5);
            localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
        }

        function removeAccount(email) {
            let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            accounts = accounts.filter(a => a.email !== email);
            localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
            loadSavedAccounts();
        }

        function quickLogin(email, password) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = password;
            login(new Event('submit'));
        }

        loadSavedAccounts();

        auth.onAuthStateChanged(async user => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadAllUsers();
                showChatScreen();
                updateOnlineStatus(true);
                loadAllChats();
                setupNotificationListener();
                
                database.ref(`users/${user.uid}/online`).onDisconnect().set(false);
                database.ref(`users/${user.uid}/lastSeen`).onDisconnect().set(firebase.database.ServerValue.TIMESTAMP);
            } else {
                currentUser = null;
                showAuthScreen();
            }
        });

        async function loadAllUsers() {
            try {
                const snap = await database.ref('users').once('value');
                allUsers = snap.val() || {};
                console.log('Loaded users:', Object.keys(allUsers).length);
            } catch (e) {
                console.error('Error loading users:', e);
            }
        }

        function showTab(tab) {
            document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tab !== 'register');
            document.getElementById('loginTab').classList.toggle('bg-purple-600', tab === 'login');
            document.getElementById('loginTab').classList.toggle('text-white', tab === 'login');
            document.getElementById('loginTab').classList.toggle('text-gray-400', tab !== 'login');
            document.getElementById('registerTab').classList.toggle('bg-purple-600', tab === 'register');
            document.getElementById('registerTab').classList.toggle('text-white', tab === 'register');
            document.getElementById('registerTab').classList.toggle('text-gray-400', tab !== 'register');
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const save = document.getElementById('saveAccount').checked;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                if (save) {
                    const snapshot = await database.ref(`users/${auth.currentUser.uid}`).once('value');
                    const userData = snapshot.val();
                    saveAccount(email, password, userData?.name || email);
                }
            } catch (error) {
                showAuthError(getErrorMessage(error.code));
            }
        }

        async function register(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            if (!name) return showAuthError('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ');
            
            try {
                const cred = await auth.createUserWithEmailAndPassword(email, password);
                await database.ref(`users/${cred.user.uid}`).set({
                    name,
                    nameLower: name.toLowerCase(),
                    email,
                    status: 'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ¯ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ FlashChat',
                    online: true,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                });
                saveAccount(email, password, name);
            } catch (error) {
                showAuthError(getErrorMessage(error.code));
            }
        }

        function getErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': 'Email ÑƒĞ¶Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ',
                'auth/invalid-email': 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ email',
                'auth/weak-password': 'Ğ¡Ğ»Ğ°Ğ±Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ',
                'auth/user-not-found': 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½',
                'auth/wrong-password': 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ'
            };
            return messages[code] || 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸';
        }

        function showAuthError(msg) {
            const el = document.getElementById('authError');
            el.textContent = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 4000);
        }

        function logout() {
            updateOnlineStatus(false);
            auth.signOut();
            closeModal('profileModal');
        }

        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('chatScreen').classList.remove('active');
        }

        function showChatScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('authScreen').style.display = 'none';
            
            const chatScreen = document.getElementById('chatScreen');
            chatScreen.classList.add('active');
            chatScreen.style.display = 'flex';
            
            const sidebar = document.getElementById('sidebar');
            sidebar.style.display = 'flex';
            sidebar.classList.remove('chat-open');
            
            const chatArea = document.getElementById('chatArea');
            chatArea.classList.remove('active');
            
            // ĞĞ° Ğ´ĞµÑĞºÑ‚Ğ¾Ğ¿Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ chatArea ÑĞ¿Ñ€Ğ°Ğ²Ğ°
            if (window.innerWidth >= 768) {
                chatArea.style.display = 'flex';
                document.getElementById('emptyChat').style.display = 'flex';
                document.getElementById('activeChat').style.display = 'none';
            } else {
                chatArea.style.display = 'none';
            }
        }

        async function loadUserData() {
            const snapshot = await database.ref(`users/${currentUser.uid}`).once('value');
            currentUserData = snapshot.val() || {};
        }

        function updateOnlineStatus(status) {
            if (currentUser) {
                database.ref(`users/${currentUser.uid}`).update({
                    online: status,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
            }
        }

        function showChatTab(tab) {
            currentTab = tab;
            ['all', 'private', 'groups', 'channels'].forEach(t => {
                const el = document.getElementById('tab' + t.charAt(0).toUpperCase() + t.slice(1));
                el.classList.toggle('bg-purple-600', t === tab);
                el.classList.toggle('text-white', t === tab);
                el.classList.toggle('text-gray-400', t !== tab);
            });
            renderChatList();
        }

        function loadAllChats() {
            // ĞÑ‚Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµĞ¼ÑÑ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ñ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²
            database.ref(`userChats/${currentUser.uid}`).off('value');
            
            database.ref(`userChats/${currentUser.uid}`).on('value', async snapshot => {
                const chats = snapshot.val() || {};
                allChats = [];
                
                // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Set Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²
                const processedChatIds = new Set();
                
                for (const [chatId, chatData] of Object.entries(chats)) {
                    // ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ĞµÑĞ»Ğ¸ Ñ‡Ğ°Ñ‚ ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½
                    if (processedChatIds.has(chatId)) continue;
                    processedChatIds.add(chatId);
                    
                    try {
                        let chatInfo = { id: chatId, ...chatData, unread: 0 };
                        
                        const msgSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').limitToLast(1).once('value');
                        const msgs = msgSnap.val();
                        if (msgs) {
                            const lastMsg = Object.values(msgs)[0];
                            chatInfo.lastMessage = lastMsg.text || (lastMsg.fileUrl ? 'ğŸ“ Ğ¤Ğ°Ğ¹Ğ»' : '');
                            chatInfo.lastTime = lastMsg.timestamp;
                            chatInfo.lastSenderId = lastMsg.senderId;
                        }
                        
                        const unreadSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').once('value');
                        const allMsgs = unreadSnap.val() || {};
                        let unreadCount = 0;
                        for (const [msgId, msg] of Object.entries(allMsgs)) {
                            if (msg.senderId !== currentUser.uid && (!msg.readBy || !msg.readBy[currentUser.uid])) {
                                unreadCount++;
                            }
                        }
                        chatInfo.unread = unreadCount;
                        unreadCounts[chatId] = unreadCount;
                        
                        if (chatData.type === 'private') {
                            const userData = allUsers[chatData.oderId];
                            if (userData) {
                                chatInfo.name = userData.name;
                                chatInfo.email = userData.email;
                                chatInfo.online = userData.online;
                                chatInfo.avatar = userData.name.charAt(0).toUpperCase();
                            }
                        } else {
                            const groupSnap = await database.ref(`${chatData.type}s/${chatId}`).once('value');
                            const groupData = groupSnap.val();
                            if (groupData) {
                                chatInfo.name = groupData.name;
                                chatInfo.avatar = groupData.name.charAt(0).toUpperCase();
                                chatInfo.members = groupData.members;
                                chatInfo.owner = groupData.owner;
                                chatInfo.description = groupData.description;
                            }
                        }
                        
                        if (chatInfo.name) allChats.push(chatInfo);
                    } catch (e) { console.error(e); }
                }
                
                allChats.sort((a, b) => (b.lastTime || 0) - (a.lastTime || 0));
                renderChatList();
            });
        }

        function renderChatList() {
            const container = document.getElementById('chatList');
            let filtered = allChats;
            
            if (currentTab !== 'all') {
                const typeMap = { 'private': 'private', 'groups': 'group', 'channels': 'channel' };
                filtered = allChats.filter(c => c.type === typeMap[currentTab]);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">ĞĞµÑ‚ Ñ‡Ğ°Ñ‚Ğ¾Ğ²</div>';
                return;
            }
            
            container.innerHTML = filtered.map(chat => {
                const isActive = currentChat === chat.id;
                const statusDot = chat.type === 'private' && chat.online ? 'bg-green-500' : 'bg-gray-500';
                const typeIcon = chat.type === 'group' ? 'ğŸ‘¥' : chat.type === 'channel' ? 'ğŸ“¢' : '';
                const unreadBadge = chat.unread > 0 ? `<div class="min-w-[20px] h-5 bg-blue-500 rounded-full text-xs flex items-center justify-center px-1 unread-badge">${chat.unread}</div>` : '';
                const lastMsgPrefix = chat.lastSenderId === currentUser.uid ? 'Ğ’Ñ‹: ' : '';
                const gradientClass = chat.type === 'group' ? 'gradient-green' : chat.type === 'channel' ? 'gradient-orange' : 'gradient-bg';
                const chatNameHtml = chat.type === 'private' ? getNameWithBadge(chat.name, chat.email) : escapeHtml(chat.name);
                
                return `
                    <div onclick="openChat('${chat.id}', '${chat.type}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer transition-colors ${isActive ? 'bg-gray-700/50' : ''}">
                        <div class="relative shrink-0">
                            <div class="w-12 h-12 rounded-full ${gradientClass} flex items-center justify-center font-bold">${chat.avatar}</div>
                            ${chat.type === 'private' ? `<div class="absolute bottom-0 right-0 w-3.5 h-3.5 ${statusDot} rounded-full border-2 border-gray-800"></div>` : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-center">
                                <span class="font-medium truncate flex items-center">${typeIcon} ${chatNameHtml}</span>
                                <span class="text-xs text-gray-400 shrink-0 ml-2">${formatTime(chat.lastTime)}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <p class="text-sm text-gray-400 truncate">${lastMsgPrefix}${chat.lastMessage ? escapeHtml(chat.lastMessage) : 'ĞĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹'}</p>
                                ${unreadBadge}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function openChat(chatId, type) {
            currentChat = chatId;
            currentChatType = type;
            
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            // ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ - ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ°Ğ¹Ğ´Ğ±Ğ°Ñ€
            if (window.innerWidth < 768) {
                sidebar.style.display = 'none';
            } else {
                sidebar.classList.add('chat-open');
            }
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ Ñ‡Ğ°Ñ‚Ğ°
            chatArea.classList.add('active');
            chatArea.style.display = 'flex';
            
            // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ñ‡Ğ°Ñ‚, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹
            emptyChat.style.display = 'none';
            activeChat.classList.add('active');
            activeChat.style.display = 'flex';
            
            if (type === 'private') {
                const chatData = allChats.find(c => c.id === chatId);
                if (chatData) {
                    currentChatData = chatData;
                    document.getElementById('chatAvatar').textContent = chatData.avatar;
                    document.getElementById('chatAvatar').className = 'w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold flex-shrink-0';
                    document.getElementById('chatName').innerHTML = getNameWithBadge(chatData.name, chatData.email);
                    
                    database.ref(`users/${chatData.oderId}`).on('value', snap => {
                        const u = snap.val();
                        if (u) {
                            document.getElementById('chatStatus').textContent = u.online ? 'Ğ’ ÑĞµÑ‚Ğ¸' : `Ğ‘Ñ‹Ğ»(Ğ°) ${formatLastSeen(u.lastSeen)}`;
                        }
                    });
                }
                document.getElementById('chatHeaderActions').innerHTML = '';
            } else {
                const snap = await database.ref(`${type}s/${chatId}`).once('value');
                const data = snap.val();
                currentChatData = data;
                
                document.getElementById('chatAvatar').textContent = data.name.charAt(0).toUpperCase();
                document.getElementById('chatAvatar').className = `w-10 h-10 rounded-full ${type === 'group' ? 'gradient-green' : 'gradient-orange'} flex items-center justify-center font-bold flex-shrink-0`;
                document.getElementById('chatName').textContent = (type === 'group' ? 'ğŸ‘¥ ' : 'ğŸ“¢ ') + data.name;
                
                const memberCount = Object.keys(data.members || {}).length;
                document.getElementById('chatStatus').textContent = type === 'group' ? `${memberCount} ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²` : `${memberCount} Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑ‡Ğ¸ĞºĞ¾Ğ²`;
                
                // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ - Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†
                const isOwner = data.owner === currentUser.uid;
                if (isOwner) {
                    document.getElementById('chatHeaderActions').innerHTML = `
                        <button onclick="showSettings('${chatId}', '${type}')" class="p-2 hover:bg-gray-700/50 rounded-xl transition-colors" title="ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </button>
                    `;
                } else {
                    document.getElementById('chatHeaderActions').innerHTML = '';
                }
            }
            
            const isChannel = type === 'channel';
            const isOwner = currentChatData?.owner === currentUser.uid;
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼/ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
            const messageInputArea = document.getElementById('messageInputArea');
            const channelNotice = document.getElementById('channelNotice');
            
            if (isChannel && !isOwner) {
                messageInputArea.style.display = 'none';
                channelNotice.style.display = 'block';
            } else {
                messageInputArea.style.display = 'block';
                channelNotice.style.display = 'none';
            }
            
            loadMessages(chatId);
            markAsRead(chatId);
            renderChatList();
        }

        function closeChat() {
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ°Ğ¹Ğ´Ğ±Ğ°Ñ€
            sidebar.style.display = 'flex';
            sidebar.classList.remove('chat-open');
            
            // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ Ñ‡Ğ°Ñ‚Ğ° Ğ½Ğ° Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ…
            if (window.innerWidth < 768) {
                chatArea.classList.remove('active');
                chatArea.style.display = 'none';
            }
            
            // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚, Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹
            activeChat.classList.remove('active');
            activeChat.style.display = 'none';
            emptyChat.style.display = 'flex';
            
            currentChat = null;
        }

        function loadMessages(chatId) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            database.ref(`messages/${chatId}`).orderByChild('timestamp').off();
            database.ref(`messages/${chatId}`).orderByChild('timestamp').on('child_added', snapshot => {
                const msg = snapshot.val();
                const msgId = snapshot.key;
                addMessageToUI(msg, msgId);
            });
            
            database.ref(`messages/${chatId}`).on('child_changed', snapshot => {
                const msg = snapshot.val();
                const msgId = snapshot.key;
                updateMessageUI(msg, msgId);
            });
        }

        async function addMessageToUI(msg, msgId) {
            const container = document.getElementById('messagesContainer');
            const isOwn = msg.senderId === currentUser.uid;
            
            let senderName = '';
            let senderNameHtml = '';
            if (!isOwn && currentChatType !== 'private') {
                const senderData = allUsers[msg.senderId];
                senderName = senderData?.name || 'Unknown';
                senderNameHtml = getNameWithBadge(senderName, senderData?.email);
            }
            
            const reactions = msg.reactions || {};
            const reactionsList = Object.entries(reactions).reduce((acc, [emoji, users]) => {
                const count = Object.keys(users).length;
                const hasOwn = users[currentUser.uid];
                if (count > 0) acc.push({ emoji, count, hasOwn });
                return acc;
            }, []);
            
            const reactionsHtml = reactionsList.length > 0 ? `
                <div class="flex flex-wrap gap-1 mt-1">
                    ${reactionsList.map(r => `
                        <button onclick="toggleReaction('${msgId}', '${r.emoji}')" class="flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${r.hasOwn ? 'bg-purple-600/50' : 'bg-gray-600/50'} hover:bg-gray-500/50">
                            <span>${r.emoji}</span><span>${r.count}</span>
                        </button>
                    `).join('')}
                </div>
            ` : '';
            
            let contentHtml = '';
            if (msg.fileUrl) {
                if (msg.fileType && msg.fileType.startsWith('image/')) {
                    contentHtml = `<div class="message-image mb-1"><img src="${msg.fileUrl}" alt="Image" class="image-preview cursor-pointer" onclick="viewImage('${msg.fileUrl}')" loading="lazy"></div>`;
                } else if (msg.fileType && msg.fileType.startsWith('video/')) {
                    contentHtml = `<div class="message-image mb-1"><video src="${msg.fileUrl}" controls class="image-preview"></video></div>`;
                } else {
                    contentHtml = `
                        <a href="${msg.fileUrl}" target="_blank" class="flex items-center gap-2 p-2 bg-gray-600/50 rounded-lg mb-2 hover:bg-gray-500/50">
                            <svg class="w-8 h-8 text-purple-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                            <span class="text-sm truncate">${escapeHtml(msg.fileName || 'Ğ¤Ğ°Ğ¹Ğ»')}</span>
                        </a>
                    `;
                }
            }
            if (msg.text) {
                contentHtml += `<p class="break-words mt-1">${escapeHtml(msg.text)}</p>`;
            }
            
            const div = document.createElement('div');
            div.id = `msg-${msgId}`;
            div.className = `flex ${isOwn ? 'justify-end' : 'justify-start'} fade-in`;
            div.innerHTML = `
                <div class="max-w-[75%] md:max-w-md lg:max-w-lg group relative">
                    ${senderNameHtml ? `<div class="text-xs text-purple-400 mb-1 ml-1 flex items-center">${senderNameHtml}</div>` : ''}
                    <div oncontextmenu="showReactions(event, '${msgId}')" onclick="handleMessageTap(event, '${msgId}')" class="relative ${isOwn ? 'message-out gradient-bg' : 'message-in bg-gray-700'} px-3 py-2 cursor-pointer">
                        ${contentHtml}
                        <div class="flex items-center justify-end gap-1 mt-1">
                            <span class="text-xs ${isOwn ? 'text-white/70' : 'text-gray-400'}">${formatTime(msg.timestamp)}</span>
                            ${isOwn ? getReadIcon(msg) : ''}
                        </div>
                        ${reactionsHtml}
                    </div>
                </div>
            `;
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function updateMessageUI(msg, msgId) {
            const el = document.getElementById(`msg-${msgId}`);
            if (!el) return;
            
            const reactions = msg.reactions || {};
            const reactionsList = Object.entries(reactions).reduce((acc, [emoji, users]) => {
                const count = Object.keys(users).length;
                const hasOwn = users[currentUser.uid];
                if (count > 0) acc.push({ emoji, count, hasOwn });
                return acc;
            }, []);
            
            let reactionsContainer = el.querySelector('.flex.flex-wrap');
            if (reactionsList.length > 0) {
                const html = reactionsList.map(r => `
                    <button onclick="toggleReaction('${msgId}', '${r.emoji}')" class="flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${r.hasOwn ? 'bg-purple-600/50' : 'bg-gray-600/50'} hover:bg-gray-500/50">
                        <span>${r.emoji}</span><span>${r.count}</span>
                    </button>
                `).join('');
                
                if (reactionsContainer) {
                    reactionsContainer.innerHTML = html;
                } else {
                    const msgDiv = el.querySelector('.message-in, .message-out');
                    msgDiv.insertAdjacentHTML('beforeend', `<div class="flex flex-wrap gap-1 mt-1">${html}</div>`);
                }
            } else if (reactionsContainer) {
                reactionsContainer.remove();
            }
        }

        function getReadIcon(msg) {
            if (msg.readBy && Object.keys(msg.readBy).some(uid => uid !== currentUser.uid)) {
                return '<svg class="w-4 h-4 text-blue-400" fill="currentColor" viewBox="0 0 24 24"><path d="M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"/></svg>';
            }
            return '<svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>';
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ¼Ğ°ĞºÑ 32MB Ğ´Ğ»Ñ imgBB, 10MB Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…)
            const maxSize = file.type.startsWith('image/') ? 32 * 1024 * 1024 : 10 * 1024 * 1024;
            if (file.size > maxSize) {
                showToast('âš ï¸', 'ĞÑˆĞ¸Ğ±ĞºĞ°', `Ğ¤Ğ°Ğ¹Ğ» ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ (Ğ¼Ğ°ĞºÑ. ${file.type.startsWith('image/') ? '32' : '10'}MB)`);
                return;
            }
            
            pendingFile = file;
            const preview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('uploadPreviewImage');
            const previewFile = document.getElementById('uploadPreviewFile');
            const fileName = document.getElementById('uploadFileName');
            
            preview.classList.remove('hidden');
            
            if (file.type.startsWith('image/')) {
                previewImage.classList.remove('hidden');
                previewFile.classList.add('hidden');
                previewImage.src = URL.createObjectURL(file);
            } else {
                previewImage.classList.add('hidden');
                previewFile.classList.remove('hidden');
                previewFile.style.display = 'flex';
                fileName.textContent = file.name;
            }
            
            event.target.value = '';
        }

        function cancelUpload() {
            if (uploadTask) {
                uploadTask.cancel();
                uploadTask = null;
            }
            isUploading = false;
            pendingFile = null;
            document.getElementById('uploadPreview').classList.add('hidden');
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadProgressBar').style.width = '0%';
            document.getElementById('imageCaption').value = '';
        }

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ° Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ
        async function sendFileWithCaption() {
            if (!pendingFile || !currentChat) return;
            
            if (isUploading) {
                showToast('â³', 'ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ', 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ...');
                return;
            }
            
            const caption = document.getElementById('imageCaption').value.trim();
            
            isUploading = true;
            
            let messageData = {
                senderId: currentUser.uid,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                readBy: { [currentUser.uid]: true }
            };
            
            if (caption) messageData.text = caption;
            
            try {
                const fileUrl = await uploadFile(pendingFile);
                messageData.fileUrl = fileUrl;
                messageData.fileName = pendingFile.name;
                messageData.fileType = pendingFile.type;
                
                await database.ref(`messages/${currentChat}`).push(messageData);
                await database.ref(`userChats/${currentUser.uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                
                if (currentChatType === 'private') {
                    const chatData = allChats.find(c => c.id === currentChat);
                    if (chatData) {
                        await database.ref(`userChats/${chatData.oderId}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                    }
                } else if (currentChatData?.members) {
                    for (const uid of Object.keys(currentChatData.members)) {
                        if (uid !== currentUser.uid) {
                            await database.ref(`userChats/${uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                        }
                    }
                }
                
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'Ğ¤Ğ°Ğ¹Ğ» Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½');
            } catch (error) {
                console.error('File upload failed:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»: ' + error.message);
            } finally {
                isUploading = false;
                cancelUpload();
            }
        }

        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· imgBB API
        async function uploadImageToImgBB(file) {
            return new Promise((resolve, reject) => {
                const formData = new FormData();
                formData.append('image', file);
                formData.append('key', IMGBB_API_KEY);
                
                document.getElementById('uploadProgress').classList.remove('hidden');
                
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'https://api.imgbb.com/1/upload');
                
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const progress = (e.loaded / e.total) * 100;
                        document.getElementById('uploadProgressBar').style.width = progress + '%';
                    }
                };
                
                xhr.onload = () => {
                    if (xhr.status === 200) {
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.success) {
                                console.log('imgBB upload success:', response.data.url);
                                resolve(response.data.url);
                            } else {
                                reject(new Error('imgBB upload failed: ' + (response.error?.message || 'Unknown error')));
                            }
                        } catch (e) {
                            reject(new Error('Failed to parse imgBB response'));
                        }
                    } else {
                        reject(new Error('imgBB upload failed with status: ' + xhr.status));
                    }
                };
                
                xhr.onerror = () => {
                    reject(new Error('Network error during upload'));
                };
                
                xhr.send(formData);
            });
        }

        // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Firebase Storage (Ğ´Ğ»Ñ Ğ½Ğµ-Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹)
        async function uploadFileToFirebase(file) {
            return new Promise((resolve, reject) => {
                const fileName = `${Date.now()}_${file.name.replace(/[^a-zA-Z0-9._-]/g, '_')}`;
                const filePath = `uploads/${currentUser.uid}/${fileName}`;
                const fileRef = storage.ref(filePath);
                
                const metadata = {
                    contentType: file.type,
                    customMetadata: {
                        'uploadedBy': currentUser.uid,
                        'originalName': file.name
                    }
                };
                
                document.getElementById('uploadProgress').classList.remove('hidden');
                document.getElementById('uploadProgressBar').style.width = '0%';
                
                console.log('Starting Firebase upload:', filePath);
                
                uploadTask = fileRef.put(file, metadata);
                
                uploadTask.on('state_changed', 
                    snapshot => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        document.getElementById('uploadProgressBar').style.width = progress + '%';
                    },
                    error => {
                        console.error('Firebase upload error:', error);
                        document.getElementById('uploadProgress').classList.add('hidden');
                        reject(error);
                    },
                    async () => {
                        try {
                            const url = await uploadTask.snapshot.ref.getDownloadURL();
                            console.log('Firebase upload success:', url);
                            resolve(url);
                        } catch (e) {
                            reject(e);
                        }
                    }
                );
            });
        }

        // Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
        async function uploadFile(file) {
            // Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· imgBB
            if (file.type.startsWith('image/')) {
                console.log('Uploading image to imgBB...');
                return await uploadImageToImgBB(file);
            }
            
            // ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Firebase Storage
            console.log('Uploading file to Firebase Storage...');
            return await uploadFileToFirebase(file);
        }

        function viewImage(url) {
            document.getElementById('viewerImage').src = url;
            document.getElementById('imageViewer').classList.remove('hidden');
        }

        function closeImageViewer() {
            document.getElementById('imageViewer').classList.add('hidden');
        }

        let lastTap = 0;
        function handleMessageTap(e, msgId) {
            const now = Date.now();
            if (now - lastTap < 300) {
                showReactions(e, msgId);
            }
            lastTap = now;
        }

        function showReactions(e, msgId) {
            e.preventDefault();
            currentMessageId = msgId;
            const picker = document.getElementById('reactionsPicker');
            picker.classList.remove('hidden');
            
            const rect = e.target.getBoundingClientRect();
            picker.style.left = Math.min(rect.left, window.innerWidth - 220) + 'px';
            picker.style.top = (rect.top - 50) + 'px';
            
            setTimeout(() => {
                document.addEventListener('click', hideReactions, { once: true });
            }, 10);
        }

        function hideReactions() {
            document.getElementById('reactionsPicker').classList.add('hidden');
        }

        function addReaction(emoji) {
            if (!currentMessageId || !currentChat) return;
            database.ref(`messages/${currentChat}/${currentMessageId}/reactions/${emoji}/${currentUser.uid}`).set(true);
            hideReactions();
        }

        function toggleReaction(msgId, emoji) {
            database.ref(`messages/${currentChat}/${msgId}/reactions/${emoji}/${currentUser.uid}`).once('value', snap => {
                if (snap.exists()) {
                    snap.ref.remove();
                } else {
                    snap.ref.set(true);
                }
            });
        }

        async function sendMessage(e) {
            e.preventDefault();
            
            if (isUploading) {
                showToast('â³', 'ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ', 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ² Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞµ...');
                return;
            }
            
            // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸ĞºÑ€ĞµĞ¿Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ», Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºÑƒ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€ĞµĞ²ÑŒÑ
            if (pendingFile) {
                sendFileWithCaption();
                return;
            }
            
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            if (!currentChat) return;
            
            input.value = '';
            
            if (typingTimeout) {
                clearTimeout(typingTimeout);
                database.ref(`typing/${currentChat}/${currentUser.uid}`).set(false);
            }
            
            let messageData = {
                senderId: currentUser.uid,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                readBy: { [currentUser.uid]: true },
                text: text
            };
            
            await database.ref(`messages/${currentChat}`).push(messageData);
            await database.ref(`userChats/${currentUser.uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
            
            if (currentChatType === 'private') {
                const chatData = allChats.find(c => c.id === currentChat);
                if (chatData) {
                    await database.ref(`userChats/${chatData.oderId}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                }
            } else if (currentChatData?.members) {
                for (const uid of Object.keys(currentChatData.members)) {
                    if (uid !== currentUser.uid) {
                        await database.ref(`userChats/${uid}/${currentChat}/updatedAt`).set(firebase.database.ServerValue.TIMESTAMP);
                    }
                }
            }
        }

        function handleTyping() {
            if (!currentChat) return;
            database.ref(`typing/${currentChat}/${currentUser.uid}`).set(true);
            clearTimeout(typingTimeout);
            typingTimeout = setTimeout(() => {
                database.ref(`typing/${currentChat}/${currentUser.uid}`).set(false);
            }, 2000);
        }

        function markAsRead(chatId) {
            database.ref(`messages/${chatId}`).once('value', snap => {
                const msgs = snap.val() || {};
                for (const [msgId, msg] of Object.entries(msgs)) {
                    if (msg.senderId !== currentUser.uid) {
                        database.ref(`messages/${chatId}/${msgId}/readBy/${currentUser.uid}`).set(true);
                    }
                }
            });
            unreadCounts[chatId] = 0;
        }

        function setupNotificationListener() {
            database.ref(`userChats/${currentUser.uid}`).on('child_changed', async snap => {
                const chatId = snap.key;
                if (chatId === currentChat && document.visibilityState === 'visible') return;
                
                const msgSnap = await database.ref(`messages/${chatId}`).orderByChild('timestamp').limitToLast(1).once('value');
                const msgs = msgSnap.val();
                if (!msgs) return;
                
                const lastMsg = Object.values(msgs)[0];
                if (lastMsg.senderId === currentUser.uid) return;
                
                const senderName = allUsers[lastMsg.senderId]?.name || 'ĞĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ';
                const msgText = lastMsg.text || (lastMsg.fileUrl ? 'ğŸ“ Ğ¤Ğ°Ğ¹Ğ»' : '');
                
                showToast(senderName.charAt(0).toUpperCase(), senderName, msgText, chatId);
                
                if (Notification.permission === 'granted' && document.visibilityState !== 'visible') {
                    new Notification(senderName, { body: msgText, icon: '/favicon.ico' });
                }
            });
        }

        function showToast(icon, title, msg, chatId = null) {
            toastChatId = chatId;
            document.getElementById('toastIcon').textContent = icon;
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = msg;
            const toast = document.getElementById('toast');
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 4000);
        }

        function handleToastClick() {
            document.getElementById('toast').classList.add('hidden');
            if (toastChatId) {
                const chat = allChats.find(c => c.id === toastChatId);
                if (chat) openChat(toastChatId, chat.type);
            }
        }

        function showCreateMenu() {
            document.getElementById('createMenuModal').classList.remove('hidden');
        }

        function showNewPrivateChat() {
            closeModal('createMenuModal');
            document.getElementById('newPrivateChatModal').classList.remove('hidden');
            document.getElementById('userSearchInput').value = '';
            document.getElementById('userSearchResults').innerHTML = '';
            renderUsersForChat();
        }

        function renderUsersForChat() {
            const container = document.getElementById('userSearchResults');
            const users = Object.entries(allUsers).filter(([uid]) => uid !== currentUser.uid);
            
            if (users.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>';
                return;
            }
            
            // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Map Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²
            const uniqueUsers = new Map();
            users.forEach(([uid, user]) => {
                if (!uniqueUsers.has(uid)) {
                    uniqueUsers.set(uid, user);
                }
            });
            
            container.innerHTML = Array.from(uniqueUsers.entries()).map(([uid, user]) => `
                <div onclick="startPrivateChat('${uid}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer rounded-xl" data-uid="${uid}">
                    <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                    <div>
                        <div class="font-medium flex items-center">${getNameWithBadge(user.name || 'Unknown', user.email)}</div>
                        <div class="text-xs text-gray-400">${user.online ? 'Ğ’ ÑĞµÑ‚Ğ¸' : 'ĞĞµ Ğ² ÑĞµÑ‚Ğ¸'}</div>
                    </div>
                </div>
            `).join('');
        }

        function searchUsersForChat() {
            const query = document.getElementById('userSearchInput').value.toLowerCase();
            const items = document.querySelectorAll('#userSearchResults > div');
            items.forEach(item => {
                const name = item.querySelector('.font-medium')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? '' : 'none';
            });
        }

        async function startPrivateChat(otherUserId) {
            closeModal('newPrivateChatModal');
            
            const chatId = currentUser.uid < otherUserId ? `${currentUser.uid}_${otherUserId}` : `${otherUserId}_${currentUser.uid}`;
            
            await database.ref(`userChats/${currentUser.uid}/${chatId}`).set({
                type: 'private',
                oderId: otherUserId,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
            await database.ref(`userChats/${otherUserId}/${chatId}`).set({
                type: 'private',
                oderId: currentUser.uid,
                updatedAt: firebase.database.ServerValue.TIMESTAMP
            });
            
            setTimeout(() => openChat(chatId, 'private'), 500);
        }

        function showCreateGroup() {
            closeModal('createMenuModal');
            document.getElementById('createGroupModal').classList.remove('hidden');
            document.getElementById('groupName').value = '';
            document.getElementById('groupSearchInput').value = '';
            document.getElementById('groupSearchResults').innerHTML = '';
            selectedGroupMembers = [];
            renderSelectedMembers();
            renderUsersForGroup();
        }

        function renderUsersForGroup() {
            const container = document.getElementById('groupSearchResults');
            const users = Object.entries(allUsers).filter(([uid]) => uid !== currentUser.uid);
            
            if (users.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹</div>';
                return;
            }
            
            // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Map Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ‚Ğ¾Ğ²
            const uniqueUsers = new Map();
            users.forEach(([uid, user]) => {
                if (!uniqueUsers.has(uid)) {
                    uniqueUsers.set(uid, user);
                }
            });
            
            container.innerHTML = Array.from(uniqueUsers.entries()).map(([uid, user]) => {
                const selected = selectedGroupMembers.includes(uid);
                return `
                    <div onclick="toggleGroupMember('${uid}')" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer rounded-xl ${selected ? 'bg-purple-600/20' : ''}" data-uid="${uid}">
                        <div class="w-10 h-10 rounded-full gradient-bg flex items-center justify-center font-bold">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                        <div class="flex-1">
                            <div class="font-medium flex items-center">${getNameWithBadge(user.name || 'Unknown', user.email)}</div>
                        </div>
                        ${selected ? '<svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>' : ''}
                    </div>
                `;
            }).join('');
        }

        function searchUsersForGroup() {
            const query = document.getElementById('groupSearchInput').value.toLowerCase();
            const items = document.querySelectorAll('#groupSearchResults > div');
            items.forEach(item => {
                const name = item.querySelector('.font-medium')?.textContent.toLowerCase() || '';
                item.style.display = name.includes(query) ? '' : 'none';
            });
        }

        function toggleGroupMember(uid) {
            const idx = selectedGroupMembers.indexOf(uid);
            if (idx >= 0) {
                selectedGroupMembers.splice(idx, 1);
            } else {
                selectedGroupMembers.push(uid);
            }
            renderSelectedMembers();
            renderUsersForGroup();
        }

        function renderSelectedMembers() {
            const container = document.getElementById('selectedMembers');
            if (selectedGroupMembers.length === 0) {
                container.innerHTML = '';
                return;
            }
            container.innerHTML = selectedGroupMembers.map(uid => {
                const user = allUsers[uid];
                return `
                    <div class="flex items-center gap-1 bg-purple-600/30 rounded-full px-2 py-1">
                        <span class="text-sm">${escapeHtml(user?.name || 'User')}</span>
                        <button onclick="toggleGroupMember('${uid}')" class="text-gray-400 hover:text-white">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
        }

        async function createGroup() {
            const nameInput = document.getElementById('groupName');
            const name = nameInput ? nameInput.value.trim() : '';
            
            console.log('createGroup called, name:', name);
            
            if (!name) {
                showToast('âš ï¸', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹');
                return;
            }
            if (selectedGroupMembers.length === 0) {
                showToast('âš ï¸', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²');
                return;
            }
            
            try {
                // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ
                const groupId = database.ref().child('groups').push().key;
                console.log('Generated group ID:', groupId);
                
                const members = { [currentUser.uid]: true };
                selectedGroupMembers.forEach(uid => members[uid] = true);
                
                const groupData = {
                    name: name,
                    owner: currentUser.uid,
                    members: members,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                console.log('Saving group data:', groupData);
                
                // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ
                await database.ref('groups/' + groupId).set(groupData);
                console.log('Group saved to database');
                
                // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‡Ğ°Ñ‚ Ğ²ÑĞµĞ¼ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°Ğ¼
                const updates = {};
                Object.keys(members).forEach(uid => {
                    updates[`userChats/${uid}/${groupId}`] = {
                        type: 'group',
                        updatedAt: firebase.database.ServerValue.TIMESTAMP
                    };
                });
                
                await database.ref().update(updates);
                console.log('User chats updated');
                
                closeModal('createGroupModal');
                selectedGroupMembers = [];
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°');
                
                setTimeout(() => openChat(groupId, 'group'), 500);
            } catch (error) {
                console.error('Error creating group:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', error.message);
            }
        }

        function showCreateChannel() {
            closeModal('createMenuModal');
            document.getElementById('createChannelModal').classList.remove('hidden');
            document.getElementById('channelName').value = '';
            document.getElementById('channelDescription').value = '';
        }

        async function createChannel() {
            const nameInput = document.getElementById('channelName');
            const descInput = document.getElementById('channelDescription');
            const name = nameInput ? nameInput.value.trim() : '';
            const description = descInput ? descInput.value.trim() : '';
            
            console.log('createChannel called, name:', name);
            
            if (!name) {
                showToast('âš ï¸', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ°');
                return;
            }
            
            try {
                // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ°Ğ½Ğ°Ğ»
                const channelId = database.ref().child('channels').push().key;
                console.log('Generated channel ID:', channelId);
                
                const channelData = {
                    name: name,
                    description: description,
                    owner: currentUser.uid,
                    members: { [currentUser.uid]: true },
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                console.log('Saving channel data:', channelData);
                
                // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ°Ğ½Ğ°Ğ» Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ñ‡Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
                const updates = {};
                updates['channels/' + channelId] = channelData;
                updates[`userChats/${currentUser.uid}/${channelId}`] = {
                    type: 'channel',
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref().update(updates);
                console.log('Channel created successfully');
                
                closeModal('createChannelModal');
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'ĞšĞ°Ğ½Ğ°Ğ» ÑĞ¾Ğ·Ğ´Ğ°Ğ½');
                
                setTimeout(() => openChat(channelId, 'channel'), 500);
            } catch (error) {
                console.error('Error creating channel:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', error.message);
            }
        }

        function showAccountSwitcher() {
            const accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
            const container = document.getElementById('accountSwitcherList');
            
            container.innerHTML = accounts.map(acc => {
                const isCurrent = currentUser?.email === acc.email;
                return `
                    <div class="flex items-center gap-3 p-3 ${isCurrent ? 'bg-purple-600/20' : 'hover:bg-gray-700/50'} rounded-xl ${isCurrent ? '' : 'cursor-pointer'}" ${isCurrent ? '' : `onclick="switchAccount('${acc.email}', '${acc.password}')"`}>
                        <div class="w-10 h-10 gradient-bg rounded-full flex items-center justify-center font-bold">${acc.name.charAt(0).toUpperCase()}</div>
                        <div class="flex-1">
                            <div class="font-medium">${acc.name}</div>
                            <div class="text-xs text-gray-400">${acc.email}</div>
                        </div>
                        ${isCurrent ? '<span class="text-xs text-purple-400">Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹</span>' : ''}
                    </div>
                `;
            }).join('') || '<div class="p-4 text-center text-gray-500">ĞĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ²</div>';
            
            document.getElementById('accountSwitcherModal').classList.remove('hidden');
        }

        async function switchAccount(email, password) {
            closeModal('accountSwitcherModal');
            await auth.signOut();
            await auth.signInWithEmailAndPassword(email, password);
        }

        function addNewAccount() {
            closeModal('accountSwitcherModal');
            auth.signOut();
        }

        async function showProfile() {
            const snap = await database.ref(`users/${currentUser.uid}`).once('value');
            const user = snap.val();
            
            document.getElementById('profileAvatar').textContent = user.name.charAt(0).toUpperCase();
            document.getElementById('profileNameDisplay').innerHTML = getNameWithBadge(user.name, currentUser.email);
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('newProfileName').value = user.name;
            document.getElementById('newProfileStatus').value = user.status || '';
            
            document.getElementById('profileModal').classList.remove('hidden');
        }

        async function updateProfile(e) {
            e.preventDefault();
            const name = document.getElementById('newProfileName').value.trim();
            const status = document.getElementById('newProfileStatus').value.trim();
            
            if (name) {
                await database.ref(`users/${currentUser.uid}`).update({ name, status, nameLower: name.toLowerCase() });
                showToast('âœ“', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½');
                closeModal('profileModal');
                
                let accounts = JSON.parse(localStorage.getItem('flashchat_accounts') || '[]');
                accounts = accounts.map(a => a.email === currentUser.email ? { ...a, name } : a);
                localStorage.setItem('flashchat_accounts', JSON.stringify(accounts));
                
                await loadAllUsers();
            }
        }

        function searchAll() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('searchResults');
            
            if (!query) {
                container.classList.add('hidden');
                return;
            }
            
            const results = allChats.filter(c => c.name.toLowerCase().includes(query));
            
            if (results.length === 0) {
                container.innerHTML = '<div class="p-3 text-center text-gray-500">ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾</div>';
            } else {
                container.innerHTML = results.map(chat => {
                    const gradientClass = chat.type === 'group' ? 'gradient-green' : chat.type === 'channel' ? 'gradient-orange' : 'gradient-bg';
                    return `
                        <div onclick="openChat('${chat.id}', '${chat.type}'); document.getElementById('searchInput').value=''; document.getElementById('searchResults').classList.add('hidden');" class="flex items-center gap-3 p-3 hover:bg-gray-700/50 cursor-pointer">
                            <div class="w-10 h-10 rounded-full ${gradientClass} flex items-center justify-center font-bold">${chat.avatar}</div>
                            <div class="font-medium">${escapeHtml(chat.name)}</div>
                        </div>
                    `;
                }).join('');
            }
            container.classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹/ĞºĞ°Ğ½Ğ°Ğ»Ğ°
        async function showSettings(chatId, type) {
            const snap = await database.ref(`${type}s/${chatId}`).once('value');
            const data = snap.val();
            
            if (!data || data.owner !== currentUser.uid) {
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ');
                return;
            }
            
            document.getElementById('settingsTitle').textContent = type === 'group' ? 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹' : 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ĞºĞ°Ğ½Ğ°Ğ»Ğ°';
            document.getElementById('settingsName').value = data.name || '';
            document.getElementById('settingsDescription').value = data.description || '';
            document.getElementById('deleteButtonText').textContent = type === 'group' ? 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ' : 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ»';
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼/ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²)
            document.getElementById('settingsDescriptionBlock').classList.toggle('hidden', type === 'group');
            
            // Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²
            const members = data.members || {};
            const memberCount = Object.keys(members).length;
            document.getElementById('settingsMemberCount').textContent = memberCount;
            
            const membersList = document.getElementById('settingsMembersList');
            membersList.innerHTML = '';
            
            for (const uid of Object.keys(members)) {
                const user = allUsers[uid];
                if (!user) continue;
                
                const isOwner = uid === data.owner;
                const isSelf = uid === currentUser.uid;
                
                membersList.innerHTML += `
                    <div class="flex items-center gap-3 p-2 bg-gray-700/30 rounded-xl">
                        <div class="w-8 h-8 rounded-full gradient-bg flex items-center justify-center font-bold text-sm">${user.name ? user.name.charAt(0).toUpperCase() : '?'}</div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-sm truncate flex items-center gap-1">
                                ${getNameWithBadge(user.name || 'Unknown', user.email)}
                                ${isOwner ? '<span class="text-xs text-purple-400">(Ğ²Ğ»Ğ°Ğ´ĞµĞ»ĞµÑ†)</span>' : ''}
                            </div>
                        </div>
                        ${!isSelf && !isOwner ? `
                            <button onclick="removeMember('${chatId}', '${type}', '${uid}')" class="p-1 text-gray-400 hover:text-red-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        ` : ''}
                    </div>
                `;
            }
            
            // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ID Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² saveSettings
            document.getElementById('settingsModal').dataset.chatId = chatId;
            document.getElementById('settingsModal').dataset.type = type;
            
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
        async function saveSettings() {
            const modal = document.getElementById('settingsModal');
            const chatId = modal.dataset.chatId;
            const type = modal.dataset.type;
            
            const name = document.getElementById('settingsName').value.trim();
            const description = document.getElementById('settingsDescription').value.trim();
            
            if (!name) {
                showToast('âš ï¸', 'ĞÑˆĞ¸Ğ±ĞºĞ°', 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ');
                return;
            }
            
            try {
                const updates = { name };
                if (type === 'channel') {
                    updates.description = description;
                }
                
                await database.ref(`${type}s/${chatId}`).update(updates);
                
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ‡Ğ°Ñ‚Ğ°
                document.getElementById('chatName').textContent = (type === 'group' ? 'ğŸ‘¥ ' : 'ğŸ“¢ ') + name;
                
                closeModal('settingsModal');
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹');
                
                // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
                await loadAllUsers();
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', error.message);
            }
        }

        // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°
        async function removeMember(chatId, type, uid) {
            if (!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ°?')) return;
            
            try {
                // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· Ñ‡Ğ»ĞµĞ½Ğ¾Ğ² Ğ³Ñ€ÑƒĞ¿Ğ¿Ñ‹/ĞºĞ°Ğ½Ğ°Ğ»Ğ°
                await database.ref(`${type}s/${chatId}/members/${uid}`).remove();
                
                // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‡Ğ°Ñ‚ Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
                await database.ref(`userChats/${uid}/${chatId}`).remove();
                
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', 'Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸Ğº ÑƒĞ´Ğ°Ğ»ĞµĞ½');
                
                // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾
                showSettings(chatId, type);
            } catch (error) {
                console.error('Error removing member:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', error.message);
            }
        }

        // Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ/ĞºĞ°Ğ½Ğ°Ğ»
        async function deleteGroupOrChannel() {
            const modal = document.getElementById('settingsModal');
            const chatId = modal.dataset.chatId;
            const type = modal.dataset.type;
            
            const typeName = type === 'group' ? 'Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ' : 'ĞºĞ°Ğ½Ğ°Ğ»';
            if (!confirm(`Ğ’Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ${typeName}? Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ.`)) return;
            
            try {
                // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²
                const snap = await database.ref(`${type}s/${chatId}/members`).once('value');
                const members = snap.val() || {};
                
                // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‡Ğ°Ñ‚ Ñƒ Ğ²ÑĞµÑ… ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²
                for (const uid of Object.keys(members)) {
                    await database.ref(`userChats/${uid}/${chatId}`).remove();
                }
                
                // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
                await database.ref(`messages/${chatId}`).remove();
                
                // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ³Ñ€ÑƒĞ¿Ğ¿Ñƒ/ĞºĞ°Ğ½Ğ°Ğ»
                await database.ref(`${type}s/${chatId}`).remove();
                
                closeModal('settingsModal');
                closeChat();
                showToast('âœ…', 'Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', type === 'group' ? 'Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ°' : 'ĞšĞ°Ğ½Ğ°Ğ» ÑƒĞ´Ğ°Ğ»ĞµĞ½');
            } catch (error) {
                console.error('Error deleting:', error);
                showToast('âŒ', 'ĞÑˆĞ¸Ğ±ĞºĞ°', error.message);
            }
        }

        function toggleEmoji() {
            document.getElementById('emojiPicker').classList.toggle('hidden');
        }

        function addEmoji(emoji) {
            const input = document.getElementById('messageInput');
            input.value += emoji;
            input.focus();
        }

        function showEmojiCategory(category) {
            const categories = ['smileys', 'gestures', 'animals', 'food', 'activities', 'travel', 'objects', 'symbols'];
            categories.forEach(cat => {
                const el = document.getElementById('emoji' + cat.charAt(0).toUpperCase() + cat.slice(1));
                const btn = document.getElementById('emojiCat' + cat.charAt(0).toUpperCase() + cat.slice(1));
                if (el) el.classList.toggle('hidden', cat !== category);
                if (btn) btn.classList.toggle('border-purple-500', cat === category);
                if (btn) btn.classList.toggle('border-transparent', cat !== category);
            });
        }

        function openFilePicker() {
            const menu = document.createElement('div');
            menu.className = 'fixed inset-0 modal-overlay flex items-end md:items-center justify-center z-50 p-4';
            menu.innerHTML = `
                <div class="bg-gray-800 rounded-3xl p-4 w-full max-w-sm slide-up">
                    <h3 class="text-lg font-bold mb-4 text-center">ĞŸÑ€Ğ¸ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ</h3>
                    <div class="space-y-2">
                        <button onclick="selectFileType('photo')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">Ğ¤Ğ¾Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ’Ğ¸Ğ´ĞµĞ¾</div>
                                <div class="text-xs text-gray-400">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· imgBB (Ğ´Ğ¾ 32MB)</div>
                            </div>
                        </button>
                        <button onclick="selectFileType('camera')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">ĞšĞ°Ğ¼ĞµÑ€Ğ°</div>
                                <div class="text-xs text-gray-400">Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ‚Ğ¾</div>
                            </div>
                        </button>
                        <button onclick="selectFileType('document')" class="w-full flex items-center gap-3 p-3 hover:bg-gray-700/50 rounded-xl transition-colors">
                            <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-yellow-400 rounded-full flex items-center justify-center">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div class="text-left">
                                <div class="font-medium">Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚</div>
                                <div class="text-xs text-gray-400">PDF, Word, Excel</div>
                            </div>
                        </button>
                    </div>
                    <button onclick="closeFilePicker()" class="w-full mt-4 py-2 text-gray-400 hover:text-white transition-colors">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
                </div>
            `;
            menu.id = 'filePickerModal';
            document.body.appendChild(menu);
        }

        function closeFilePicker() {
            const modal = document.getElementById('filePickerModal');
            if (modal) modal.remove();
        }

        function selectFileType(type) {
            const input = document.getElementById('fileInput');
            
            if (type === 'camera') {
                input.accept = 'image/*';
                input.capture = 'environment';
            } else if (type === 'photo') {
                input.accept = 'image/*,video/*';
                input.removeAttribute('capture');
            } else if (type === 'document') {
                input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.zip,.rar';
                input.removeAttribute('capture');
            }
            
            input.click();
            closeFilePicker();
        }

        function formatTime(ts) {
            if (!ts) return '';
            const d = new Date(ts);
            const now = new Date();
            if (d.toDateString() === now.toDateString()) {
                return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            }
            return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
        }

        function formatLastSeen(ts) {
            if (!ts) return 'Ğ´Ğ°Ğ²Ğ½Ğ¾';
            const diff = Date.now() - ts;
            if (diff < 60000) return 'Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾';
            if (diff < 3600000) return `${Math.floor(diff / 60000)} Ğ¼Ğ¸Ğ½ Ğ½Ğ°Ğ·Ğ°Ğ´`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} Ñ‡ Ğ½Ğ°Ğ·Ğ°Ğ´`;
            return new Date(ts).toLocaleDateString('ru-RU');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        document.addEventListener('visibilitychange', () => {
            if (currentUser) updateOnlineStatus(!document.hidden);
            if (!document.hidden && currentChat) markAsRead(currentChat);
        });

        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const chatArea = document.getElementById('chatArea');
            const emptyChat = document.getElementById('emptyChat');
            const activeChat = document.getElementById('activeChat');
            
            if (window.innerWidth >= 768) {
                // Ğ”ĞµÑĞºÑ‚Ğ¾Ğ¿ - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ° Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
                sidebar.style.display = 'flex';
                chatArea.style.display = 'flex';
                
                if (currentChat) {
                    sidebar.classList.add('chat-open');
                    chatArea.classList.add('active');
                    emptyChat.style.display = 'none';
                    activeChat.classList.add('active');
                    activeChat.style.display = 'flex';
                } else {
                    sidebar.classList.remove('chat-open');
                    chatArea.classList.remove('active');
                    emptyChat.style.display = 'flex';
                    activeChat.classList.remove('active');
                    activeChat.style.display = 'none';
                }
            } else {
                // ĞœĞ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ - Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ½Ñƒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
                if (currentChat) {
                    sidebar.style.display = 'none';
                    chatArea.style.display = 'flex';
                    chatArea.classList.add('active');
                } else {
                    sidebar.style.display = 'flex';
                    chatArea.style.display = 'none';
                    chatArea.classList.remove('active');
                }
            }
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(m => m.classList.add('hidden'));
                closeImageViewer();
            }
        });

        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', e => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        });
    </script>
</body>
</html>